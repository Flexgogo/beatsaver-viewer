(function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};return __webpack_require__.d(getter,'a',getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p='',__webpack_require__(__webpack_require__.s=69)})([function(module){module.exports={OFF:'#111',RED:'#ff3a7b',BLUE:'#08bfa2',UI_ACCENT:'#08bfa2',UI_ACCENT2:'#f01978',SKY_OFF:'#297547',SKY_BLUE:'#840d42',SKY_RED:'#154136',BG_OFF:'#081a0f',BG_BLUE:'#379f5e',BG_BRIGHTBLUE:'#4fd983',BG_RED:'#ff1f81',BG_BRIGHTRED:'#ff6bb0',NEON_OFF:'#000',NEON_BLUE:'#008a70',NEON_BRIGHTBLUE:'#87c2ff',NEON_RED:'#f01978',NEON_BRIGHTRED:'#ff70b5',TEXT_OFF:'#000',TEXT_NORMAL:'#444',TEXT_BOLD:'#888',BEAT_RED:'#660338',BEAT_BLUE:'#036657',MINE_RED:'#1c060e',MINE_RED_EMISSION:'#2a0d1b',MINE_BLUE:'#011114',MINE_BLUE_EMISSION:'#072020'}},function(module){module.exports.getS3FileUrl=function getS3FileUrl(id,name){return`${'https://saber.supermedium.com'}/${id}-${name}?v=1`}},function(module,__webpack_exports__){'use strict';const BEAT_WARMUP_SPEED=155;__webpack_exports__.a=BEAT_WARMUP_SPEED;__webpack_exports__.b=1e3*(25/BEAT_WARMUP_SPEED)},function(module){function getGridUvs(row,column,totalRows,totalColumns){const columnWidth=1/totalColumns,rowHeight=1/totalRows;return uvs[0].set(columnWidth*column,rowHeight*row+rowHeight),uvs[1].set(columnWidth*column,rowHeight*row),uvs[2].set(columnWidth*column+columnWidth,rowHeight*row),uvs[3].set(columnWidth*column+columnWidth,rowHeight*row+rowHeight),uvs}var uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];AFRAME.registerComponent('atlas-uvs',{dependencies:['geometry'],schema:{totalColumns:{type:'int',default:1},totalRows:{type:'int',default:1},column:{type:'int',default:1},row:{type:'int',default:1}},update:function(){const data=this.data,uvs=getGridUvs(data.row-1,data.column-1,data.totalRows,data.totalColumns),geometry=this.el.getObject3D('mesh').geometry;geometry.faceVertexUvs[0][0][0].copy(uvs[0]),geometry.faceVertexUvs[0][0][1].copy(uvs[1]),geometry.faceVertexUvs[0][0][2].copy(uvs[3]),geometry.faceVertexUvs[0][1][0].copy(uvs[1]),geometry.faceVertexUvs[0][1][1].copy(uvs[2]),geometry.faceVertexUvs[0][1][2].copy(uvs[3]),geometry.uvsNeedUpdate=!0}}),AFRAME.registerComponent('dynamic-texture-atlas',{schema:{canvasId:{default:'dynamicAtlas'},canvasHeight:{default:1024},canvasWidth:{default:1024},debug:{default:!1},numColumns:{default:8},numRows:{default:8}},multiple:!0,init:function(){const canvas=this.canvas=document.createElement('canvas');canvas.id=this.data.canvasId,canvas.height=this.data.canvasHeight,canvas.width=this.data.canvasWidth,this.ctx=canvas.getContext('2d'),document.body.appendChild(canvas),this.data.debug&&(canvas.style.left=0,canvas.style.top=0,canvas.style.position='fixed',canvas.style.zIndex=9999999999)},drawTexture:function(image,row,column,width,height){const canvas=this.canvas,data=this.data;image.complete||(image.onload=()=>{this.drawTexture(image,row,column)});const gridHeight=height||canvas.height/data.numRows,gridWidth=width||canvas.width/data.numColumns;return this.ctx.drawImage(image,gridWidth*row,gridWidth*column,gridWidth,gridHeight),getGridUvs(row,column,data.numRows,data.numColumns)}}),module.exports.getGridUvs=getGridUvs},function(){THREE.BufferGeometryUtils={computeTangents:function(geometry){function handleTriangle(a,b,c){vA.fromArray(positions,3*a),vB.fromArray(positions,3*b),vC.fromArray(positions,3*c),uvA.fromArray(uvs,2*a),uvB.fromArray(uvs,2*b),uvC.fromArray(uvs,2*c);var x1=vB.x-vA.x,x2=vC.x-vA.x,y1=vB.y-vA.y,y2=vC.y-vA.y,z1=vB.z-vA.z,z2=vC.z-vA.z,s1=uvB.x-uvA.x,s2=uvC.x-uvA.x,t1=uvB.y-uvA.y,t2=uvC.y-uvA.y,r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r),tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r),tan1[a].add(sdir),tan1[b].add(sdir),tan1[c].add(sdir),tan2[a].add(tdir),tan2[b].add(tdir),tan2[c].add(tdir)}function handleVertex(v){n.fromArray(normals,3*v),n2.copy(n),t=tan1[v],tmp.copy(t),tmp.sub(n.multiplyScalar(n.dot(t))).normalize(),tmp2.crossVectors(n2,t),test=tmp2.dot(tan2[v]),w=0>test?-1:1,tangents[4*v]=tmp.x,tangents[4*v+1]=tmp.y,tangents[4*v+2]=tmp.z,tangents[4*v+3]=w}var index=geometry.index,attributes=geometry.attributes;if(null===index||void 0===attributes.position||void 0===attributes.normal||void 0===attributes.uv)return void console.warn('THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()');var indices=index.array,positions=attributes.position.array,normals=attributes.normal.array,uvs=attributes.uv.array,nVertices=positions.length/3;attributes.tangent===void 0&&geometry.addAttribute('tangent',new THREE.BufferAttribute(new Float32Array(4*nVertices),4));for(var tangents=attributes.tangent.array,tan1=[],tan2=[],k=0;k<nVertices;k++)tan1[k]=new THREE.Vector3,tan2[k]=new THREE.Vector3;var vA=new THREE.Vector3,vB=new THREE.Vector3,vC=new THREE.Vector3,uvA=new THREE.Vector2,uvB=new THREE.Vector2,uvC=new THREE.Vector2,sdir=new THREE.Vector3,tdir=new THREE.Vector3,groups=geometry.groups;0===groups.length&&(groups=[{start:0,count:indices.length}]);for(var j=0,jl=groups.length;j<jl;++j)for(var group=groups[j],start=group.start,count=group.count,i=start,il=start+count;i<il;i+=3)handleTriangle(indices[i+0],indices[i+1],indices[i+2]);for(var w,t,test,tmp=new THREE.Vector3,tmp2=new THREE.Vector3,n=new THREE.Vector3,n2=new THREE.Vector3,j=0,jl=groups.length;j<jl;++j)for(var group=groups[j],start=group.start,count=group.count,i=start,il=start+count;i<il;i+=3)handleVertex(indices[i+0]),handleVertex(indices[i+1]),handleVertex(indices[i+2])},mergeBufferGeometries:function(geometries,useGroups){for(var geometry,isIndexed=null!==geometries[0].index,attributesUsed=new Set(Object.keys(geometries[0].attributes)),morphAttributesUsed=new Set(Object.keys(geometries[0].morphAttributes)),attributes={},morphAttributes={},mergedGeometry=new THREE.BufferGeometry,offset=0,i=0;i<geometries.length;++i){if(geometry=geometries[i],isIndexed!=(null!==geometry.index))return null;for(var name in geometry.attributes){if(!attributesUsed.has(name))return null;void 0===attributes[name]&&(attributes[name]=[]),attributes[name].push(geometry.attributes[name])}for(var name in geometry.morphAttributes){if(!morphAttributesUsed.has(name))return null;void 0===morphAttributes[name]&&(morphAttributes[name]=[]),morphAttributes[name].push(geometry.morphAttributes[name])}if(mergedGeometry.userData.mergedUserData=mergedGeometry.userData.mergedUserData||[],mergedGeometry.userData.mergedUserData.push(geometry.userData),useGroups){var count;if(isIndexed)count=geometry.index.count;else if(void 0!==geometry.attributes.position)count=geometry.attributes.position.count;else return null;mergedGeometry.addGroup(offset,count,i),offset+=count}}if(isIndexed){for(var index,indexOffset=0,indexList=[],i=0;i<geometries.length;++i){if(index=geometries[i].index,0<indexOffset){index=index.clone();for(var j=0;j<index.count;++j)index.setX(j,index.getX(j)+indexOffset)}indexList.push(index),indexOffset+=geometries[i].attributes.position.count}var mergedIndex=this.mergeBufferAttributes(indexList);if(!mergedIndex)return null;mergedGeometry.index=mergedIndex}for(var name in attributes){var mergedAttribute=this.mergeBufferAttributes(attributes[name]);if(!mergedAttribute)return null;mergedGeometry.addAttribute(name,mergedAttribute)}for(var name in morphAttributes){var numMorphTargets=morphAttributes[name][0].length;if(0===numMorphTargets)break;mergedGeometry.morphAttributes=mergedGeometry.morphAttributes||{},mergedGeometry.morphAttributes[name]=[];for(var morphAttributesToMerge,i=0;i<numMorphTargets;++i){morphAttributesToMerge=[];for(var j=0;j<morphAttributes[name].length;++j)morphAttributesToMerge.push(morphAttributes[name][j][i]);var mergedMorphAttribute=this.mergeBufferAttributes(morphAttributesToMerge);if(!mergedMorphAttribute)return null;mergedGeometry.morphAttributes[name].push(mergedMorphAttribute)}}return mergedGeometry},mergeBufferAttributes:function(attributes){for(var TypedArray,itemSize,normalized,attribute,arrayLength=0,i=0;i<attributes.length;++i){if(attribute=attributes[i],attribute.isInterleavedBufferAttribute)return null;if(void 0==TypedArray&&(TypedArray=attribute.array.constructor),TypedArray!==attribute.array.constructor)return null;if(void 0==itemSize&&(itemSize=attribute.itemSize),itemSize!==attribute.itemSize)return null;if(void 0==normalized&&(normalized=attribute.normalized),normalized!==attribute.normalized)return null;arrayLength+=attribute.array.length}for(var array=new TypedArray(arrayLength),offset=0,j=0;j<attributes.length;++j)array.set(attributes[j].array,offset),offset+=attributes[j].array.length;return new THREE.BufferAttribute(array,itemSize,normalized)}}},function(){function copyArray(dest,source){var i;for(dest.length=0,i=0;i<source.length;i++)dest[i]=source[i]}if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');var OBSERVER_CONFIG={childList:!0,attributes:!0,subtree:!0};AFRAME.registerComponent('aabb-collider',{schema:{collideNonVisible:{default:!1},debug:{default:!1},enabled:{default:!0},interval:{default:80},objects:{default:''}},init:function(){this.centerDifferenceVec3=new THREE.Vector3,this.clearedIntersectedEls=[],this.closestIntersectedEl=null,this.boundingBox=new THREE.Box3,this.boxCenter=new THREE.Vector3,this.boxHelper=new THREE.BoxHelper,this.boxMax=new THREE.Vector3,this.boxMin=new THREE.Vector3,this.hitClosestClearEventDetail={},this.hitClosestEventDetail={},this.intersectedEls=[],this.objectEls=[],this.newIntersectedEls=[],this.prevCheckTime=void 0,this.previousIntersectedEls=[],this.setDirty=this.setDirty.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.hitStartEventDetail={intersectedEls:this.newIntersectedEls}},play:function(){this.observer.observe(this.el.sceneEl,OBSERVER_CONFIG),this.el.sceneEl.addEventListener('object3dset',this.setDirty),this.el.sceneEl.addEventListener('object3dremove',this.setDirty)},remove:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener('object3dset',this.setDirty),this.el.sceneEl.removeEventListener('object3dremove',this.setDirty)},tick:function(time){var boxHelper,closestCenterDifference,newClosestEl,i,boundingBox=this.boundingBox,centerDifferenceVec3=this.centerDifferenceVec3,clearedIntersectedEls=this.clearedIntersectedEls,intersectedEls=this.intersectedEls,el=this.el,newIntersectedEls=this.newIntersectedEls,objectEls=this.objectEls,prevCheckTime=this.prevCheckTime,previousIntersectedEls=this.previousIntersectedEls,self=this;if(this.data.enabled&&!(prevCheckTime&&time-prevCheckTime<this.data.interval)){for(this.prevCheckTime=time,this.dirty&&this.refreshObjects(),boundingBox.setFromObject(el.object3D),this.boxMin.copy(boundingBox.min),this.boxMax.copy(boundingBox.max),boundingBox.getCenter(this.boxCenter),this.data.debug&&(this.boxHelper.setFromObject(el.object3D),!this.boxHelper.parent&&el.sceneEl.object3D.add(this.boxHelper)),copyArray(previousIntersectedEls,intersectedEls),intersectedEls.length=0,i=0;i<objectEls.length;i++)if(objectEls[i]!==this.el){if(!this.data.collideNonVisible&&!objectEls[i].getAttribute('visible')){this.data.debug&&(boxHelper=objectEls[i].object3D.boxHelper,boxHelper&&(el.sceneEl.object3D.remove(boxHelper),objectEls[i].object3D.boxHelper=null));continue}this.isIntersecting(objectEls[i])&&intersectedEls.push(objectEls[i])}for(newIntersectedEls.length=0,i=0;i<intersectedEls.length;i++)-1===previousIntersectedEls.indexOf(intersectedEls[i])&&newIntersectedEls.push(intersectedEls[i]);for(clearedIntersectedEls.length=0,i=0;i<previousIntersectedEls.length;i++)-1===intersectedEls.indexOf(previousIntersectedEls[i])&&(previousIntersectedEls[i].hasAttribute('aabb-collider')||previousIntersectedEls[i].emit('hitend'),clearedIntersectedEls.push(previousIntersectedEls[i]));for(i=0;i<newIntersectedEls.length;i++)newIntersectedEls[i]!==this.el&&(newIntersectedEls[i].hasAttribute('aabb-collider')||newIntersectedEls[i].emit('hitstart'));for(i=0;i<intersectedEls.length;i++)intersectedEls[i]!==this.el&&(centerDifferenceVec3.copy(intersectedEls[i].object3D.boundingBoxCenter).sub(this.boxCenter),(void 0==closestCenterDifference||centerDifferenceVec3.length()<closestCenterDifference)&&(closestCenterDifference=centerDifferenceVec3.length(),newClosestEl=intersectedEls[i]));!intersectedEls.length&&this.closestIntersectedEl?(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit('hitclosestclear'),this.closestIntersectedEl=null,el.emit('hitclosestclear',this.hitClosestClearEventDetail)):newClosestEl!==this.closestIntersectedEl&&(this.closestIntersectedEl&&(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit('hitclosestclear',this.hitClosestClearEventDetail)),newClosestEl&&(newClosestEl.emit('hitclosest'),this.closestIntersectedEl=newClosestEl,this.hitClosestEventDetail.el=newClosestEl,el.emit('hitclosest',this.hitClosestEventDetail))),clearedIntersectedEls.length&&el.emit('hitend'),newIntersectedEls.length&&el.emit('hitstart',this.hitStartEventDetail)}},isIntersecting:function(){var boundingBox=new THREE.Box3;return function(el){var boxMin,boxMax;return boundingBox.setFromObject(el.object3D),this.data.debug&&(!el.object3D.boxHelper&&(el.object3D.boxHelper=new THREE.BoxHelper(el.object3D,new THREE.Color(Math.random(),Math.random(),Math.random())),el.sceneEl.object3D.add(el.object3D.boxHelper)),el.object3D.boxHelper.setFromObject(el.object3D)),boxMin=boundingBox.min,boxMax=boundingBox.max,el.object3D.boundingBoxCenter=el.object3D.boundingBoxCenter||new THREE.Vector3,boundingBox.getCenter(el.object3D.boundingBoxCenter),this.boxMin.x<=boxMax.x&&this.boxMax.x>=boxMin.x&&this.boxMin.y<=boxMax.y&&this.boxMax.y>=boxMin.y&&this.boxMin.z<=boxMax.z&&this.boxMax.z>=boxMin.z}}(),setDirty:function(){this.dirty=!0},refreshObjects:function(){var data=this.data;this.objectEls=data.objects?this.el.sceneEl.querySelectorAll(data.objects):this.el.sceneEl.children,this.dirty=!1}})},function(){var styleParser=AFRAME.utils.styleParser;if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');AFRAME.registerComponent('event-set',{schema:{default:'',parse:function(value){return styleParser.parse(value)}},multiple:!0,init:function(){this.eventHandler=null,this.eventName=null},update:function(){this.removeEventListener(),this.updateEventListener(),this.addEventListener()},remove:function(){this.removeEventListener()},pause:function(){this.removeEventListener()},play:function(){this.addEventListener()},updateEventListener:function(){var event,target,targetEl,data=this.data,el=this.el;event=data._event||this.id,target=data._target,targetEl=target?el.sceneEl.querySelector(target):el,this.eventName=event,this.eventHandler=function handler(){for(var propName in data)'_event'!==propName&&'_target'!==propName&&AFRAME.utils.entity.setComponentProperty.call(this,targetEl,propName,data[propName])}},addEventListener:function(){this.el.addEventListener(this.eventName,this.eventHandler)},removeEventListener:function(){this.el.removeEventListener(this.eventName,this.eventHandler)}})},function(module,exports,__webpack_require__){THREE.BufferGeometryUtils||__webpack_require__(20),AFRAME.registerComponent('geometry-merger',{schema:{preserveOriginal:{default:!1}},init:function(){var self=this;this.geometry=new THREE.Geometry,this.mesh=new THREE.Mesh(this.geometry),this.el.setObject3D('mesh',this.mesh),this.faceIndex={},this.vertexIndex={},this.el.object3D.traverse(function(mesh){'Mesh'!==mesh.type||mesh===self.mesh||(self.faceIndex[mesh.parent.uuid]=[self.geometry.faces.length,self.geometry.faces.length+mesh.geometry.faces.length-1],self.vertexIndex[mesh.parent.uuid]=[self.geometry.vertices.length,self.geometry.vertices.length+mesh.geometry.vertices.length-1],mesh.parent.updateMatrix(),self.geometry.merge(mesh.geometry,mesh.parent.matrix),!self.data.preserveOriginal&&mesh.parent.remove(mesh))})}}),AFRAME.registerComponent('buffer-geometry-merger',{schema:{preserveOriginal:{default:!1}},init:function(){var geometries=[];this.el.sceneEl.object3D.updateMatrixWorld(),this.el.object3D.traverse(function(mesh){'Mesh'!==mesh.type||mesh.el===self.el||(mesh.geometry.applyMatrix(mesh.matrixWorld),geometries.push(mesh.geometry.clone()),mesh.parent.remove(mesh))});const geometry=THREE.BufferGeometryUtils.mergeBufferGeometries(geometries);this.mesh=new THREE.Mesh(geometry),this.el.setObject3D('mesh',this.mesh)}})},function(){if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');AFRAME.registerComponent('haptics',{dependencies:['tracked-controls'],schema:{actuatorIndex:{default:0},dur:{default:100},enabled:{default:!0},events:{type:'array'},eventsFrom:{type:'string'},force:{default:1}},multiple:!0,init:function(){var data=this.data,self=this;if(this.callPulse=function(){self.pulse()},this.el.components['tracked-controls'].controller){if(this.gamepad=this.el.components['tracked-controls'].controller,!this.gamepad||!this.gamepad.hapticActuators.length)return;this.addEventListeners()}else this.el.addEventListener('controllerconnected',function init(){setTimeout(function(){self.gamepad=self.el.components['tracked-controls'].controller,self.gamepad&&self.gamepad.hapticActuators.length&&self.addEventListeners()},150)})},remove:function(){this.removeEventListeners()},pulse:function(force,dur){var actuator,data=this.data;data.enabled&&this.gamepad&&this.gamepad.hapticActuators&&(actuator=this.gamepad.hapticActuators[data.actuatorIndex],actuator.pulse(force||data.force,dur||data.dur))},addEventListeners:function(){var i,listenTarget,data=this.data;for(listenTarget=data.eventsFrom?document.querySelector(data.eventsFrom):this.el,i=0;i<data.events.length;i++)listenTarget.addEventListener(data.events[i],this.callPulse)},removeEventListeners:function(){var i,listenTarget,data=this.data;for(listenTarget=data.eventsFrom?document.querySelector(data.eventsFrom):this.el,i=0;i<data.events.length;i++)listenTarget.removeEventListener(data.events[i],this.callPulse)}})},function(module){function getBoxPositions(data,numChildren,marginDefined){var column,marginColumn,marginRow,offsetColumn,offsetRow,row,rows=Math.ceil(numChildren/data.columns);for(marginColumn=data.marginColumn,marginRow=data.marginRow,marginDefined&&(marginColumn=data.margin,marginRow=data.margin),offsetRow=getOffsetItemIndex(data.align,rows),offsetColumn=getOffsetItemIndex(data.align,data.columns),row=0;row<rows;row++)for(column=0;column<data.columns;column++)positionHelper.set(0,0,0),0===data.plane.indexOf('x')&&(positionHelper.x=(column-offsetColumn)*marginColumn),0===data.plane.indexOf('y')&&(positionHelper.y=(column-offsetColumn)*marginColumn),1===data.plane.indexOf('y')&&(positionHelper.y=(row-offsetRow)*marginRow),1===data.plane.indexOf('z')&&(positionHelper.z=(row-offsetRow)*marginRow),pushPositionVec3(positionHelper);return positions}function getCirclePositions(data,numChildren){var i,rad;for(i=0;i<numChildren;i++)rad,rad=isNaN(data.angle)?i*(2*Math.PI)/numChildren:0.01745329252*(i*data.angle),positionHelper.set(0,0,0),0===data.plane.indexOf('x')&&(positionHelper.x=data.radius*_Mathcos(rad)),0===data.plane.indexOf('y')&&(positionHelper.y=data.radius*_Mathcos(rad)),1===data.plane.indexOf('y')&&(positionHelper.y=data.radius*_Mathsin(rad)),1===data.plane.indexOf('z')&&(positionHelper.z=data.radius*_Mathsin(rad)),pushPositionVec3(positionHelper);return positions}function getLinePositions(data,numChildren){return data.columns=numChildren,getBoxPositions(data,numChildren,!0)}function getCubePositions(data){return pushPositions(1,0,0,0,1,0,0,0,1,-1,0,0,0,-1,0,0,0,-1),scalePositions(data.radius/2),positions}function getDodecahedronPositions(data){var PHI=(1+2.23606797749979)/2,B=1/PHI,C=2-PHI,NB=-1*B,NC=-1*C;return pushPositions(-1,C,0,-1,NC,0,0,-1,C,0,-1,NC,0,1,C,0,1,NC,1,C,0,1,NC,0,B,B,B,B,B,NB,B,NB,B,B,NB,NB,C,0,1,C,0,-1,NB,B,B,NB,B,NB,NB,NB,B,NB,NB,NB,NC,0,1,NC,0,-1),scalePositions(data.radius/2),positions}function getPyramidPositions(data){var NEG_SQRT_1_3=-1/1.7320508075688772;return pushPositions(0,0,1.7320508075688772+NEG_SQRT_1_3,-1,0,NEG_SQRT_1_3,1,0,NEG_SQRT_1_3,0,2*0.816496580927726,0),scalePositions(data.radius/2),positions}function getOffsetItemIndex(align,numItems){return'start'===align?numItems-1:'center'===align?(numItems-1)/2:'end'===align?0:void 0}function scalePositions(scale){var i;for(i=0;i<positions.length;i++)positions[i]*=scale}function setPositions(els,positions,orderAttribute){var value,i,orderIndex;if(orderAttribute){for(i=0;i<els.length;i++)(value=els[i].getAttribute(orderAttribute),null!==value&&void 0!==value)&&(orderIndex=3*parseInt(value,10),els[i].object3D.position.set(positions[orderIndex],positions[orderIndex+1],positions[orderIndex+2]));return}for(i=0;i<positions.length;i+=3){if(!els[i/3])return;els[i/3].object3D.position.set(positions[i],positions[i+1],positions[i+2])}}function pushPositions(){var i;for(i=0;i<arguments.length;i++)positions.push(i)}function pushPositionVec3(vec3){positions.push(vec3.x),positions.push(vec3.y),positions.push(vec3.z)}var _Mathsin=Math.sin,_Mathcos=Math.cos,positions=[],positionHelper=new THREE.Vector3;AFRAME.registerComponent('layout',{schema:{angle:{type:'number',default:!1,min:0,max:360,if:{type:['circle']}},columns:{default:1,min:0,if:{type:['box']}},margin:{default:1,min:0,if:{type:['box','line']}},marginColumn:{default:1,min:0,if:{type:['box']}},marginRow:{default:1,min:0,if:{type:['box']}},orderAttribute:{default:''},plane:{default:'xy'},radius:{default:1,min:0,if:{type:['circle','cube','dodecahedron','pyramid']}},reverse:{default:!1},type:{default:'line',oneOf:['box','circle','cube','dodecahedron','line','pyramid']},fill:{default:!0,if:{type:['circle']}},align:{default:'end',oneOf:['start','center','end']}},init:function(){var self=this,el=this.el;this.children=el.getChildEntities(),this.initialPositions=[],this.children.forEach(function getInitialPositions(childEl){function _getPositions(){self.initialPositions.push(childEl.object3D.position.x),self.initialPositions.push(childEl.object3D.position.y),self.initialPositions.push(childEl.object3D.position.z)}return childEl.hasLoaded?_getPositions():void childEl.addEventListener('loaded',_getPositions)}),this.handleChildAttached=this.handleChildAttached.bind(this),this.handleChildDetached=this.handleChildDetached.bind(this),el.addEventListener('child-attached',this.handleChildAttached),el.addEventListener('child-detached',this.handleChildDetached),el.addEventListener('layoutrefresh',this.update.bind(this))},update:function(){var definedData,numChildren,positionFn,children=this.children,data=this.data,el=this.el;switch(numChildren=children.length,data.type){case'box':{positionFn=getBoxPositions;break}case'circle':{positionFn=getCirclePositions;break}case'cube':{positionFn=getCubePositions;break}case'dodecahedron':{positionFn=getDodecahedronPositions;break}case'pyramid':{positionFn=getPyramidPositions;break}default:positionFn=getLinePositions;}definedData=el.getDOMAttribute('layout'),positions.length=0,positions=positionFn(data,numChildren,'string'==typeof definedData?-1!==definedData.indexOf('margin'):'margin'in definedData),data.reverse&&positions.reverse(),setPositions(children,positions,data.orderAttribute)},remove:function(){this.el.removeEventListener('child-attached',this.handleChildAttached),this.el.removeEventListener('child-detached',this.handleChildDetached),setPositions(this.children,this.initialPositions)},handleChildAttached:function(evt){var el=this.el;evt.detail.el.parentNode!==el||(this.children.push(evt.detail.el),this.update())},handleChildDetached:function(evt){-1===this.children.indexOf(evt.detail.el)||(this.children.splice(this.children.indexOf(evt.detail.el),1),this.initialPositions.splice(this.children.indexOf(evt.detail.el),1),this.update())}}),module.exports.getBoxPositions=getBoxPositions,module.exports.getCirclePositions=getCirclePositions,module.exports.getLinePositions=getLinePositions,module.exports.getCubePositions=getCubePositions,module.exports.getDodecahedronPositions=getDodecahedronPositions,module.exports.getPyramidPositions=getPyramidPositions},function(module,exports,__webpack_require__){__webpack_require__(21),AFRAME.registerComponent('orbit-controls',{dependencies:['camera'],schema:{autoRotate:{type:'boolean'},autoRotateSpeed:{default:2},dampingFactor:{default:0.1},enabled:{default:!0},enableDamping:{default:!0},enableKeys:{default:!0},enablePan:{default:!0},enableRotate:{default:!0},enableZoom:{default:!0},initialPosition:{type:'vec3'},keyPanSpeed:{default:7},minAzimuthAngle:{type:'number',default:Infinity},maxAzimuthAngle:{type:'number',default:Infinity},maxDistance:{default:1e3},maxPolarAngle:{default:AFRAME.utils.device.isMobile()?90:120},minDistance:{default:1},minPolarAngle:{default:0},minZoom:{default:0},panSpeed:{default:1},rotateSpeed:{default:0.05},screenSpacePanning:{default:!1},target:{type:'vec3'},zoomSpeed:{default:0.5}},init:function(){var oldPosition,el=this.el;this.controls=new THREE.OrbitControls(el.getObject3D('camera'),el.sceneEl.renderer.domElement),oldPosition=new THREE.Vector3,el.sceneEl.addEventListener('enter-vr',()=>{(AFRAME.utils.device.checkHeadsetConnected()||AFRAME.utils.device.isMobile())&&(this.controls.enabled=!1,el.hasAttribute('look-controls')&&(el.setAttribute('look-controls','enabled',!0),oldPosition.copy(el.getObject3D('camera').position),el.getObject3D('camera').position.set(0,0,0)))}),el.sceneEl.addEventListener('exit-vr',()=>{(AFRAME.utils.device.checkHeadsetConnected()||AFRAME.utils.device.isMobile())&&(this.controls.enabled=!0,el.getObject3D('camera').position.copy(oldPosition),el.hasAttribute('look-controls')&&el.setAttribute('look-controls','enabled',!1))}),document.body.style.cursor='grab',document.addEventListener('mousedown',()=>{document.body.style.cursor='grabbing'}),document.addEventListener('mouseup',()=>{document.body.style.cursor='grab'}),this.target=new THREE.Vector3,el.getObject3D('camera').position.copy(this.data.initialPosition)},update:function(){var controls=this.controls,data=this.data;controls.target=this.target.copy(data.target),controls.autoRotate=data.autoRotate,controls.autoRotateSpeed=data.autoRotateSpeed,controls.dampingFactor=data.dampingFactor,controls.enabled=data.enabled,controls.enableDamping=data.enableDamping,controls.enableKeys=data.enableKeys,controls.enablePan=data.enablePan,controls.enableRotate=data.enableRotate,controls.enableZoom=data.enableZoom,controls.keyPanSpeed=data.keyPanSpeed,controls.maxPolarAngle=THREE.Math.degToRad(data.maxPolarAngle),controls.maxDistance=data.maxDistance,controls.minDistance=data.minDistance,controls.minPolarAngle=THREE.Math.degToRad(data.minPolarAngle),controls.minZoom=data.minZoom,controls.panSpeed=data.panSpeed,controls.rotateSpeed=data.rotateSpeed,controls.screenSpacePanning=data.screenSpacePanning,controls.zoomSpeed=data.zoomSpeed},tick:function(){var controls=this.controls,data=this.data;!data.enabled||controls.enabled&&(controls.enableDamping||controls.autoRotate)&&this.controls.update()}})},function(){AFRAME.registerComponent('proxy-event',{schema:{captureBubbles:{default:!1},enabled:{default:!0},event:{type:'string'},from:{type:'string'},to:{type:'string'},as:{type:'string'},bubbles:{default:!1}},multiple:!0,init:function(){var from,i,to,data=this.data,el=this.el,self=this;if(data.from?'PARENT'===data.from?from=[el.parentNode]:from=document.querySelectorAll(data.from):'CHILDREN'===data.to?to=el.querySelectorAll('*'):'SELF'===data.to?to=[el]:to=document.querySelectorAll(data.to),data.from)for(i=0;i<from.length;i++)this.addEventListenerFrom(from[i]);else el.addEventListener(data.event,function(evt){var data=self.data;if(data.enabled&&(data.captureBubbles||evt.target===el))for(i=0;i<to.length;i++)to[i].emit(data.as||data.event,evt.detail?evt.detail:null,data.bubbles)})},addEventListenerFrom:function(fromEl){var data=this.data,self=this;fromEl.addEventListener(data.event,function(evt){var data=self.data;data.enabled&&(data.captureBubbles||evt.target===fromEl)&&self.el.emit(data.as||data.event,evt.detail?evt.detail:null,!1)})}})},function(module){(function webpackUniversalModuleDefinition(root,factory){module.exports=factory()})('undefined'==typeof self?this:self,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};return __webpack_require__.d(getter,'a',getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p='',__webpack_require__(__webpack_require__.s=0)}([function(module,exports,__webpack_require__){if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');AFRAME.registerShader('ring',{schema:{blur:{default:0.01,is:'uniform'},color:{type:'color',is:'uniform'},progress:{default:0,is:'uniform'},radiusInner:{default:0.85,is:'uniform'},radiusOuter:{default:1,is:'uniform'}},vertexShader:__webpack_require__(1),fragmentShader:__webpack_require__(2)})},function(module){module.exports='varying vec2 vUv;\n\nvoid main () {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n'},function(module){module.exports='#define PI 3.14159265358979\nuniform float blur;\nuniform float progress;\nuniform float radiusInner;\nuniform float radiusOuter;\nuniform vec3 color;\n\nvarying vec2 vUv;\n\nvoid main () {\n  vec2 uv = vec2(vUv.x * 2. - 1., vUv.y * 2. - 1.);\n  float r = uv.x * uv.x + uv.y * uv.y;\n  float col = (1.0 - smoothstep(radiusOuter, radiusOuter + blur, r)) * smoothstep(radiusInner, radiusInner + blur, r);\n  float a = smoothstep(-PI, PI, atan(uv.y, uv.x));\n  float p = 1.0 - progress - blur;\n  col *= smoothstep(p, p + blur, a);\n  gl_FragColor = vec4(color * col, col);\n}\n'}])})},function(){function parseSide(side){return'back'===side?THREE.BackSide:'double'===side?THREE.DoubleSide:THREE.FrontSide}if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');AFRAME.registerComponent('slice9',{schema:{width:{default:1,min:0},height:{default:1,min:0},left:{default:0,min:0},right:{default:0,min:0},bottom:{default:0,min:0},top:{default:0,min:0},side:{default:'front',oneOf:['front','back','double']},padding:{default:0.1,min:0.01},color:{type:'color',default:'#fff'},opacity:{default:1,min:0,max:1},transparent:{default:!0},debug:{default:!1},src:{type:'map'}},multiple:!1,init:function(){var data=this.data,material=this.material=new THREE.MeshBasicMaterial({color:data.color,opacity:data.opacity,transparent:data.transparent,wireframe:data.debug}),geometry=this.geometry=new THREE.PlaneBufferGeometry(data.width,data.height,3,3),textureLoader=new THREE.TextureLoader;this.plane=new THREE.Mesh(geometry,material),this.el.setObject3D('mesh',this.plane),this.textureSrc=null},updateMap:function(){function setMap(texture){this.material.map=texture,this.material.needsUpdate=!0,this.regenerateMesh()}var src=this.data.src;return src?src===this.textureSrc?void 0:(this.textureSrc=src,void this.el.sceneEl.systems.material.loadTexture(src,{src:src},setMap.bind(this))):void(!this.material.map||setMap(null))},regenerateMesh:function(){function setPos(id,x,y){pos[3*id]=x,pos[3*id+1]=y}function setUV(id,u,v){uvs[2*id]=u,uvs[2*id+1]=v}var data=this.data,pos=this.geometry.attributes.position.array,uvs=this.geometry.attributes.uv.array,image=this.material.map.image;if(image){var uv={left:data.left/image.width,right:data.right/image.width,top:data.top/image.height,bottom:data.bottom/image.height};setUV(1,uv.left,1),setUV(2,uv.right,1),setUV(4,0,uv.bottom),setUV(5,uv.left,uv.bottom),setUV(6,uv.right,uv.bottom),setUV(7,1,uv.bottom),setUV(8,0,uv.top),setUV(9,uv.left,uv.top),setUV(10,uv.right,uv.top),setUV(11,1,uv.top),setUV(13,uv.left,0),setUV(14,uv.right,0);var w2=data.width/2,h2=data.height/2,left=-w2+data.padding,right=w2-data.padding,top=h2-data.padding,bottom=-h2+data.padding;setPos(0,-w2,h2),setPos(1,left,h2),setPos(2,right,h2),setPos(3,w2,h2),setPos(4,-w2,top),setPos(5,left,top),setPos(6,right,top),setPos(7,w2,top),setPos(8,-w2,bottom),setPos(9,left,bottom),setPos(10,right,bottom),setPos(11,w2,bottom),setPos(13,left,-h2),setPos(14,right,-h2),setPos(12,-w2,-h2),setPos(15,w2,-h2),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0}},update:function(oldData){var data=this.data;this.material.color.setStyle(data.color),this.material.opacity=data.opacity,this.material.transparent=data.transparent,this.material.wireframe=data.debug,this.material.side=parseSide(data.side);var diff=AFRAME.utils.diff(data,oldData);'src'in diff?this.updateMap():('width'in diff||'height'in diff||'padding'in diff||'left'in diff||'top'in diff||'bottom'in diff||'right'in diff)&&this.regenerateMesh()},remove:function(){},pause:function(){},play:function(){}})},function(module){(function webpackUniversalModuleDefinition(root,factory){module.exports=factory()})('undefined'==typeof self?this:self,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};return __webpack_require__.d(getter,'a',getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p='',__webpack_require__(__webpack_require__.s=1)}([function(module){'use strict';function generateExpression(str){return str=str.replace(DOT_NOTATION_RE,'["$1"]'),str=str.replace(ROOT_STATE_SELECTOR_RE,'$1state["$2"]'),str=str.replace(STATE_SELECTOR_RE,'$1$2$3state["$4"]'),str=str.replace(ITEM_RE,'item'),str}function composeFunctions(){var functions=arguments;return function(){var i;for(i=0;i<functions.length;i++)functions[i].apply(this,arguments)}}function parseKeyToWatch(str){var dotIndex;return str=stripNot(str.trim()),dotIndex=str.indexOf('.'),-1===dotIndex?str:str.substring(0,str.indexOf('.'))}function stripNot(str){if(0===str.indexOf('!!'))return str.replace('!!','');return 0===str.indexOf('!')?str.replace('!',''):str}function split(str,delimiter){return(SPLIT_CACHE[delimiter]||(SPLIT_CACHE[delimiter]={}),SPLIT_CACHE[delimiter][str])?SPLIT_CACHE[delimiter][str]:(SPLIT_CACHE[delimiter][str]=str.split(delimiter),SPLIT_CACHE[delimiter][str])}var selectFunctions={};module.exports.select=function select(state,selector,item){return selectFunctions[selector]||(selectFunctions[selector]=new Function('state','item','return '+generateExpression(selector)+';')),selectFunctions[selector](state,item)};var DOT_NOTATION_RE=/\.([A-Za-z][\w_-]*)/g,WHITESPACE_RE=/\s/g,STATE_SELECTOR_RE=/([=&|!?:+-])(\s*)([\(]?)([A-Za-z][\w_-]*)/g,ROOT_STATE_SELECTOR_RE=/^([\(]?)([A-Za-z][\w_-]*)/g,ITEM_RE=/state\["item"\]/g;module.exports.generateExpression=generateExpression,module.exports.clearObject=function clearObject(obj){for(var key in obj)delete obj[key]},module.exports.composeHandlers=function composeHandlers(){var actionName,i,outputHandlers,inputHandlers=arguments;for(outputHandlers={},i=0;i<inputHandlers.length;i++)for(actionName in inputHandlers[i])actionName in outputHandlers?outputHandlers[actionName].constructor===Array?outputHandlers[actionName].push(inputHandlers[i][actionName]):outputHandlers[actionName]=[outputHandlers[actionName],inputHandlers[i][actionName]]:outputHandlers[actionName]=inputHandlers[i][actionName];for(actionName in outputHandlers)outputHandlers[actionName].constructor===Array&&(outputHandlers[actionName]=composeFunctions.apply(this,outputHandlers[actionName]));return outputHandlers},module.exports.composeFunctions=composeFunctions;var NO_WATCH_TOKENS=['||','&&','!=','!==','==','===','>','<','<=','>='],WHITESPACE_PLUS_RE=/\s+/;module.exports.parseKeysToWatch=function parseKeysToWatch(keys,str,isBindItem){var i,tokens;for(tokens=split(str,WHITESPACE_PLUS_RE),i=0;i<tokens.length;i++)if(-1===NO_WATCH_TOKENS.indexOf(tokens[i])&&!tokens[i].startsWith('\'')&&-1===keys.indexOf(tokens[i])){if(isBindItem&&'item'===tokens[i])continue;keys.push(parseKeyToWatch(tokens[i]))}};var SPLIT_CACHE={};module.exports.split=split,module.exports.copyArray=function copyArray(dest,src){var i;for(dest.length=0,i=0;i<src.length;i++)dest[i]=src[i]}},function(module,exports,__webpack_require__){'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};__webpack_require__(2);var diff=__webpack_require__(3),lib=__webpack_require__(0),wrapArray=__webpack_require__(4).wrapArray,State={initialState:{},nonBindedStateKeys:[],handlers:{},computeState:function computeState(){}},TYPE_OBJECT='object',WHITESPACE_REGEX=/s+/;AFRAME.registerState=function(definition){AFRAME.utils.extend(State,definition)},AFRAME.registerSystem('state',{init:function init(){var key,_this=this;for(key in this.arrays=[],this.dirtyArrays=[],this.diff={},this.state=AFRAME.utils.clone(State.initialState),this.subscriptions=[],this.initEventHandlers(),this.state)this.state[key]&&this.state[key].constructor===Array&&(this.arrays.push(key),this.state[key].__dirty=!0,wrapArray(this.state[key]));this.lastState=AFRAME.utils.clone(this.state),this.eventDetail={lastState:this.lastState,state:this.state},this.el.addEventListener('loaded',function(){var i;for(State.computeState(_this.state,'@@INIT'),i=0;i<_this.subscriptions.length;i++)_this.subscriptions[i].onStateUpdate(_this.state)})},dispatch:function dispatch(actionName,payload){var i,key;for(key in State.handlers[actionName](this.state,payload),State.computeState(this.state,actionName,payload),this.diff)delete this.diff[key];for(diff(this.lastState,this.state,this.diff,State.nonBindedStateKeys),this.dirtyArrays.length=0,i=0;i<this.arrays.length;i++)this.state[this.arrays[i]].__dirty&&this.dirtyArrays.push(this.arrays[i]);for(i=0;i<this.subscriptions.length;i++){if('bind-for'===this.subscriptions[i].name){if(!this.state[this.subscriptions[i].keysToWatch[0]].__dirty)continue;}else if(!this.shouldUpdate(this.subscriptions[i].keysToWatch,this.diff,this.dirtyArrays))continue;this.subscriptions[i].onStateUpdate()}for(key in this.state)this.state[key]&&this.state[key].constructor===Array&&(this.state[key].__dirty=!1);this.copyState(this.lastState,this.state),this.eventDetail.action=actionName,this.eventDetail.payload=payload,this.el.emit('stateupdate',this.eventDetail)},copyState:function copyState(lastState,state,isRecursive){for(var key in state)if(isRecursive||-1===State.nonBindedStateKeys.indexOf(key)){if(state[key]&&state[key].constructor===Object){if(!(key in lastState)){lastState[key]=AFRAME.utils.clone(state[key]);continue}this.copyState(lastState[key],state[key],!0);continue}lastState[key]=state[key]}},subscribe:function subscribe(component){this.subscriptions.push(component)},unsubscribe:function unsubscribe(component){this.subscriptions.splice(this.subscriptions.indexOf(component),1)},shouldUpdate:function shouldUpdate(keysToWatch,diff,dirtyArrays){for(var i=0;i<keysToWatch.length;i++)if(keysToWatch[i]in diff||-1!==dirtyArrays.indexOf(keysToWatch[i]))return!0;return!1},initEventHandlers:function initEventHandlers(){function registerListener(actionName){var _this2=this;this.el.addEventListener(actionName,function(evt){_this2.dispatch(actionName,evt.detail)})}var actionName,registeredActions=[],self=this;for(actionName in registerListener=registerListener.bind(this),State.handlers)-1===registeredActions.indexOf(actionName)&&(registeredActions.push(actionName),registerListener(actionName))},renderTemplate:function(){var interpRegex=/{{\s*(\w*\.)?([\w.]+)\s*}}/g;return function(template,data,asString){var match,str;if(str=template,data)for(;match=interpRegex.exec(template);)str=str.replace(match[0],('undefined'==typeof data?'undefined':_typeof(data))===TYPE_OBJECT?lib.select(data,match[2])||'':data);return asString?str:document.createRange().createContextualFragment(str)}}(),select:lib.select}),AFRAME.registerComponent('bind',{schema:{default:{},parse:function parse(value){var data,i,properties,pair;if(value.constructor===Object)return value;if(-1===value.indexOf(':'))return value;for(data={},properties=lib.split(value,';'),i=0;i<properties.length;i++)pair=lib.split(properties[i].trim(),':'),data[pair[0]]=pair[1].trim();return data}},multiple:!0,init:function init(){var componentId,data=this.data;this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system=this.el.sceneEl.systems.state,this.id&&(componentId=lib.split(this.id,'__')[0]),this.isNamespacedBind=this.id&&componentId in AFRAME.components&&!AFRAME.components[componentId].isSingleProp||componentId in AFRAME.systems,this.lastData={},this.updateObj={},this.system.subscribe(this),this.onStateUpdate=this.onStateUpdate.bind(this)},update:function update(){var key,data=this.data;if(this.keysToWatch.length=0,'string'==typeof data)lib.parseKeysToWatch(this.keysToWatch,data);else for(key in data)lib.parseKeysToWatch(this.keysToWatch,data[key]);this.onStateUpdate()},onStateUpdate:function onStateUpdate(){var propertyName,stateSelector,state,value,hasKeys=!1,el=this.el;if(el.parentNode){if(this.isNamespacedBind&&lib.clearObject(this.updateObj),state=this.system.state,_typeof(this.data)!==TYPE_OBJECT){try{value=lib.select(state,this.data)}catch(e){throw new Error('[aframe-state-component] Key \''+this.data+'\' not found in state.'+(' #'+this.el.getAttribute('id')+'['+this.attrName+']'))}return('undefined'==typeof value?'undefined':_typeof(value))!==TYPE_OBJECT&&_typeof(this.lastData)!==TYPE_OBJECT&&this.lastData===value?void 0:(AFRAME.utils.entity.setComponentProperty(el,this.id,value),void(this.lastData=value))}for(propertyName in this.data){stateSelector=this.data[propertyName].trim();try{value=lib.select(state,stateSelector)}catch(e){throw console.log(e),new Error('[aframe-state-component] Key \''+stateSelector+'\' not found in state.'+(' #'+this.el.getAttribute('id')+'['+this.attrName+']'))}if(('undefined'==typeof value?'undefined':_typeof(value))===TYPE_OBJECT||_typeof(this.lastData[propertyName])===TYPE_OBJECT||this.lastData[propertyName]!==value){if(propertyName in AFRAME.components&&void 0===value)return void el.removeAttribute(propertyName);this.isNamespacedBind?this.updateObj[propertyName]=value:AFRAME.utils.entity.setComponentProperty(el,propertyName,value),this.lastData[propertyName]=value}}for(hasKeys in this.updateObj);this.isNamespacedBind&&hasKeys&&el.setAttribute(this.id,this.updateObj)}},remove:function remove(){this.system.unsubscribe(this)}}),AFRAME.registerComponent('bind-toggle',{schema:{type:'string'},multiple:!0,init:function init(){this.system=this.el.sceneEl.systems.state,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system.subscribe(this),this.onStateUpdate()},update:function update(){this.keysToWatch.length=0,lib.parseKeysToWatch(this.keysToWatch,this.data)},onStateUpdate:function onStateUpdate(){var state,value,el=this.el;state=this.system.state;try{value=lib.select(state,this.data)}catch(e){throw new Error('[aframe-state-component] Key \''+this.data+'\' not found in state.'+(' #'+this.el.getAttribute('id')+'['+this.attrName+']'))}value?el.setAttribute(this.id,''):el.removeAttribute(this.id)},remove:function remove(){this.system.unsubscribe(this)}}),module.exports={composeFunctions:lib.composeFunctions,composeHandlers:lib.composeHandlers,select:lib.select}},function(module,exports,__webpack_require__){'use strict';var lib=__webpack_require__(0),ITEM_RE=/item/,ITEM_PREFIX_RE=/item./,ITEM_SELECTOR_RE=/item.(\w+)/;AFRAME.registerComponent('bind-for',{schema:{delay:{default:0},for:{type:'string',default:'item'},in:{type:'string'},key:{type:'string'},pool:{default:0},template:{type:'string'},updateInPlace:{default:!1}},init:function init(){this.system=this.el.sceneEl.systems.state,this.onStateUpdate=this.onStateUpdate.bind(this),this.keysToWatch=[],this.renderedKeys=[],this.system.subscribe(this),this.template=this.el.children[0]&&'TEMPLATE'===this.el.children[0].tagName?this.el.children[0].innerHTML.trim():document.querySelector(this.data.template).innerHTML.trim();for(var i=0;i<this.data.pool;i++)this.el.appendChild(this.generateFromTemplate(null,i))},update:function update(){this.keysToWatch[0]=lib.split(this.data.in,'.')[0],this.onStateUpdate()},onStateUpdateNaive:function(){var activeKeys=[];return function(){var list,data=this.data,el=this.el;try{list=lib.select(this.system.state,data.in)}catch(e){throw new Error('[aframe-state-component] Key \''+data.in+'\' not found in state.'+(' #'+el.getAttribute('id')+'['+this.attrName+']'))}activeKeys.length=0;for(var item,i=0;i<list.length;i++)item=list[i],activeKeys.push(data.key?item[data.key].toString():item.toString());for(var toRemoveEls=this.getElsToRemove(activeKeys,this.renderedKeys),_i=0;_i<toRemoveEls.length;_i++)toRemoveEls[_i].parentNode.removeChild(toRemoveEls[_i]);list.length&&this.renderItems(list,activeKeys,0)}}(),renderItems:function renderItems(list,activeKeys,i){var itemEl,_this=this,data=this.data,el=this.el,item=list[i],keyValue=data.key?item[data.key].toString():item.toString();if(-1===this.renderedKeys.indexOf(keyValue))itemEl=this.generateFromTemplate(item,i),el.appendChild(itemEl),this.renderedKeys.push(keyValue);else{if(list.length&&list[0].constructor===String){var _keyValue=data.key?item[data.key].toString():item.toString();itemEl=el.querySelector('[data-bind-for-value="'+_keyValue+'"]'),itemEl.setAttribute('data-bind-for-key',i)}else{var bindForKey=this.getBindForKey(item,i);itemEl=el.querySelector('[data-bind-for-key="'+bindForKey+'"]')}itemEl.emit('bindforupdate',item,!1)}list[i+1]&&(this.data.delay?setTimeout(function(){_this.renderItems(list,activeKeys,i+1)},this.data.delay):this.renderItems(list,activeKeys,i+1))},onStateUpdateInPlace:function(){var activeKeys=[];return function(){var list,keyValue,data=this.data,el=this.el;try{list=lib.select(this.system.state,data.in)}catch(e){throw console.log(e),new Error('[aframe-state-component] Key \''+data.in+'\' not found in state.'+(' #'+el.getAttribute('id')+'['+this.attrName+']'))}activeKeys.length=0;for(var item,i=0;i<list.length;i++)item=list[i],keyValue=data.key?item[data.key].toString():item.toString(),activeKeys.push(keyValue);for(var toRemoveEls=this.getElsToRemove(activeKeys,this.renderedKeys),_i2=0;_i2<toRemoveEls.length;_i2++)toRemoveEls[_i2].object3D.visible=!1,toRemoveEls[_i2].setAttribute('data-bind-for-active','false'),toRemoveEls[_i2].removeAttribute('data-bind-for-key'),toRemoveEls[_i2].removeAttribute('data-bind-for-value'),toRemoveEls[_i2].emit('bindfordeactivate',null,!1),toRemoveEls[_i2].pause();list.length&&this.renderItemsInPlace(list,activeKeys,0)}}(),renderItemsInPlace:function renderItemsInPlace(list,activeKeys,i){var itemEl,_this2=this,data=this.data,el=this.el,item=list[i],bindForKey=this.getBindForKey(item,i),keyValue=data.key?item[data.key].toString():item.toString();if(-1===this.renderedKeys.indexOf(keyValue)){if(!el.querySelector(':scope > [data-bind-for-active="false"]')){var _itemEl=this.generateFromTemplate(item,i);_itemEl.addEventListener('loaded',function(){_itemEl.emit('bindforupdateinplace',item,!1)}),el.appendChild(_itemEl)}else itemEl=el.querySelector('[data-bind-for-active="false"]'),itemEl.setAttribute('data-bind-for-key',bindForKey),itemEl.setAttribute('data-bind-for-value',keyValue),itemEl.object3D.visible=!0,itemEl.play(),itemEl.setAttribute('data-bind-for-active','true'),itemEl.emit('bindforupdateinplace',item,!1);this.renderedKeys.push(keyValue)}else-1!==activeKeys.indexOf(keyValue)&&(list.length&&list[0].constructor===String?(itemEl=el.querySelector('[data-bind-for-value="'+keyValue+'"]'),itemEl.setAttribute('data-bind-for-key',i)):itemEl=el.querySelector('[data-bind-for-key="'+bindForKey+'"]'),itemEl.emit('bindforupdateinplace',item,!1));list[i+1]&&(this.data.delay?setTimeout(function(){_this2.renderItemsInPlace(list,activeKeys,i+1)},this.data.delay):this.renderItemsInPlace(list,activeKeys,i+1))},generateFromTemplate:function generateFromTemplate(item,i){var data=this.data;this.el.appendChild(this.system.renderTemplate(this.template,item));var newEl=this.el.children[this.el.children.length-1];if(!item)return newEl.setAttribute('data-bind-for-key',''),newEl.setAttribute('data-bind-for-active','false'),newEl;var bindForKey=this.getBindForKey(item,i);return newEl.setAttribute('data-bind-for-key',bindForKey),data.key||newEl.setAttribute('data-bind-for-value',item),newEl.setAttribute('data-bind-for-active','true'),newEl},getElsToRemove:function(){var toRemove=[];return function(activeKeys,renderedKeys){var data=this.data,el=this.el;toRemove.length=0;for(var i=0;i<el.children.length;i++)if('TEMPLATE'!==el.children[i].tagName){var key=data.key?el.children[i].getAttribute('data-bind-for-key'):el.children[i].getAttribute('data-bind-for-value');-1===activeKeys.indexOf(key)&&-1!==renderedKeys.indexOf(key)&&(toRemove.push(el.children[i]),renderedKeys.splice(renderedKeys.indexOf(key),1))}return toRemove}}(),getBindForKey:function getBindForKey(item,i){return this.data.key?item[this.data.key].toString():i.toString()},onStateUpdate:function onStateUpdate(){this.data.updateInPlace?this.onStateUpdateInPlace():this.onStateUpdateNaive()}}),AFRAME.registerComponent('bind-item',{schema:{type:'string'},multiple:!0,init:function init(){this.itemData=null,this.keysToWatch=[],this.prevValues={};var rootEl=this.rootEl=this.el.closest('[data-bind-for-key]');if(!rootEl)throw new Error('bind-item component must be attached to entity under a bind-for item.');rootEl.addEventListener('bindforupdateinplace',this.updateInPlace.bind(this)),rootEl.addEventListener('bindfordeactivate',this.deactivate.bind(this)),this.el.sceneEl.systems.state.subscribe(this)},update:function update(){this.parseSelector()},updateInPlace:function updateInPlace(evt){var propertyMap=this.propertyMap;if('false'!==this.rootEl.getAttribute('data-bind-for-active'))for(var property in evt&&(this.itemData=evt.detail),propertyMap){var value=this.select(this.itemData,propertyMap[property]);value!==this.prevValues[property]&&(AFRAME.utils.entity.setComponentProperty(this.el,property,value),this.prevValues[property]=value)}},onStateUpdate:function onStateUpdate(){this.updateInPlace()},select:function select(itemData,selector){return lib.select(this.el.sceneEl.systems.state.state,selector,itemData)},deactivate:function deactivate(){this.prevValues={}},parseSelector:function parseSelector(){var propertyMap=this.propertyMap={};this.keysToWatch.length=0;var componentName=lib.split(this.id,'__')[0];if(componentName in AFRAME.components&&!AFRAME.components[componentName].isSingleProp){for(var propertySplit,propertySplitList=lib.split(this.data,';'),i=0;i<propertySplitList.length;i++)propertySplit=lib.split(propertySplitList[i],':'),propertyMap[this.id+'.'+propertySplit[0].trim()]=propertySplit[1].trim(),lib.parseKeysToWatch(this.keysToWatch,propertySplit[1].trim(),!0);return}propertyMap[this.id]=this.data,lib.parseKeysToWatch(this.keysToWatch,this.data,!0)}})},function(module){'use strict';module.exports=function(){var keys=[];return function(a,b,targetObject,ignoreKeys){var aVal,bVal,bKey,diff,key,i,isComparingObjects;for(key in diff=targetObject||{},keys.length=0,a)keys.push(key);if(!b)return diff;for(bKey in b)-1===keys.indexOf(bKey)&&keys.push(bKey);for(i=0;i<keys.length;i++)(key=keys[i],!(ignoreKeys&&-1!==ignoreKeys.indexOf(key)))&&(aVal=a[key],bVal=b[key],isComparingObjects=aVal&&bVal&&aVal.constructor===Object&&bVal.constructor===Object,(!isComparingObjects||AFRAME.utils.deepEqual(aVal,bVal))&&(isComparingObjects||aVal===bVal)||(diff[key]=bVal));return diff}}()},function(module){'use strict';function makeCallDirty(arr,fn){var originalFn=arr[fn];arr[fn]=function(){originalFn.apply(arr,arguments),arr.__dirty=!0}}var fns=['push','pop','shift','unshift','splice'];module.exports.wrapArray=function wrapArray(arr){var i;if(!arr.__wrapped){for(i=0;i<fns.length;i++)makeCallDirty(arr,fns[i]);arr.__wrapped=!0}}}])})},function(){var TYPE_PAD='PAD',TYPE_STICK='STICK',ANGLES=[0,90,180,270],DIRECTIONS=['right','up','left','down'],EVENTS={NULL:{START:'thumbstart',END:'thumbend'}};DIRECTIONS.forEach(direction=>{EVENTS[direction]={},EVENTS[direction].START='thumb'+direction+'start',EVENTS[direction].END='thumb'+direction+'end'});var SIZE=240;AFRAME.registerComponent('thumb-controls',{dependencies:['tracked-controls'],schema:{thresholdAngle:{default:89.5},thresholdPad:{default:0.05},thresholdStick:{default:0.75}},init:function(){var el=this.el;this.onTrackpadDown=this.onTrackpadDown.bind(this),this.onTrackpadUp=this.onTrackpadUp.bind(this),this.directionStick='',this.directionTrackpad='',this.type=TYPE_STICK,el.addEventListener('controllerconnected',evt=>'oculus-touch-controls'===evt.detail.name||'windows-motion-controls'===evt.detail.name?void(this.type=TYPE_STICK):void(this.type=TYPE_PAD)),this.axis=el.components['tracked-controls'].axis},play:function(){var el=this.el;el.addEventListener('trackpaddown',this.onTrackpadDown),el.addEventListener('trackpadup',this.onTrackpadUp)},pause:function(){var el=this.el;el.removeEventListener('trackpaddown',this.onTrackpadDown),el.removeEventListener('trackpadup',this.onTrackpadUp)},onTrackpadDown:function(){var direction,el=this.el;this.getDistance()<this.data.thresholdPad||(direction=this.getDirection(),direction&&(this.directionTrackpad=direction,el.emit(EVENTS.NULL.START,null,!1),el.emit(EVENTS[this.directionTrackpad].START,null,!1)))},onTrackpadUp:function(){var el=this.el;this.directionTrackpad&&(el.emit(EVENTS.NULL.END,null,!1),el.emit(EVENTS[this.directionTrackpad].END,null,!1),this.directionTrackpad='')},tick:function(){var direction,el=this.el;return this.type===TYPE_PAD?void 0:!this.directionStick&&this.getDistance()>this.data.thresholdStick?(direction=this.getDirection(),!direction)?void 0:(this.directionStick=direction,el.emit(EVENTS.NULL.START,null,!1),void el.emit(EVENTS[this.directionStick].START,null,!1)):void(this.directionStick&&this.getDistance()<this.data.thresholdStick&&(el.emit(EVENTS.NULL.END,null,!1),el.emit(EVENTS[this.directionStick].END,null,!1),this.directionStick=''))},getDistance:function(){var axis=this.axis;return Math.sqrt(axis[1]*axis[1]+axis[0]*axis[0])},getDirection:function(){var angle,bottomThreshold,i,threshold,topThreshold;for(angle=this.getAngle(),threshold=this.data.thresholdAngle/2,i=0;i<ANGLES.length;i++){if(topThreshold=ANGLES[i]+threshold,360<topThreshold&&(topThreshold-=360),bottomThreshold=ANGLES[i]-threshold,0>bottomThreshold&&(angle>=360+bottomThreshold&&360>=angle||0<=angle&&angle<=topThreshold))return DIRECTIONS[i];if(angle>=bottomThreshold&&angle<=topThreshold)return DIRECTIONS[i]}},getAngle:function(){var angle,flipY,axis=this.axis;return flipY=this.type===TYPE_STICK?-1:1,angle=Math.atan2(axis[1]*flipY,axis[0]),0>angle&&(angle=2*Math.PI+angle),THREE.Math.radToDeg(angle)}}),AFRAME.registerComponent('thumb-controls-debug',{dependencies:['thumb-controls','tracked-controls'],schema:{controllerType:{type:'string'},hand:{type:'string'},enabled:{default:!1}},init:function(){var isActive,axis,axisMoveEventDetail,canvas,el=this.el,data=this.data;(data.enabled||AFRAME.utils.getUrlParameter('debug-thumb'))&&(console.log('%c debug-thumb','background: #111; color: red'),el.components['tracked-controls'].handleAxes=()=>{},axis=[0,0,0],axisMoveEventDetail={axis:axis},el.components['tracked-controls'].axis=axis,el.components['thumb-controls'].axis=axis,canvas=this.createCanvas(),canvas.addEventListener('click',()=>{'vive-controls'===this.data.controllerType?isActive?el.emit('trackpadup'):el.emit('trackpaddown'):isActive&&(axis[0]=0,axis[1]=0,el.emit('axismove',axisMoveEventDetail,!1)),isActive=!isActive}),canvas.addEventListener('mousemove',evt=>{var rect;isActive&&(rect=canvas.getBoundingClientRect(),axis[0]=2*((evt.clientX-rect.left)/SIZE)-1,axis[1]=2*((evt.clientY-rect.top)/SIZE)-1,el.emit('axismove',axisMoveEventDetail,!1))}),canvas.addEventListener('mouseleave',()=>{isActive&&(axis[0]=0,axis[1]=0,el.emit('axismove',axisMoveEventDetail,!1))}))},createCanvas:function(){var canvas,ctx;return canvas=document.createElement('canvas'),canvas.classList.add('debugThumb'),canvas.height=SIZE,canvas.width=SIZE,canvas.style.bottom=0,canvas.style.borderRadius='250px',canvas.style.opacity=0.5,canvas.style.position='fixed',canvas.style.zIndex=999999999,'left'===this.data.hand?canvas.style.left=0:canvas.style.right=0,ctx=canvas.getContext('2d'),ctx.fillStyle='#333',ctx.fillRect(0,0,SIZE,SIZE),document.body.appendChild(canvas),canvas}})},function(){'use strict';if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');var audioBufferCache={};AFRAME.registerComponent('audioanalyser',{schema:{buffer:{default:!1},beatDetectionDecay:{default:0.99},beatDetectionMinVolume:{default:15},beatDetectionThrottle:{default:250},enabled:{default:!0},enableBeatDetection:{default:!0},enableLevels:{default:!0},enableWaveform:{default:!0},enableVolume:{default:!0},fftSize:{default:2048},smoothingTimeConstant:{default:0.8},src:{parse:function parse(val){return val.constructor===String?val.startsWith('#')||val.startsWith('.')?document.querySelector(val):val:val}},unique:{default:!1}},init:function init(){this.audioEl=null,this.levels=null,this.waveform=null,this.volume=0,this.xhr=null,this.initContext()},update:function update(oldData){var analyser=this.analyser,data=this.data;(oldData.fftSize!==data.fftSize||oldData.smoothingTimeConstant!==data.smoothingTimeConstant)&&(analyser.fftSize=data.fftSize,analyser.smoothingTimeConstant=data.smoothingTimeConstant,this.levels=new Uint8Array(analyser.frequencyBinCount),this.waveform=new Uint8Array(analyser.fftSize));data.src&&this.refreshSource()},tick:function tick(t,dt){var volume,data=this.data;if(data.enabled){if((data.enableLevels||data.enableVolume)&&this.analyser.getByteFrequencyData(this.levels),data.enableWaveform&&this.analyser.getByteTimeDomainData(this.waveform),data.enableVolume||data.enableBeatDetection){for(var sum=0,i=0;i<this.levels.length;i++)sum+=this.levels[i];this.volume=sum/this.levels.length}data.enableBeatDetection&&(volume=this.volume,!this.beatCutOff&&(this.beatCutOff=volume),volume>this.beatCutOff&&volume>this.data.beatDetectionMinVolume?(this.el.emit('audioanalyserbeat',null,!1),this.beatCutOff=1.5*volume,this.beatTime=0):this.beatTime<=this.data.beatDetectionThrottle?this.beatTime+=dt:(this.beatCutOff*=this.data.beatDetectionDecay,this.beatCutOff=Math.max(this.beatCutOff,this.data.beatDetectionMinVolume)))}},initContext:function initContext(){var analyser,gainNode,data=this.data;this.context=new AudioContext,analyser=this.analyser=this.context.createAnalyser(),gainNode=this.gainNode=this.context.createGain(),gainNode.connect(analyser),analyser.connect(this.context.destination),analyser.fftSize=data.fftSize,analyser.smoothingTimeConstant=data.smoothingTimeConstant,this.levels=new Uint8Array(analyser.frequencyBinCount),this.waveform=new Uint8Array(analyser.fftSize)},refreshSource:function refreshSource(){var _this=this,analyser=this.analyser,data=this.data;data.buffer&&data.src.constructor===String?this.getBufferSource().then(function(source){_this.source=source,_this.source.connect(_this.gainNode)}):(this.source=this.getMediaSource(),this.source.connect(this.gainNode))},suspendContext:function suspendContext(){this.context.suspend()},resumeContext:function resumeContext(){this.context.resume()},fetchAudioBuffer:function fetchAudioBuffer(src){var _this2=this;return audioBufferCache[src]?audioBufferCache[src].constructor===Promise?audioBufferCache[src]:Promise.resolve(audioBufferCache[src]):(audioBufferCache[src]=new Promise(function(resolve){var xhr=_this2.xhr=new XMLHttpRequest;xhr.open('GET',src),xhr.responseType='arraybuffer',xhr.addEventListener('load',function(){_this2.context.decodeAudioData(xhr.response).then(function(audioBuffer){audioBufferCache[src]=audioBuffer,resolve(audioBuffer)}).catch(console.error)}),xhr.send()}),audioBufferCache[src])},getBufferSource:function getBufferSource(){var _this3=this,data=this.data;return this.fetchAudioBuffer(data.src).then(function(){var source;return source=_this3.context.createBufferSource(),source.buffer=audioBufferCache[data.src],_this3.el.emit('audioanalyserbuffersource',source,!1),source}).catch(console.error)},getMediaSource:function getMediaSource(){return this.data.src.constructor===String?(!this.audio&&(this.audio=document.createElement('audio'),this.audio.crossOrigin='anonymous'),this.audio.setAttribute('src',this.data.src)):this.audio=this.data.src,this.context.createMediaElementSource(this.audio)}})},function(module,exports,__webpack_require__){var content=__webpack_require__(72);'string'==typeof content&&(content=[[module.i,content,'']]);var transform,options={hmr:!0};options.transform=transform,options.insertInto=void 0;__webpack_require__(74)(content,options);content.locals&&(module.exports=content.locals),!1},function(module,exports,__webpack_require__){function webpackContext(req){return __webpack_require__(webpackContextResolve(req))}function webpackContextResolve(req){var id=map[req];if(!(id+1))throw new Error('Cannot find module \''+req+'\'.');return id}var map={"./active-color.js":25,"./audio-columns.js":26,"./beams.js":27,"./beat-hit-sound.js":28,"./beat-loader.js":29,"./beat.js":30,"./challenge-setter.js":31,"./console-shortcuts.js":32,"./copy-texture.js":33,"./cursor-mesh.js":34,"./debug-beat-loader.js":35,"./debug-controller.js":36,"./debug-cursor.js":37,"./debug-song-time.js":38,"./debug-state.js":39,"./fake-glow.js":40,"./floor-shader.js":41,"./gpu-preloader.js":42,"./history.js":43,"./keyboard-raycastable.js":44,"./materials.js":45,"./mine-fragments-loader.js":46,"./multiplier-ring.js":47,"./particleplayer.js":48,"./pause.js":49,"./pauser.js":50,"./play-sound.js":51,"./raycaster-target.js":52,"./song-controls.js":53,"./song-progress-ring.js":54,"./song.js":55,"./stage-colors.js":56,"./stage-lasers.js":57,"./stage-shader.js":58,"./stats-param.js":59,"./sub-object.js":60,"./super-keyboard.js":61,"./toggle-pause-play.js":62,"./twister.js":63,"./user-gesture.js":64,"./vertex-colors-buffer.js":65,"./visible-raycastable.js":66,"./wall-shader.js":67,"./wall.js":68};webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=18},function(module,exports,__webpack_require__){function webpackContext(req){return __webpack_require__(webpackContextResolve(req))}function webpackContextResolve(req){var id=map[req];if(!(id+1))throw new Error('Cannot find module \''+req+'\'.');return id}var map={"./index.js":71};webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=19},function(){THREE.BufferGeometryUtils={computeTangents:function(geometry){function handleTriangle(a,b,c){vA.fromArray(positions,3*a),vB.fromArray(positions,3*b),vC.fromArray(positions,3*c),uvA.fromArray(uvs,2*a),uvB.fromArray(uvs,2*b),uvC.fromArray(uvs,2*c);var x1=vB.x-vA.x,x2=vC.x-vA.x,y1=vB.y-vA.y,y2=vC.y-vA.y,z1=vB.z-vA.z,z2=vC.z-vA.z,s1=uvB.x-uvA.x,s2=uvC.x-uvA.x,t1=uvB.y-uvA.y,t2=uvC.y-uvA.y,r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r),tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r),tan1[a].add(sdir),tan1[b].add(sdir),tan1[c].add(sdir),tan2[a].add(tdir),tan2[b].add(tdir),tan2[c].add(tdir)}function handleVertex(v){n.fromArray(normals,3*v),n2.copy(n),t=tan1[v],tmp.copy(t),tmp.sub(n.multiplyScalar(n.dot(t))).normalize(),tmp2.crossVectors(n2,t),test=tmp2.dot(tan2[v]),w=0>test?-1:1,tangents[4*v]=tmp.x,tangents[4*v+1]=tmp.y,tangents[4*v+2]=tmp.z,tangents[4*v+3]=w}var index=geometry.index,attributes=geometry.attributes;if(null===index||void 0===attributes.position||void 0===attributes.normal||void 0===attributes.uv)return void console.warn('THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()');var indices=index.array,positions=attributes.position.array,normals=attributes.normal.array,uvs=attributes.uv.array,nVertices=positions.length/3;attributes.tangent===void 0&&geometry.addAttribute('tangent',new THREE.BufferAttribute(new Float32Array(4*nVertices),4));for(var tangents=attributes.tangent.array,tan1=[],tan2=[],i=0;i<nVertices;i++)tan1[i]=new THREE.Vector3,tan2[i]=new THREE.Vector3;var vA=new THREE.Vector3,vB=new THREE.Vector3,vC=new THREE.Vector3,uvA=new THREE.Vector2,uvB=new THREE.Vector2,uvC=new THREE.Vector2,sdir=new THREE.Vector3,tdir=new THREE.Vector3,groups=geometry.groups;0===groups.length&&(groups=[{start:0,count:indices.length}]);for(var i=0,il=groups.length;i<il;++i)for(var group=groups[i],start=group.start,count=group.count,j=start,jl=start+count;j<jl;j+=3)handleTriangle(indices[j+0],indices[j+1],indices[j+2]);for(var w,t,test,tmp=new THREE.Vector3,tmp2=new THREE.Vector3,n=new THREE.Vector3,n2=new THREE.Vector3,i=0,il=groups.length;i<il;++i)for(var group=groups[i],start=group.start,count=group.count,j=start,jl=start+count;j<jl;j+=3)handleVertex(indices[j+0]),handleVertex(indices[j+1]),handleVertex(indices[j+2])},mergeBufferGeometries:function(geometries,useGroups){for(var geometry,isIndexed=null!==geometries[0].index,attributesUsed=new Set(Object.keys(geometries[0].attributes)),morphAttributesUsed=new Set(Object.keys(geometries[0].morphAttributes)),attributes={},morphAttributes={},mergedGeometry=new THREE.BufferGeometry,offset=0,i=0;i<geometries.length;++i){if(geometry=geometries[i],isIndexed!=(null!==geometry.index))return null;for(var name in geometry.attributes){if(!attributesUsed.has(name))return null;void 0===attributes[name]&&(attributes[name]=[]),attributes[name].push(geometry.attributes[name])}for(var name in geometry.morphAttributes){if(!morphAttributesUsed.has(name))return null;void 0===morphAttributes[name]&&(morphAttributes[name]=[]),morphAttributes[name].push(geometry.morphAttributes[name])}if(mergedGeometry.userData&&(mergedGeometry.userData.mergedUserData=mergedGeometry.userData.mergedUserData||[],mergedGeometry.userData.mergedUserData.push(geometry.userData)),useGroups){var count;if(isIndexed)count=geometry.index.count;else if(void 0!==geometry.attributes.position)count=geometry.attributes.position.count;else return null;mergedGeometry.addGroup(offset,count,i),offset+=count}}if(isIndexed){for(var index,indexOffset=0,mergedIndex=[],i=0;i<geometries.length;++i){index=geometries[i].index;for(var j=0;j<index.count;++j)mergedIndex.push(index.getX(j)+indexOffset);indexOffset+=geometries[i].attributes.position.count}mergedGeometry.setIndex(mergedIndex)}for(var name in attributes){var mergedAttribute=this.mergeBufferAttributes(attributes[name]);if(!mergedAttribute)return null;mergedGeometry.addAttribute(name,mergedAttribute)}for(var name in morphAttributes){var numMorphTargets=morphAttributes[name][0].length;if(0===numMorphTargets)break;mergedGeometry.morphAttributes=mergedGeometry.morphAttributes||{},mergedGeometry.morphAttributes[name]=[];for(var morphAttributesToMerge,i=0;i<numMorphTargets;++i){morphAttributesToMerge=[];for(var j=0;j<morphAttributes[name].length;++j)morphAttributesToMerge.push(morphAttributes[name][j][i]);var mergedMorphAttribute=this.mergeBufferAttributes(morphAttributesToMerge);if(!mergedMorphAttribute)return null;mergedGeometry.morphAttributes[name].push(mergedMorphAttribute)}}return mergedGeometry},mergeBufferAttributes:function(attributes){for(var TypedArray,itemSize,normalized,attribute,arrayLength=0,i=0;i<attributes.length;++i){if(attribute=attributes[i],attribute.isInterleavedBufferAttribute)return null;if(void 0==TypedArray&&(TypedArray=attribute.array.constructor),TypedArray!==attribute.array.constructor)return null;if(void 0==itemSize&&(itemSize=attribute.itemSize),itemSize!==attribute.itemSize)return null;if(void 0==normalized&&(normalized=attribute.normalized),normalized!==attribute.normalized)return null;arrayLength+=attribute.array.length}for(var array=new TypedArray(arrayLength),offset=0,i=0;i<attributes.length;++i)array.set(attributes[i].array,offset),offset+=attributes[i].array.length;return new THREE.BufferAttribute(array,itemSize,normalized)}}},function(){var _Mathmin=Math.min,_Mathmax=Math.max,_Mathsqrt=Math.sqrt,_MathPI=Math.PI;THREE.OrbitControls=function(object,domElement){function getAutoRotationAngle(){return 2*_MathPI/60/60*scope.autoRotateSpeed}function getZoomScale(){return Math.pow(0.95,scope.zoomSpeed)}function rotateLeft(angle){sphericalDelta.theta-=angle}function rotateUp(angle){sphericalDelta.phi-=angle}function dollyIn(dollyScale){scope.object.isPerspectiveCamera?scale/=dollyScale:scope.object.isOrthographicCamera?(scope.object.zoom=_Mathmax(scope.minZoom,_Mathmin(scope.maxZoom,scope.object.zoom*dollyScale)),scope.object.updateProjectionMatrix(),zoomChanged=!0):(console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.'),scope.enableZoom=!1)}function dollyOut(dollyScale){scope.object.isPerspectiveCamera?scale*=dollyScale:scope.object.isOrthographicCamera?(scope.object.zoom=_Mathmax(scope.minZoom,_Mathmin(scope.maxZoom,scope.object.zoom/dollyScale)),scope.object.updateProjectionMatrix(),zoomChanged=!0):(console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.'),scope.enableZoom=!1)}function handleMouseDownRotate(event){rotateStart.set(event.clientX,event.clientY)}function handleMouseDownDolly(event){dollyStart.set(event.clientX,event.clientY)}function handleMouseDownPan(event){panStart.set(event.clientX,event.clientY)}function handleMouseMoveRotate(event){rotateEnd.set(event.clientX,event.clientY),rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;rotateLeft(2*_MathPI*rotateDelta.x/element.clientWidth*scope.rotateSpeed),rotateUp(2*_MathPI*rotateDelta.y/element.clientHeight*scope.rotateSpeed),rotateStart.copy(rotateEnd),scope.update()}function handleMouseMoveDolly(event){dollyEnd.set(event.clientX,event.clientY),dollyDelta.subVectors(dollyEnd,dollyStart),0<dollyDelta.y?dollyIn(getZoomScale()):0>dollyDelta.y&&dollyOut(getZoomScale()),dollyStart.copy(dollyEnd),scope.update()}function handleMouseMovePan(event){panEnd.set(event.clientX,event.clientY),panDelta.subVectors(panEnd,panStart),pan(panDelta.x,panDelta.y),panStart.copy(panEnd),scope.update()}function handleMouseUp(){}function handleMouseWheel(event){0>event.deltaY?dollyOut(getZoomScale()):0<event.deltaY&&dollyIn(getZoomScale()),scope.update()}function handleKeyDown(event){switch(event.keyCode){case scope.keys.UP:pan(0,scope.keyPanSpeed),scope.update();break;case scope.keys.BOTTOM:pan(0,-scope.keyPanSpeed),scope.update();break;case scope.keys.LEFT:pan(scope.keyPanSpeed,0),scope.update();break;case scope.keys.RIGHT:pan(-scope.keyPanSpeed,0),scope.update();}}function handleTouchStartRotate(event){rotateStart.set(event.touches[0].pageX,event.touches[0].pageY)}function handleTouchStartDolly(event){var dx=event.touches[0].pageX-event.touches[1].pageX,dy=event.touches[0].pageY-event.touches[1].pageY,distance=_Mathsqrt(dx*dx+dy*dy);dollyStart.set(0,distance)}function handleTouchStartPan(event){panStart.set(event.touches[0].pageX,event.touches[0].pageY)}function handleTouchMoveRotate(event){rotateEnd.set(event.touches[0].pageX,event.touches[0].pageY),rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;rotateLeft(2*_MathPI*rotateDelta.x/element.clientWidth*scope.rotateSpeed),rotateUp(2*_MathPI*rotateDelta.y/element.clientHeight*scope.rotateSpeed),rotateStart.copy(rotateEnd),scope.update()}function handleTouchMoveDolly(event){var dx=event.touches[0].pageX-event.touches[1].pageX,dy=event.touches[0].pageY-event.touches[1].pageY,distance=_Mathsqrt(dx*dx+dy*dy);dollyEnd.set(0,distance),dollyDelta.subVectors(dollyEnd,dollyStart),0<dollyDelta.y?dollyOut(getZoomScale()):0>dollyDelta.y&&dollyIn(getZoomScale()),dollyStart.copy(dollyEnd),scope.update()}function handleTouchMovePan(event){panEnd.set(event.touches[0].pageX,event.touches[0].pageY),panDelta.subVectors(panEnd,panStart),pan(panDelta.x,panDelta.y),panStart.copy(panEnd),scope.update()}function handleTouchEnd(){}function onMouseDown(event){if(!1!==scope.enabled){switch(event.preventDefault(),event.button){case scope.mouseButtons.ORBIT:if(!1===scope.enableRotate)return;handleMouseDownRotate(event),state=STATE.ROTATE;break;case scope.mouseButtons.ZOOM:if(!1===scope.enableZoom)return;handleMouseDownDolly(event),state=STATE.DOLLY;break;case scope.mouseButtons.PAN:if(!1===scope.enablePan)return;handleMouseDownPan(event),state=STATE.PAN;}state!==STATE.NONE&&(document.addEventListener('mousemove',onMouseMove,!1),document.addEventListener('mouseup',onMouseUp,!1),scope.dispatchEvent(startEvent))}}function onMouseMove(event){if(!1!==scope.enabled)switch(event.preventDefault(),state){case STATE.ROTATE:if(!1===scope.enableRotate)return;handleMouseMoveRotate(event);break;case STATE.DOLLY:if(!1===scope.enableZoom)return;handleMouseMoveDolly(event);break;case STATE.PAN:if(!1===scope.enablePan)return;handleMouseMovePan(event);}}function onMouseUp(event){!1===scope.enabled||(handleMouseUp(event),document.removeEventListener('mousemove',onMouseMove,!1),document.removeEventListener('mouseup',onMouseUp,!1),scope.dispatchEvent(endEvent),state=STATE.NONE)}function onMouseWheel(event){!1===scope.enabled||!1===scope.enableZoom||state!==STATE.NONE&&state!==STATE.ROTATE||(event.preventDefault(),event.stopPropagation(),scope.dispatchEvent(startEvent),handleMouseWheel(event),scope.dispatchEvent(endEvent))}function onKeyDown(event){!1===scope.enabled||!1===scope.enableKeys||!1===scope.enablePan||handleKeyDown(event)}function onTouchStart(event){if(!1!==scope.enabled){switch(event.touches.length){case 1:if(!1===scope.enableRotate)return;handleTouchStartRotate(event),state=STATE.TOUCH_ROTATE;break;case 2:if(!1===scope.enableZoom)return;handleTouchStartDolly(event),state=STATE.TOUCH_DOLLY;break;case 3:if(!1===scope.enablePan)return;handleTouchStartPan(event),state=STATE.TOUCH_PAN;break;default:state=STATE.NONE;}state!==STATE.NONE&&scope.dispatchEvent(startEvent)}}function onTouchMove(event){if(!1!==scope.enabled)switch(event.preventDefault(),event.stopPropagation(),event.touches.length){case 1:if(!1===scope.enableRotate)return;if(state!==STATE.TOUCH_ROTATE)return;handleTouchMoveRotate(event);break;case 2:if(!1===scope.enableZoom)return;if(state!==STATE.TOUCH_DOLLY)return;handleTouchMoveDolly(event);break;case 3:if(!1===scope.enablePan)return;if(state!==STATE.TOUCH_PAN)return;handleTouchMovePan(event);break;default:state=STATE.NONE;}}function onTouchEnd(event){!1===scope.enabled||(handleTouchEnd(event),scope.dispatchEvent(endEvent),state=STATE.NONE)}function onContextMenu(event){!1===scope.enabled||event.preventDefault()}this.object=object,this.domElement=domElement===void 0?document:domElement,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=_MathPI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=0.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return spherical.phi},this.getAzimuthalAngle=function(){return spherical.theta},this.saveState=function(){scope.target0.copy(scope.target),scope.position0.copy(scope.object.position),scope.zoom0=scope.object.zoom},this.reset=function(){scope.target.copy(scope.target0),scope.object.position.copy(scope.position0),scope.object.zoom=scope.zoom0,scope.object.updateProjectionMatrix(),scope.dispatchEvent(changeEvent),scope.update(),state=STATE.NONE},this.update=function(){var offset=new THREE.Vector3,quat=new THREE.Quaternion().setFromUnitVectors(object.up,new THREE.Vector3(0,1,0)),quatInverse=quat.clone().inverse(),lastPosition=new THREE.Vector3,lastQuaternion=new THREE.Quaternion;return function update(){var position=scope.object.position;return offset.copy(position).sub(scope.target),offset.applyQuaternion(quat),spherical.setFromVector3(offset),scope.autoRotate&&state===STATE.NONE&&rotateLeft(getAutoRotationAngle()),spherical.theta+=sphericalDelta.theta,spherical.phi+=sphericalDelta.phi,spherical.theta=_Mathmax(scope.minAzimuthAngle,_Mathmin(scope.maxAzimuthAngle,spherical.theta)),spherical.phi=_Mathmax(scope.minPolarAngle,_Mathmin(scope.maxPolarAngle,spherical.phi)),spherical.makeSafe(),spherical.radius*=scale,spherical.radius=_Mathmax(scope.minDistance,_Mathmin(scope.maxDistance,spherical.radius)),scope.target.add(panOffset),offset.setFromSpherical(spherical),offset.applyQuaternion(quatInverse),position.copy(scope.target).add(offset),scope.object.lookAt(scope.target),!0===scope.enableDamping?(sphericalDelta.theta*=1-scope.dampingFactor,sphericalDelta.phi*=1-scope.dampingFactor):sphericalDelta.set(0,0,0),scale=1,panOffset.set(0,0,0),(zoomChanged||lastPosition.distanceToSquared(scope.object.position)>EPS||8*(1-lastQuaternion.dot(scope.object.quaternion))>EPS)&&(scope.dispatchEvent(changeEvent),lastPosition.copy(scope.object.position),lastQuaternion.copy(scope.object.quaternion),zoomChanged=!1,!0)}}(),this.dispose=function(){scope.domElement.removeEventListener('contextmenu',onContextMenu,!1),scope.domElement.removeEventListener('mousedown',onMouseDown,!1),scope.domElement.removeEventListener('wheel',onMouseWheel,!1),scope.domElement.removeEventListener('touchstart',onTouchStart,!1),scope.domElement.removeEventListener('touchend',onTouchEnd,!1),scope.domElement.removeEventListener('touchmove',onTouchMove,!1),document.removeEventListener('mousemove',onMouseMove,!1),document.removeEventListener('mouseup',onMouseUp,!1),window.removeEventListener('keydown',onKeyDown,!1)};var scope=this,changeEvent={type:'change'},startEvent={type:'start'},endEvent={type:'end'},STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},state=STATE.NONE,EPS=1e-6,spherical=new THREE.Spherical,sphericalDelta=new THREE.Spherical,scale=1,panOffset=new THREE.Vector3,zoomChanged=!1,rotateStart=new THREE.Vector2,rotateEnd=new THREE.Vector2,rotateDelta=new THREE.Vector2,panStart=new THREE.Vector2,panEnd=new THREE.Vector2,panDelta=new THREE.Vector2,dollyStart=new THREE.Vector2,dollyEnd=new THREE.Vector2,dollyDelta=new THREE.Vector2,panLeft=function(){var v=new THREE.Vector3;return function panLeft(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,0),v.multiplyScalar(-distance),panOffset.add(v)}}(),panUp=function(){var v=new THREE.Vector3;return function panUp(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,1),v.multiplyScalar(distance),panOffset.add(v)}}(),pan=function(){var offset=new THREE.Vector3;return function pan(deltaX,deltaY){var element=scope.domElement===document?scope.domElement.body:scope.domElement;if(scope.object.isPerspectiveCamera){var position=scope.object.position;offset.copy(position).sub(scope.target);var targetDistance=offset.length();targetDistance*=Math.tan(scope.object.fov/2*_MathPI/180),panLeft(2*deltaX*targetDistance/element.clientHeight,scope.object.matrix),panUp(2*deltaY*targetDistance/element.clientHeight,scope.object.matrix)}else scope.object.isOrthographicCamera?(panLeft(deltaX*(scope.object.right-scope.object.left)/scope.object.zoom/element.clientWidth,scope.object.matrix),panUp(deltaY*(scope.object.top-scope.object.bottom)/scope.object.zoom/element.clientHeight,scope.object.matrix)):(console.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.'),scope.enablePan=!1)}}();scope.domElement.addEventListener('contextmenu',onContextMenu,!1),scope.domElement.addEventListener('mousedown',onMouseDown,!1),scope.domElement.addEventListener('wheel',onMouseWheel,!1),scope.domElement.addEventListener('touchstart',onTouchStart,!1),scope.domElement.addEventListener('touchend',onTouchEnd,!1),scope.domElement.addEventListener('touchmove',onTouchMove,!1),window.addEventListener('keydown',onKeyDown,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn('THREE.OrbitControls: .center has been renamed to .target'),this.target}},noZoom:{get:function(){return console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.'),!this.enableZoom},set:function(value){console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.'),this.enableZoom=!value}},noRotate:{get:function(){return console.warn('THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.'),!this.enableRotate},set:function(value){console.warn('THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.'),this.enableRotate=!value}},noPan:{get:function(){return console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.'),!this.enablePan},set:function(value){console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.'),this.enablePan=!value}},noKeys:{get:function(){return console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.'),!this.enableKeys},set:function(value){console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.'),this.enableKeys=!value}},staticMoving:{get:function(){return console.warn('THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.'),!this.enableDamping},set:function(value){console.warn('THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.'),this.enableDamping=!value}},dynamicDampingFactor:{get:function(){return console.warn('THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.'),this.dampingFactor},set:function(value){console.warn('THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.'),this.dampingFactor=value}}})},function(module){module.exports={vertexShader:`
    varying vec2 uvs;
    void main() {
      uvs.xy = uv.xy;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }
  `,fragmentShader:`
    varying vec2 uvs;
    uniform sampler2D src;

    void main() {
      gl_FragColor = texture2D(src, uvs);
    }
`}},function(module){module.exports={vertexShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    uniform vec3 tunnelNeon;
    uniform vec3 leftLaser;
    uniform vec3 rightLaser;
    uniform vec3 floorNeon;
    uniform vec3 textGlow;
    uniform sampler2D src;

    void main() {
      float mask;
      vec4 col = texture2D(src, uvs);

      // tunnel neon
      mask = step(0.87, uvs.x) *  step(0.5, uvs.y) * (1.0 - step(0.935, uvs.x)) * ( 1.0 - step(0.75, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * tunnelNeon, mask);

      // floor & corridor neons
      mask = step(0.935, uvs.x) * step(0.5, uvs.y) * ( 1.0 - step(0.75, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * floorNeon, mask);

      // left laser
      mask = step(0.5, uvs.x) * (1.0 - step(0.625, uvs.x)) * (1.0 - step(0.5, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * leftLaser, mask);

      // right laser
      mask = step(0.625, uvs.x) * (1.0 - step(0.75, uvs.x)) * (1.0 - step(0.5, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * rightLaser, mask);

      // text glows
      mask = step(0.87, uvs.x) *  step(0.25, uvs.y) * (1.0 - step(0.935, uvs.x)) * ( 1.0 - step(0.5, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * textGlow, mask);

      gl_FragColor = col;
    }
  `}},function(module){module.exports={vertexShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    #define FOG_RADIUS  55.0
    #define FOG_FALLOFF 48.0
    #define FOG_COLOR_MULT 0.8
    varying vec2 uvs;
    varying vec3 worldPos;
    uniform vec3 skyColor;
    uniform vec3 backglowColor;
    uniform sampler2D src;

    void main() {
      vec4 col = texture2D(src, uvs);
      float mask;

      // bg
      mask = step(0.5, uvs.x);
      col.xyz = mix(col.xyz * skyColor, col.xyz, mask);

      // backglow
      mask = step(0.5, uvs.x) * step(0.5, uvs.y) * (1.0 - step(0.75, uvs.x));
      col.xyz = mix(col.xyz, col.xyz * backglowColor, mask);

      float fogDensity = 1.0 - pow(clamp(distance(worldPos, vec3(0., 0., -FOG_RADIUS)) / FOG_FALLOFF, 0.0, 1.0), 1.5);
      fogDensity += clamp(0.2 - pow(distance(worldPos, vec3(0.0, 0.0, worldPos.z)) / 10.0, 2.0), 0.0, 1.0);
      col.xyz = mix(col.xyz, backglowColor * FOG_COLOR_MULT, fogDensity);

      gl_FragColor = col;
    }
  `}},function(){AFRAME.registerComponent('active-color',{dependencies:['material'],schema:{active:{default:!1},color:{default:'#ffffff'}},init:function(){this.defaultColor=this.el.getAttribute('material').color,this.materialObj={color:this.data.color,opacity:1}},update:function(){var el=this.el;this.data.active?(el.setAttribute('material',this.materialObj),el.object3D.visible=!0):(el.setAttribute('material','color',this.defaultColor),el.components.animation__mouseleave&&setTimeout(()=>{el.emit('mouseleave',null,!1)}))}}),AFRAME.registerComponent('active-text-color',{dependencies:['text'],schema:{active:{default:!1},color:{default:'#333'}},init:function(){this.defaultColor=this.el.getAttribute('text').color},update:function(){var el=this.el;this.data.active?el.setAttribute('text','color',this.data.color):el.setAttribute('text','color',this.defaultColor)}})},function(){const NUM_VALUES_PER_BOX=90;AFRAME.registerComponent('audio-columns',{schema:{analyser:{type:'selector',default:'#audioAnalyser'},height:{default:1},mirror:{default:3},scale:{default:4},separation:{default:0.3},thickness:{default:0.1}},init:function(){var objData=document.getElementById('audiocolumnObj').data,loader=new THREE.OBJLoader,columnGeometry=loader.parse(objData).children[0].geometry;this.analyser=this.data.analyser.components.audioanalyser,this.frequencyBinCount=this.analyser.data.fftSize/2;const geometries=[];let zPosition=0;for(let i=0;i<this.frequencyBinCount;i++)for(let side=0;2>side;side++){const box=columnGeometry.clone();this.initBox(box,0===side?1:-1,zPosition),geometries.push(box),zPosition-=this.data.separation}this.geometry=THREE.BufferGeometryUtils.mergeBufferGeometries(geometries);const mesh=new THREE.Mesh(this.geometry,this.el.sceneEl.systems.materials.stageNormal);this.el.setObject3D('mesh',mesh)},tick:function(){for(let yScale,i=0;i<2*this.frequencyBinCount;i+=2){if(yScale=this.data.height/2+this.analyser.levels[Math.floor(i/2)]/256*this.data.scale,isNaN(yScale))return;this.setBoxHeight(2*this.frequencyBinCount-i-1,yScale),this.setBoxHeight(2*this.frequencyBinCount-i-2,yScale),this.geometry.attributes.position.needsUpdate=!0}},initBox:function(box,flip,zPosition){const data=this.data;for(let v=0;v<box.attributes.position.array.length;v+=3)box.attributes.position.array[v+2]+=zPosition,box.attributes.position.array[v+1]*=data.height/2,box.attributes.position.array[v]+=flip*data.mirror},setBoxHeight:function(boxNumber,height){const boxIndex=boxNumber*NUM_VALUES_PER_BOX;for(let yValue,i=boxIndex;i<boxIndex+NUM_VALUES_PER_BOX;i+=3)yValue=this.geometry.attributes.position.array[i+1],this.geometry.attributes.position.array[i+1]=0<=yValue?height:-1*height}})},function(){const ANIME=AFRAME.ANIME||AFRAME.anime;AFRAME.registerComponent('beams',{schema:{isPlaying:{default:!1},poolSize:{default:3}},init:function(){this.beams=[],this.currentRed=0,this.currentBlue=0,this.clearBeams=this.clearBeams.bind(this),this.el.sceneEl.addEventListener('cleargame',this.clearBeams)},update:function(){for(let i=0;i<this.beams.length;i++)this.beams[i].time&&(this.beams[i].visible=this.data.isPlaying)},play:function(){var objData,loader,redGeometry,blueGeometry,loader=new THREE.OBJLoader;objData=document.getElementById('redbeamObj').data,redGeometry=loader.parse(objData).children[0].geometry,objData=document.getElementById('bluebeamObj').data,blueGeometry=loader.parse(objData).children[0].geometry,this.redBeams=this.createBeamPool(redGeometry,this.el.sceneEl.systems.materials.stageAdditive),this.blueBeams=this.createBeamPool(blueGeometry,this.el.sceneEl.systems.materials.stageAdditive)},tick:function(t,dt){if(this.data.isPlaying)for(let beam,i=0;i<this.beams.length;i++)(beam=this.beams[i],!!beam.visible)&&(beam.time+=dt,beam.animation.tick(beam.time))},createBeamPool:function(geometry,material){const beams=[];for(let beam,i=0;i<this.data.poolSize;i++)beam=new THREE.Mesh(geometry,material),beam.visible=!1,beam.animation=ANIME({autoplay:!1,targets:beam.scale,x:1e-5,duration:300,easing:'easeInCubic',complete:()=>{beam.visible=!1}}),this.el.object3D.add(beam),beams.push(beam),this.beams.push(beam);return beams},newBeam:function(color,position){var beam;'red'===color?(beam=this.redBeams[this.currentRed],this.currentRed=(this.currentRed+1)%this.redBeams.length,beam.position.set(position.x,position.y,position.z+this.currentRed/50)):(beam=this.blueBeams[this.currentBlue],this.currentBlue=(this.currentBlue+1)%this.blueBeams.length,beam.position.set(position.x,position.y,position.z+this.currentBlue/50)),beam.visible=!0,beam.scale.x=1,beam.time=0},clearBeams:function(){for(let i=0;i<this.beams.length;i++)this.beams[i].visible=!1,this.beams[i].time=0,this.beams[i].scale.x=1}})},function(){var sourceCreatedCallback,audioContext=new window.AudioContext;const LAYER_BOTTOM='bottom',LAYER_TOP='top',VOLUME=0.25;THREE.Audio.prototype.play=function(){if(!0===this.isPlaying)return void console.warn('THREE.Audio: Audio is already playing.');if(!1===this.hasPlaybackControl)return void console.warn('THREE.Audio: this Audio has no playback control.');var source=this.context.createBufferSource();return source.buffer=this.buffer,source.detune.value=this.detune,source.loop=this.loop,source.onended=this.onEnded.bind(this),source.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,sourceCreatedCallback&&sourceCreatedCallback(source),source.start(this.startTime,this.offset),this.isPlaying=!0,this.source=source,this.connect()},AFRAME.registerComponent('beat-hit-sound',{directionsToSounds:{up:'',down:'',upleft:'left',upright:'right',downleft:'left',downright:'right',left:'left',right:'right'},init:function(){this.currentBeatEl=null,this.currentCutDirection='',this.processSound=this.processSound.bind(this),sourceCreatedCallback=this.sourceCreatedCallback.bind(this);for(let i=1;10>=i;i++)this.el.setAttribute(`sound__beathit${i}`,{poolSize:4,src:`#hitSound${i}`,volume:VOLUME}),this.el.setAttribute(`sound__beathit${i}left`,{poolSize:4,src:`#hitSound${i}left`,volume:VOLUME}),this.el.setAttribute(`sound__beathit${i}right`,{poolSize:4,src:`#hitSound${i}right`,volume:VOLUME})},play:function(){for(let i=1;10>=i;i++)this.el.components[`sound__beathit${i}`].loaded||(this.el.setAttribute(`sound__beathit${i}`,'src',''),this.el.setAttribute(`sound__beathit${i}`,'src',`#hitSound${i}`)),this.el.components[`sound__beathit${i}left`].loaded||(this.el.setAttribute(`sound__beathit${i}left`,'src',''),this.el.setAttribute(`sound__beathit${i}left`,'src',`#hitSound${i}left`)),this.el.components[`sound__beathit${i}right`].loaded||(this.el.setAttribute(`sound__beathit${i}right`,'src',''),this.el.setAttribute(`sound__beathit${i}right`,'src',`#hitSound${i}right`))},playSound:function(beatEl,cutDirection){const rand=1+Math.floor(10*Math.random()),dir=this.directionsToSounds[cutDirection||'up'],soundPool=this.el.components[`sound__beathit${rand}${dir}`];this.currentBeatEl=beatEl,soundPool.playSound(this.processSound)},processSound:function(audio){audio.detune=0,this.currentBeatEl.object3D.getWorldPosition(audio.position)},sourceCreatedCallback:function(source){const layer=this.getLayer(this.currentBeatEl.object3D.position.y);layer===LAYER_BOTTOM?source.detune.setValueAtTime(-400,0):layer===LAYER_TOP&&source.detune.setValueAtTime(200,0),'down'===this.currentCutDirection&&source.detune.linearRampToValueAtTime(-400,1),'up'===this.currentCutDirection&&source.detune.linearRampToValueAtTime(400,1)},getLayer:function(y){return 1===y?LAYER_BOTTOM:1.7===y?LAYER_TOP:'middle'}})},function(module,__webpack_exports__,__webpack_require__){'use strict';function lessThan(a,b){return a._time-b._time}Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0__constants_beat__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_1__utils__=__webpack_require__(1),__WEBPACK_IMPORTED_MODULE_1__utils___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__utils__);let skipDebug=AFRAME.utils.getUrlParameter('skip')||0;skipDebug=parseInt(skipDebug,10),AFRAME.registerComponent('beat-loader',{dependencies:['stage-colors'],schema:{beatAnticipationTime:{default:1.1},beatSpeed:{default:8},beatWarmupTime:{default:__WEBPACK_IMPORTED_MODULE_0__constants_beat__.b/1e3},beatWarmupSpeed:{default:__WEBPACK_IMPORTED_MODULE_0__constants_beat__.a},challengeId:{type:'string'},difficulty:{type:'string'},isPlaying:{default:!1}},orientationsHumanized:['up','down','left','right','upleft','upright','downleft','downright'],horizontalPositions:[-0.75,-0.25,0.25,0.75],horizontalPositionsHumanized:{0:'left',1:'middleleft',2:'middleright',3:'right'},positionHumanized:{topLeft:{layer:2,index:0},topCenterLeft:{layer:2,index:1},topCenterRight:{layer:2,index:2},topRight:{layer:2,index:3},middleLeft:{layer:1,index:0},middleCenterLeft:{layer:1,index:1},middleCenterRight:{layer:1,index:2},middleRight:{layer:1,index:3},bottomLeft:{layer:0,index:0},bottomCenterLeft:{layer:0,index:1},bottomCenterRight:{layer:0,index:2},bottomRight:{layer:0,index:3}},verticalPositionsHumanized:{0:'bottom',1:'middle',2:'top'},init:function(){this.audioAnalyserEl=document.getElementById('audioanalyser'),this.beatData=null,this.beatDataProcessed=!1,this.beatContainer=document.getElementById('beatContainer'),this.beatsTime=void 0,this.beatsPreloadTime=0,this.beatsPreloadTimeTotal=1e3*(this.data.beatAnticipationTime+this.data.beatWarmupTime),this.bpm=void 0,this.xhr=null,this.stageColors=this.el.components['stage-colors'],this.swordOffset=1.5,this.twister=document.getElementById('twister'),this.leftStageLasers=document.getElementById('leftStageLasers'),this.rightStageLasers=document.getElementById('rightStageLasers'),this.el.addEventListener('cleargame',this.clearBeats.bind(this))},update:function(oldData){const data=this.data;data.challengeId&&data.difficulty&&(data.challengeId===oldData.challengeId&&data.difficulty===oldData.difficulty||this.fetchBeats())},fetchBeats:function(){var el=this.el;this.xhr&&this.xhr.abort();let url=__WEBPACK_IMPORTED_MODULE_1__utils___default.a.getS3FileUrl(this.data.challengeId,`${this.data.difficulty}.json`);const xhr=this.xhr=new XMLHttpRequest;el.emit('beatloaderstart'),console.log(`[beat-loader] Fetching ${url}...`),xhr.open('GET',url),xhr.addEventListener('load',()=>{this.beatData=JSON.parse(xhr.responseText),this.beatDataProcessed=!1,this.xhr=null,this.processBeats(),this.el.sceneEl.emit('beatloaderfinish',null,!1)}),xhr.send()},processBeats:function(){this.beatsTime=0,this.beatsPreloadTime=0,this.beatData._events.sort(lessThan),this.beatData._obstacles.sort(lessThan),this.beatData._notes.sort(lessThan),this.bpm=this.beatData._beatsPerMinute;const events=this.beatData._events;if(events.length&&0>events[0]._time)for(let i=0;0>events[i]._time;i++)this.generateEvent(events[i]);this.beatDataProcessed=!0,console.log('[beat-loader] Finished processing beat data.')},tick:function(time,delta){if(this.data.isPlaying&&this.data.challengeId&&this.beatData){const prevBeatsTime=this.beatsTime+skipDebug;if(void 0===this.beatsPreloadTime){const song=this.el.components.song;if(!song.isPlaying)return;this.beatsTime=1e3*(song.getCurrentTime()+this.data.beatAnticipationTime+this.data.beatWarmupTime)}else this.beatsTime=this.beatsPreloadTime;if(this.isSeeking)return void(this.isSeeking=!1);const beatsTime=this.beatsTime+skipDebug,bpm=this.beatData._beatsPerMinute,msPerBeat=1e3*60/this.beatData._beatsPerMinute,notes=this.beatData._notes;for(let noteTime,i=0;i<notes.length;++i)noteTime=notes[i]._time*msPerBeat,noteTime>prevBeatsTime&&noteTime<=beatsTime&&(notes[i].time=noteTime,this.generateBeat(notes[i]));const obstacles=this.beatData._obstacles;for(let noteTime,i=0;i<obstacles.length;++i)noteTime=obstacles[i]._time*msPerBeat,noteTime>prevBeatsTime&&noteTime<=beatsTime&&this.generateWall(obstacles[i]);const events=this.beatData._events;for(let noteTime,i=0;i<events.length;++i)noteTime=events[i]._time*msPerBeat,noteTime>prevBeatsTime&&noteTime<=beatsTime&&this.generateEvent(events[i]);void 0===this.beatsPreloadTime||(this.beatsPreloadTime>=this.beatsPreloadTimeTotal?(this.el.sceneEl.emit('beatloaderpreloadfinish',null,!1),this.beatsPreloadTime=void 0):this.beatsPreloadTime+=delta)}},seek:function(){this.clearBeats(!0),this.beatsTime=1e3*(this.el.components.song.getCurrentTime()+this.data.beatAnticipationTime+this.data.beatWarmupTime),this.isSeeking=!0},generateBeat:function(){const beatObj={};return function(noteInfo){const data=this.data;let color,type=8===noteInfo._cutDirection?'dot':'arrow';0===noteInfo._type?color='red':1===noteInfo._type?color='blue':(type='mine',color=void 0);const beatEl=this.requestBeat(type,color);beatEl&&(beatObj.anticipationPosition=-data.beatAnticipationTime*data.beatSpeed-this.swordOffset,beatObj.color=color,beatObj.cutDirection=this.orientationsHumanized[noteInfo._cutDirection],beatObj.horizontalPosition=this.horizontalPositionsHumanized[noteInfo._lineIndex],beatObj.speed=this.data.beatSpeed,beatObj.type=type,beatObj.verticalPosition=this.verticalPositionsHumanized[noteInfo._lineLayer],beatObj.warmupPosition=-data.beatWarmupTime*data.beatWarmupSpeed,beatEl.setAttribute('beat',beatObj),beatEl.components.beat.updatePosition(),beatEl.play(),beatEl.components.beat.onGenerate())}}(),generateWall:function(){const wallObj={};return function(wallInfo){const el=this.el.sceneEl.components.pool__wall.requestEntity();if(el){const data=this.data,speed=this.data.beatSpeed,durationSeconds=60*(wallInfo._duration/this.bpm);wallObj.anticipationPosition=-data.beatAnticipationTime*data.beatSpeed-this.swordOffset,wallObj.durationSeconds=durationSeconds,wallObj.horizontalPosition=this.horizontalPositionsHumanized[wallInfo._lineIndex],wallObj.isCeiling=1===wallInfo._type,wallObj.speed=speed,wallObj.warmupPosition=-data.beatWarmupTime*data.beatWarmupSpeed,wallObj.width=wallInfo._width,el.setAttribute('wall',wallObj),el.play()}}}(),generateEvent:function(event){switch(event._type){case 0:this.stageColors.setColor('bg',event._value);break;case 1:this.stageColors.setColor('tunnel',event._value);break;case 2:this.stageColors.setColor('leftlaser',event._value);break;case 3:this.stageColors.setColor('rightlaser',event._value);break;case 4:this.stageColors.setColor('floor',event._value);break;case 8:this.twister.components.twister.pulse(event._value);break;case 9:this.twister.components.twister.pulse(event._value);break;case 12:this.leftStageLasers.components['stage-lasers'].pulse(event._value);break;case 13:this.rightStageLasers.components['stage-lasers'].pulse(event._value);}},requestBeat:function(type,color){var pool,beatPoolName='pool__beat-'+type;return color&&(beatPoolName+='-'+color),pool=this.el.sceneEl.components[beatPoolName],pool?pool.requestEntity():void console.warn('Pool '+beatPoolName+' unavailable')},clearBeats:function(isSeeking){isSeeking||(this.beatsPreloadTime=0,this.beatsTime=0);for(let child,i=0;i<this.beatContainer.children.length;i++)child=this.beatContainer.children[i],child.components.beat&&child.components.beat.returnToPool(!0),child.components.wall&&child.components.wall.returnToPool(!0)}})},function(module,__webpack_exports__,__webpack_require__){'use strict';function getGravityVelocity(velocity,timeDelta){return velocity+-9.8*(timeDelta/1e3)}var _MathPI2=Math.PI;Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0__constants_beat__=__webpack_require__(2);const COLORS=__webpack_require__(0),auxObj3D=new THREE.Object3D,BEAT_WARMUP_ROTATION_TIME=750,DESTROYED_SPEED=1,ONCE={once:!0};AFRAME.registerComponent('beat',{schema:{anticipationPosition:{default:0},color:{default:'red',oneOf:['red','blue']},cutDirection:{default:'down'},debug:{default:!1},horizontalPosition:{default:'middleleft',oneOf:['left','middleleft','middleright','right']},size:{default:0.4},speed:{default:8},type:{default:'arrow',oneOf:['arrow','dot','mine']},verticalPosition:{default:'middle',oneOf:['bottom','middle','top']},warmupPosition:{default:0}},materialColor:{blue:COLORS.BEAT_BLUE,red:COLORS.BEAT_RED},cutColor:{blue:'#fff',red:'#fff'},models:{arrow:'beatObjTemplate',dot:'beatObjTemplate',mine:'mineObjTemplate'},signModels:{arrowred:'arrowRedObjTemplate',arrowblue:'arrowBlueObjTemplate',dotred:'dotRedObjTemplate',dotblue:'dotBlueObjTemplate'},orientations:[180,0,270,90,225,135,315,45,0],rotations:{up:180,down:0,left:270,right:90,upleft:225,upright:135,downleft:315,downright:45},horizontalPositions:{left:-0.75,middleleft:-0.25,middleright:0.25,right:0.75},verticalPositions:{bottom:0.7,middle:1.2,top:1.7},init:function(){this.backToPool=!1,this.beams=document.getElementById('beams').components.beams,this.beatBoundingBox=new THREE.Box3,this.currentRotationWarmupTime=0,this.cutDirection=new THREE.Vector3,this.destroyed=!1,this.gravityVelocity=0,this.hitEventDetail={},this.hitBoundingBox=new THREE.Box3,this.poolName=void 0,this.returnToPoolTimer=800,this.rotationAxis=new THREE.Vector3,this.scoreEl=null,this.scoreElTime=void 0,this.startPositionZ=void 0,this.rightCutPlanePoints=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.leftCutPlanePoints=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.mineParticles=document.getElementById('mineParticles'),this.mineParticles=document.getElementById('mineParticles'),this.explodeEventDetail={position:null,rotation:null},this.initBlock(),'mine'===this.data.type?this.initMineFragments():this.initFragments()},updatePosition:function(){const el=this.el,data=this.data;el.object3D.position.set(this.horizontalPositions[data.horizontalPosition],this.verticalPositions[data.verticalPosition],data.anticipationPosition+data.warmupPosition),el.object3D.rotation.z=THREE.Math.degToRad(this.rotations[data.cutDirection])},update:function(){this.updatePosition(),this.updateBlock(),this.updateFragments(),this.poolName='mine'===this.data.type?`pool__beat-mine`:`pool__beat-${this.data.type}-${this.data.color}`},pause:function(){this.el.object3D.visible=!1,'mine'!==this.data.type&&(this.partLeftEl.object3D.visible=!1,this.partRightEl.object3D.visible=!1)},play:function(){this.blockEl.object3D.visible=!0,this.destroyed=!1,this.el.object3D.visible=!0},tock:function(time,timeDelta){const el=this.el,data=this.data,position=el.object3D.position,rotation=el.object3D.rotation;if(this.destroyed)this.tockDestroyed(timeDelta);else{if(position.z<data.anticipationPosition){let newPositionZ=position.z+__WEBPACK_IMPORTED_MODULE_0__constants_beat__.a*(timeDelta/1e3);newPositionZ<data.anticipationPosition?position.z=newPositionZ:(position.z=data.anticipationPosition,this.beams.newBeam(this.data.color,position))}else position.z+=this.data.speed*(timeDelta/1e3),rotation.z=this.startRotationZ;if(position.z>data.anticipationPosition-0.4&&this.currentRotationWarmupTime<BEAT_WARMUP_ROTATION_TIME){const progress=AFRAME.ANIME.easings.easeOutBack(this.currentRotationWarmupTime/BEAT_WARMUP_ROTATION_TIME);el.object3D.rotation.z=this.rotationZStart+progress*this.rotationZChange,this.currentRotationWarmupTime+=timeDelta}this.backToPool=2<=position.z}this.returnToPool()},onGenerate:function(){this.startRotationZ=this.el.object3D.rotation.z,this.currentRotationWarmupTime=0,this.rotationZChange=_MathPI2/5,0.5<Math.random&&(this.rotationZChange*=-1),this.el.object3D.rotation.z-=this.rotationZChange,this.rotationZStart=this.el.object3D.rotation.z,'mine'==this.data.type&&this.resetMineFragments()},initBlock:function(){var el=this.el,blockEl=this.blockEl=document.createElement('a-entity'),signEl=this.signEl=document.createElement('a-entity');blockEl.setAttribute('mixin','beatBlock'),blockEl.setAttribute('mixin','beatSign'),signEl.object3D.position.z+=0.02,blockEl.appendChild(signEl),el.appendChild(blockEl)},updateBlock:function(){const blockEl=this.blockEl,signEl=this.signEl;if(blockEl)if(blockEl.setAttribute('material',{metalness:0.7,roughness:0.1,sphericalEnvMap:'#envmapTexture',emissive:this.materialColor[this.data.color],emissiveIntensity:0.05,color:this.materialColor[this.data.color]}),this.setObjModelFromTemplate(blockEl,this.models[this.data.type]),blockEl.object3D.scale.set(1,1,1),blockEl.object3D.scale.multiplyScalar(3.45).multiplyScalar(this.data.size),'mine'===this.data.type){const model=blockEl.getObject3D('mesh');model?model.material=this.el.sceneEl.systems.materials['mineMaterial'+this.data.color]:blockEl.addEventListener('model-loaded',()=>{model.material=this.el.sceneEl.systems.materials['mineMaterial'+this.data.color]},ONCE)}else signEl.setAttribute('materials',{name:'stageAdditive'}),this.setObjModelFromTemplate(signEl,this.signModels[this.data.type+this.data.color])},initFragments:function(){var cutEl,partEl;partEl=this.partLeftEl=document.createElement('a-entity'),cutEl=this.cutLeftEl=document.createElement('a-entity'),partEl.appendChild(cutEl),this.el.appendChild(partEl),partEl=this.partRightEl=document.createElement('a-entity'),cutEl=this.cutRightEl=document.createElement('a-entity'),partEl.appendChild(cutEl),this.el.appendChild(partEl),this.initCuttingClippingPlanes()},initMineFragments:function(){var fragment,fragments=this.el.sceneEl.systems['mine-fragments-loader'].fragments.children,material=this.el.sceneEl.systems.materials['mineMaterial'+this.data.color];this.randVec=new THREE.Vector3(Math.random()*_MathPI2,Math.random()*_MathPI2,Math.random()*_MathPI2),this.mineFragments=[],this.mineBroken=document.createElement('a-entity'),this.el.appendChild(this.mineBroken);for(var i=0;i<fragments.length;i++)fragment=new THREE.Mesh(fragments[i].geometry,material),fragment.speed=new THREE.Vector3,fragment.speed.set(Math.random()-0.5,Math.random()-0.5,Math.random()-0.5),this.mineFragments.push(fragment),this.mineBroken.object3D.add(fragment)},updateFragments:function(){var cutLeftEl=this.cutLeftEl,cutRightEl=this.cutRightEl,partLeftEl=this.partLeftEl,partRightEl=this.partRightEl;return partLeftEl?'mine'===this.data.type?void this.resetMineFragments():void(partLeftEl.setAttribute('material',{metalness:0.7,roughness:0.1,sphericalEnvMap:'#envmapTexture',emissive:this.materialColor[this.data.color],emissiveIntensity:0.05,color:this.materialColor[this.data.color],side:'double'}),this.setObjModelFromTemplate(partLeftEl,this.models.dot),partLeftEl.object3D.visible=!1,cutLeftEl.setAttribute('material',{shader:'flat',color:this.data.cutColor,side:'double'}),this.setObjModelFromTemplate(cutLeftEl,this.models.dot),partRightEl.setAttribute('material',{metalness:0.7,roughness:0.1,sphericalEnvMap:'#envmapTexture',emissive:this.materialColor[this.data.color],emissiveIntensity:0.05,color:this.materialColor[this.data.color],side:'double'}),this.setObjModelFromTemplate(partRightEl,this.models.dot),partRightEl.object3D.visible=!1,cutRightEl.setAttribute('material',{shader:'flat',color:this.data.cutColor,side:'double'}),this.setObjModelFromTemplate(cutRightEl,this.models.dot)):void 0},resetMineFragments:function(){if('mine'===this.data.type)for(let fragment,i=0;i<this.mineFragments.length;i++)fragment=this.mineFragments[i],fragment.visible=!1,fragment.position.set(0,0,0),fragment.scale.set(1,1,1),fragment.speed.set(5*Math.random()-2.5,5*Math.random()-2.5,5*Math.random()-2.5)},destroyBeat:function(){var parallelPlaneMaterial=new THREE.MeshBasicMaterial({color:'#00008b',side:THREE.DoubleSide}),planeMaterial=new THREE.MeshBasicMaterial({color:'grey',side:THREE.DoubleSide}),point1=new THREE.Vector3,point2=new THREE.Vector3,point3=new THREE.Vector3;return function(){var coplanarPoint,planeGeometry,planeMesh,cutThickness=this.cutThickness=0.02,direction=this.cutDirection,leftBorderInnerPlane=this.leftBorderInnerPlane,leftBorderOuterPlane=this.leftBorderOuterPlane,leftCutPlane=this.leftCutPlane,rightBorderInnerPlane=this.rightBorderInnerPlane,rightBorderOuterPlane=this.rightBorderOuterPlane,rightCutPlane=this.rightCutPlane;if(point1.copy(trailPoints[0].top),point2.copy(trailPoints[0].center),point3.copy(trailPoints[trailPoints.length-1].top),direction.copy(point1).sub(point3),this.partRightEl.object3D.position.set(0,0,0),this.partRightEl.object3D.rotation.set(0,0,0),this.partRightEl.object3D.updateMatrixWorld(),this.partRightEl.object3D.worldToLocal(this.rightCutPlanePoints[0].copy(point1)),this.partRightEl.object3D.worldToLocal(this.rightCutPlanePoints[1].copy(point2)),this.partRightEl.object3D.worldToLocal(this.rightCutPlanePoints[2].copy(point3)),this.partLeftEl.object3D.position.set(0,0,0),this.partLeftEl.object3D.rotation.set(0,0,0),this.partLeftEl.object3D.updateMatrixWorld(),this.partLeftEl.object3D.worldToLocal(this.leftCutPlanePoints[0].copy(point3)),this.partLeftEl.object3D.worldToLocal(this.leftCutPlanePoints[1].copy(point2)),this.partLeftEl.object3D.worldToLocal(this.leftCutPlanePoints[2].copy(point1)),this.generateCutClippingPlanes(),this.data.debug){coplanarPoint=new THREE.Vector3,planeGeometry=new THREE.PlaneGeometry(4,4,1,1),rightCutPlane.coplanarPoint(coplanarPoint),planeGeometry.lookAt(rightCutPlane.normal),planeGeometry.translate(coplanarPoint.x,coplanarPoint.y,coplanarPoint.z),planeMesh=new THREE.Mesh(planeGeometry,planeMaterial),this.el.sceneEl.setObject3D('rightCutPlane',planeMesh),planeGeometry=new THREE.PlaneGeometry(4,4,1,1),rightBorderOuterPlane.coplanarPoint(coplanarPoint),planeGeometry.lookAt(rightBorderOuterPlane.normal),planeGeometry.translate(coplanarPoint.x,coplanarPoint.y,coplanarPoint.z);const parallelPlaneMesh=new THREE.Mesh(planeGeometry,parallelPlaneMaterial);this.el.sceneEl.setObject3D('planeParallel',parallelPlaneMesh)}this.blockEl.object3D.visible=!1;const partRightMaterial=this.partRightEl.getObject3D('mesh').material;partRightMaterial.clippingPlanes=partRightMaterial.clippingPlanes||[],partRightMaterial.clippingPlanes.length=0,partRightMaterial.clippingPlanes.push(rightCutPlane);const cutRightMaterial=this.cutRightEl.getObject3D('mesh').material;cutRightMaterial.clippingPlanes=cutRightMaterial.clippingPlanes||[],cutRightMaterial.clippingPlanes.length=0,cutRightMaterial.clippingPlanes.push(rightBorderOuterPlane),cutRightMaterial.clippingPlanes.push(rightBorderInnerPlane);const partLeftMaterial=this.partLeftEl.getObject3D('mesh').material;partLeftMaterial.clippingPlanes=partLeftMaterial.clippingPlanes||[],partLeftMaterial.clippingPlanes.length=0,partLeftMaterial.clippingPlanes.push(leftCutPlane);const cutLeftMaterial=this.cutLeftEl.getObject3D('mesh').material;cutLeftMaterial.clippingPlanes=cutLeftMaterial.clippingPlanes||[],cutLeftMaterial.clippingPlanes.length=0,cutLeftMaterial.clippingPlanes.push(leftBorderInnerPlane),cutLeftMaterial.clippingPlanes.push(leftBorderOuterPlane),this.partLeftEl.object3D.visible=!0,this.partRightEl.object3D.visible=!0,this.el.sceneEl.renderer.localClippingEnabled=!0,this.destroyed=!0,this.gravityVelocity=0.1,this.rotationAxis.copy(this.rightCutPlanePoints[0]).sub(this.rightCutPlanePoints[1]),this.returnToPoolTimer=800,auxObj3D.up.copy(rightCutPlane.normal),auxObj3D.lookAt(direction),this.explodeEventDetail.position=this.el.object3D.position,this.explodeEventDetail.rotation=auxObj3D.rotation,this.particles.emit('explode',this.explodeEventDetail,!1)}}(),destroyMine:function(){for(let i=0;i<this.mineFragments.length;i++)this.mineFragments[i].visible=!0;this.blockEl.object3D.visible=!1,this.destroyed=!0,this.gravityVelocity=0.1,this.returnToPoolTimer=800,this.explodeEventDetail.position=this.el.object3D.position,this.explodeEventDetail.rotation=this.randVec,this.mineParticles.emit('explode',this.explodeEventDetail,!1)},initCuttingClippingPlanes:function(){this.leftCutPlanePointsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.rightCutPlanePointsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.rightCutPlane=new THREE.Plane,this.rightBorderOuterPlane=new THREE.Plane,this.rightBorderInnerPlane=new THREE.Plane,this.leftCutPlane=new THREE.Plane,this.leftBorderOuterPlane=new THREE.Plane,this.leftBorderInnerPlane=new THREE.Plane},generateCutClippingPlanes:function(){var leftBorderInnerPlane=this.leftBorderInnerPlane,leftBorderOuterPlane=this.leftBorderOuterPlane,leftCutPlane=this.leftCutPlane,leftCutPlanePointsWorld=this.leftCutPlanePointsWorld,partLeftEl=this.partLeftEl,partRightEl=this.partRightEl,rightBorderInnerPlane=this.rightBorderInnerPlane,rightBorderOuterPlane=this.rightBorderOuterPlane,rightCutPlane=this.rightCutPlane,rightCutPlanePointsWorld=this.rightCutPlanePointsWorld;partRightEl.object3D.updateMatrixWorld(),partRightEl.object3D.localToWorld(rightCutPlanePointsWorld[0].copy(this.rightCutPlanePoints[0])),partRightEl.object3D.localToWorld(rightCutPlanePointsWorld[1].copy(this.rightCutPlanePoints[1])),partRightEl.object3D.localToWorld(rightCutPlanePointsWorld[2].copy(this.rightCutPlanePoints[2])),partLeftEl.object3D.updateMatrixWorld(),partLeftEl.object3D.localToWorld(leftCutPlanePointsWorld[0].copy(this.leftCutPlanePoints[0])),partLeftEl.object3D.localToWorld(leftCutPlanePointsWorld[1].copy(this.leftCutPlanePoints[1])),partLeftEl.object3D.localToWorld(leftCutPlanePointsWorld[2].copy(this.leftCutPlanePoints[2])),rightCutPlane.setFromCoplanarPoints(rightCutPlanePointsWorld[0],rightCutPlanePointsWorld[1],rightCutPlanePointsWorld[2]),rightBorderOuterPlane.set(rightCutPlane.normal,rightCutPlane.constant+this.cutThickness),leftCutPlane.setFromCoplanarPoints(leftCutPlanePointsWorld[0],leftCutPlanePointsWorld[1],leftCutPlanePointsWorld[2]),leftBorderOuterPlane.set(leftCutPlane.normal,leftCutPlane.constant+this.cutThickness),rightBorderInnerPlane.setFromCoplanarPoints(rightCutPlanePointsWorld[2],rightCutPlanePointsWorld[1],rightCutPlanePointsWorld[0]),leftBorderInnerPlane.setFromCoplanarPoints(leftCutPlanePointsWorld[2],leftCutPlanePointsWorld[1],leftCutPlanePointsWorld[0])},returnToPool:function(force){(this.backToPool||force)&&this.el.sceneEl.components[this.poolName].returnEntity(this.el)},tockDestroyed:function(){var fragment,leftCutNormal=new THREE.Vector3,leftRotation=0,rightCutNormal=new THREE.Vector3,rightRotation=0,rotationStep=2*_MathPI2/150;return function(timeDelta){if(this.gravityVelocity=getGravityVelocity(this.gravityVelocity,timeDelta),this.el.object3D.position.y+=this.gravityVelocity*(timeDelta/1e3),'mine'==this.data.type){for(var i=0;i<this.mineFragments.length;i++)(fragment=this.mineFragments[i],!!fragment.visible)&&(fragment.position.addScaledVector(fragment.speed,timeDelta/1e3),fragment.scale.multiplyScalar(0.97),0.1>fragment.scale.y&&(fragment.visible=!1));return this.returnToPoolTimer-=timeDelta,void(this.backToPool=0>=this.returnToPoolTimer)}rightCutNormal.copy(this.rightCutPlane.normal).multiplyScalar(DESTROYED_SPEED*(timeDelta/500)),rightCutNormal.y=0,this.partRightEl.object3D.position.add(rightCutNormal),this.partRightEl.object3D.setRotationFromAxisAngle(this.rotationAxis,rightRotation),rightRotation=rightRotation>=2*_MathPI2?0:rightRotation+rotationStep,leftCutNormal.copy(this.leftCutPlane.normal).multiplyScalar(DESTROYED_SPEED*(timeDelta/500)),leftCutNormal.y=0,this.partLeftEl.object3D.position.add(leftCutNormal),this.partLeftEl.object3D.setRotationFromAxisAngle(this.rotationAxis,leftRotation),leftRotation=leftRotation>=2*_MathPI2?0:leftRotation+rotationStep,this.generateCutClippingPlanes(),this.returnToPoolTimer-=timeDelta,this.backToPool=0>=this.returnToPoolTimer}}(),setObjModelFromTemplate:function(){const geometries={};return function(el,templateId){if(!geometries[templateId]){const templateEl=document.getElementById(templateId);if(templateEl.getObject3D('mesh'))geometries[templateId]=templateEl.getObject3D('mesh').children[0].geometry;else return void templateEl.addEventListener('model-loaded',()=>{geometries[templateId]=templateEl.getObject3D('mesh').children[0].geometry,this.setObjModelFromTemplate(el,templateId)})}el.getObject3D('mesh')||el.setObject3D('mesh',new THREE.Mesh),el.getObject3D('mesh').geometry=geometries[templateId]}}()})},function(module,exports,__webpack_require__){const utils=__webpack_require__(1);AFRAME.registerComponent('challenge-setter',{play:function(){this.setChallenge(AFRAME.utils.getUrlParameter('id'),AFRAME.utils.getUrlParameter('difficulty'))},setChallenge:function(id,difficulty){const xhr=new XMLHttpRequest;xhr.open('GET',utils.getS3FileUrl(id,'info.json')),xhr.addEventListener('load',()=>{this.el.emit('challengeset',Object.assign({id:id,difficulty:difficulty},JSON.parse(xhr.responseText)))}),xhr.send()}})},function(){AFRAME.registerComponent('console-shortcuts',{play:function(){window.$=val=>document.querySelector(val),window.$$=val=>document.querySelectorAll(val),window.$$$=val=>document.querySelector(`[${val}]`).getAttribute(val),window.$$$$=val=>document.querySelector(`[${val}]`).components[val],window.scene=this.el,window.state=this.el.systems.state.state}})},function(){AFRAME.registerComponent('copy-texture',{dependencies:['geometry','material'],schema:{from:{type:'selector'}},init:function(){const data=this.data;data.from.addEventListener('materialtextureloaded',()=>{this.copyTexture()}),this.copyTexture()},copyTexture:function(){const el=this.el,target=this.data.from,material=el.getObject3D('mesh').material;target.getObject3D('mesh')&&(material.map=target.getObject3D('mesh').material.map,material.map&&(material.map.needsUpdate=!0,material.needsUpdate=!0))}})},function(){AFRAME.registerComponent('cursor-mesh',{schema:{active:{default:!0},cursorEl:{type:'selector'}},init:function(){this.scenePivotEl=document.getElementById('scenePivot')},update:function(){this.el.object3D.visible=this.data.active},tick:function(){var cursor,intersection,intersectedEl,cursorEl=this.data.cursorEl,el=this.el,scenePivotEl=this.scenePivotEl;if(this.data.active&&(cursor=cursorEl.components.cursor,!!cursor)){if(intersectedEl=cursorEl.components.cursor.intersectedEl,intersectedEl)el.object3D.visible=!0;else return void(el.object3D.visible=!1);intersection=cursorEl.components.raycaster.getIntersection(intersectedEl),intersection&&(el.object3D.position.copy(intersection.point),scenePivotEl&&el.object3D.rotation.copy(scenePivotEl.object3D.rotation))}}})},function(){AFRAME.registerComponent('debug-beat-loader',{dependencies:['beat-loader'],schema:{beatEnabled:{default:!1},stageEnabled:{default:!1}},init:function(){this.beatLoader=this.el.components['beat-loader'],this.selectedBeat={color:'red',position:'middleCenterLeft',type:'arrow',orientation:'up'},this.beats={},this.onKeyDown=this.onKeyDown.bind(this),(this.data.stageEnabled||AFRAME.utils.getUrlParameter('debugstage'))&&this.addDebugStageControls(),(this.data.beatEnabled||'gameplay'===AFRAME.utils.getUrlParameter('debugstate').trim())&&(window.addEventListener('keydown',this.onKeyDown),this.addDebugBeatControls())},spawn:function(){var self=this;Object.keys(this.beats).forEach(function(key){self.generateBeat(self.beats[key])})},generateBeat:function(beatInfo){var type;return'wall'===beatInfo.type?void this.generateWall(beatInfo):void(type='mine'===beatInfo.type?3:'red'===beatInfo.color?0:1,this.beatLoader.generateBeat({_lineIndex:this.beatLoader.positionHumanized[beatInfo.position].index,_lineLayer:this.beatLoader.positionHumanized[beatInfo.position].layer,_cutDirection:'dot'===beatInfo.type?8:this.beatLoader.orientationsHumanized.indexOf(beatInfo.orientation),_type:type}))},generateWall:function(wallInfo){this.beatLoader.bpm=90,this.beatLoader.generateWall({_lineIndex:this.beatLoader.positionHumanized[wallInfo.position].index,_width:1,_duration:3})},onKeyDown:function(event){const keyCode=event.keyCode;switch(keyCode){case 32:{this.spawn();break}}},addDebugBeatControls:function(){function addMenu(name){const menuDiv=document.createElement('div');return menuDiv.id=name,menuDiv.style.marginBottom='20px',menuDiv.style.width='500px',menuDiv.style.display='inline-block',parentDiv.appendChild(menuDiv),menuDiv}function addButton(text,containerEl,clickHandler){const div=document.createElement('div');return div.classList.add('button'),div.id=text,div.style.width='100px',div.style.height='30px',div.style.background='#000',div.style.color='#fff',div.style.zIndex=999999999,div.style.padding='5px',div.style.margin='5px',div.style.font='14px sans-serif',div.style.textAlign='center',div.style.lineHeight='30px',div.style.cursor='pointer',div.style.display='inline-block',div.innerHTML=text,containerEl.appendChild(div),div.addEventListener('click',clickHandler||function onClick(){const buttons=div.parentElement.querySelectorAll('.button');for(let i=0;i<buttons.length;i++)buttons[i].style.background='#000';div.style.background='#66f',self.selectedBeat[div.parentElement.id]=this.id,self['selected'+div.parentElement.id.charAt(0).toUpperCase()+div.parentElement.id.slice(1)+'El']=this}),div}const parentDiv=document.createElement('div'),self=this;parentDiv.style.position='absolute',parentDiv.style.right='0',parentDiv.style.top='0',parentDiv.style.padding='10px',parentDiv.style.width='500px',parentDiv.style.height='600px',document.body.appendChild(parentDiv),function addTypeBeatMenu(){const menuDiv=addMenu('type');addButton('arrow',menuDiv),addButton('dot',menuDiv),addButton('mine',menuDiv),addButton('wall',menuDiv),parentDiv.appendChild(menuDiv)}(),function addColorBeatMenu(){const menuDiv=addMenu('color');addButton('blue',menuDiv),addButton('red',menuDiv),parentDiv.appendChild(menuDiv)}(),function addOrientationMenu(){const menuDiv=addMenu('orientation');addButton('top',menuDiv),addButton('left',menuDiv),addButton('right',menuDiv),addButton('down',menuDiv),parentDiv.appendChild(menuDiv)}(),function setBeatButton(){var buttonEl=addButton('Set Beat',parentDiv,function(){var color='mine'===self.selectedBeat.type?'':' '+self.selectedBeat.color,orientation='arrow'===self.selectedBeat.type?' '+self.selectedBeat.orientation:'';self.selectedBeat={position:self.selectedBeat.position,type:self.selectedBeat.type,orientation:self.selectedBeat.orientation,color:self.selectedBeat.color};self.selectedPositionEl&&(self.selectedPositionEl.innerHTML=self.selectedBeat.type+color+orientation,self.beats[self.selectedPositionEl.id]={position:self.selectedBeat.position,type:self.selectedBeat.type,orientation:self.selectedBeat.orientation,color:self.selectedBeat.color})});buttonEl.style.width='460px',buttonEl.style.bottomMargin='10px'}(),function addBeatPositionMenu(){const menuDiv=addMenu('position');addButton('topLeft',menuDiv),addButton('topCenterLeft',menuDiv),addButton('topCenterRight',menuDiv),addButton('topRight',menuDiv),addButton('middleLeft',menuDiv),addButton('middleCenterLeft',menuDiv),addButton('middleCenterRight',menuDiv),addButton('middleRight',menuDiv),addButton('bottomLeft',menuDiv),addButton('bottomCenterLeft',menuDiv),addButton('bottomCenterRight',menuDiv),addButton('bottomRight',menuDiv)}(),function addGenerateButton(){const buttonEl=addButton('Spawn (Space Bar)',parentDiv,()=>{self.spawn()});buttonEl.style.width='460px',buttonEl.style.bottomMargin='10px'}()},addDebugStageControls:function(){var currControl=0;const addControl=(i,name,type)=>{const div=document.createElement('div');div.style.position='absolute',div.id='stagecontrol'+i,div.style.width='100px',div.style.height='30px',div.style.top='element'===type?'20px':'70px',div.style.background='#000',div.style.color='#fff',div.style.zIndex=999999999,div.style.padding='5px',div.style.font='14px sans-serif',div.style.textAlign='center',div.style.cursor='pointer',div.style.left=20+120*i+'px',div.innerHTML=name,'element'===type?div.addEventListener('click',()=>{document.getElementById('stagecontrol'+currControl).style.background='#000',div.style.background='#66f',currControl=i}):div.addEventListener('click',()=>{this.beatLoader.generateEvent({_type:currControl,_value:i})}),document.body.appendChild(div)};['sky','tunnelNeon','leftStageLasers','rightStageLasers','floor'].forEach((id,i)=>{addControl(i,id,'element')}),['off','blue','blue','bluefade','','red','red','redfade'].forEach((id,i)=>{addControl(i,id,'value')})}})},function(){AFRAME.registerComponent('debug-controller',{init:function(){var primaryHand,secondaryHand;AFRAME.utils.getUrlParameter('debug')&&(console.log('%c debug-controller enabled ','background: #111; color: red'),this.isCloning=!1,this.isDeleting=!1,this.isTriggerDown=!1,window.addEventListener('mousemove',this.onMouseMove.bind(this)),primaryHand=document.getElementById('rightHand'),secondaryHand=document.getElementById('leftHand'),window.addEventListener('click',evt=>{evt.isTrusted&&(primaryHand.emit('triggerdown'),primaryHand.emit('triggerup'))}),'oculus'===AFRAME.utils.getUrlParameter('debug')?(primaryHand.emit('controllerconnected',{name:'oculus-touch-controls'}),secondaryHand.emit('controllerconnected',{name:'oculus-touch-controls'}),primaryHand.setAttribute('controller','controllerType','oculus-touch-controls'),secondaryHand.setAttribute('controller','controllerType','oculus-touch-controls')):(primaryHand.emit('controllerconnected',{name:'vive-controls'}),secondaryHand.emit('controllerconnected',{name:'vive-controls'}),primaryHand.setAttribute('controller','controllerType','vive-controls'),secondaryHand.setAttribute('controller','controllerType','vive-controls')),this.el.emit('enter-vr',null,!1),document.addEventListener('keydown',evt=>{var primaryPosition,primaryRotation,secondaryPosition,secondaryRotation;return evt.shiftKey?32===evt.keyCode?void(this.isTriggerDown?(primaryHand.emit('triggerup'),this.isTriggerDown=!1):(primaryHand.emit('triggerdown'),this.isTriggerDown=!0)):81===evt.keyCode?void(this.isSecondaryTriggerDown?(secondaryHand.emit('triggerup'),this.isSecondaryTriggerDown=!1):(secondaryHand.emit('triggerdown'),this.isSecondaryTriggerDown=!0)):void(78===evt.keyCode&&(this.secondaryGripDown?(secondaryHand.emit('gripup'),this.secondaryGripDown=!1):(secondaryHand.emit('gripdown'),this.secondaryGripDown=!0)),77===evt.keyCode&&(this.primaryGripDown?(primaryHand.emit('gripup'),this.primaryGripDown=!1):(primaryHand.emit('gripdown'),this.primaryGripDown=!0)),49===evt.keyCode&&secondaryHand.emit('menudown'),evt.ctrlKey?(secondaryPosition=secondaryHand.getAttribute('position'),72===evt.keyCode&&(secondaryPosition.x-=0.01),74===evt.keyCode&&(secondaryPosition.y-=0.01),75===evt.keyCode&&(secondaryPosition.y+=0.01),76===evt.keyCode&&(secondaryPosition.x+=0.01),(59===evt.keyCode||186===evt.keyCode)&&(secondaryPosition.z-=0.01),222===evt.keyCode&&(secondaryPosition.z+=0.01),secondaryHand.setAttribute('position',AFRAME.utils.clone(secondaryPosition))):(primaryPosition=primaryHand.getAttribute('position'),72===evt.keyCode&&(primaryPosition.x-=0.01),74===evt.keyCode&&(primaryPosition.y-=0.01),75===evt.keyCode&&(primaryPosition.y+=0.01),76===evt.keyCode&&(primaryPosition.x+=0.01),(59===evt.keyCode||186===evt.keyCode)&&(primaryPosition.z-=0.01),222===evt.keyCode&&(primaryPosition.z+=0.01),primaryHand.setAttribute('position',AFRAME.utils.clone(primaryPosition))),evt.ctrlKey?(secondaryRotation=secondaryHand.getAttribute('rotation'),89===evt.keyCode&&(secondaryRotation.x-=10),79===evt.keyCode&&(secondaryRotation.x+=10),85===evt.keyCode&&(secondaryRotation.y-=10),73===evt.keyCode&&(secondaryRotation.y+=10),secondaryHand.setAttribute('rotation',AFRAME.utils.clone(secondaryRotation))):(primaryRotation=primaryHand.getAttribute('rotation'),89===evt.keyCode&&(primaryRotation.x-=10),79===evt.keyCode&&(primaryRotation.x+=10),85===evt.keyCode&&(primaryRotation.y-=10),73===evt.keyCode&&(primaryRotation.y+=10),primaryHand.setAttribute('rotation',AFRAME.utils.clone(primaryRotation)))):void 0}))},play:function(){var primaryHand,secondaryHand;this.bounds=document.body.getBoundingClientRect();AFRAME.utils.getUrlParameter('debug')&&(primaryHand=document.getElementById('rightHand'),secondaryHand=document.getElementById('leftHand'),secondaryHand.object3D.position.set(-0.2,1.5,-0.5),primaryHand.object3D.position.set(0.2,1.5,-0.5),secondaryHand.setAttribute('rotation',{x:35,y:0,z:0}))},onMouseMove:function(){const direction=new THREE.Vector3,mouse=new THREE.Vector2,cameraPos=new THREE.Vector3;return function(evt){const bounds=this.bounds,camera=this.el.sceneEl.camera,left=evt.clientX-bounds.left,top=evt.clientY-bounds.top;mouse.x=2*(left/bounds.width)-1,mouse.y=2*(-top/bounds.height)-1,document.getElementById('camera').object3D.getWorldPosition(cameraPos),direction.set(mouse.x,mouse.y,0.5).unproject(camera).sub(cameraPos).normalize();const handPos=document.getElementById('rightHand').object3D.position,distance=-cameraPos.z/direction.z;camera.getWorldPosition(handPos).add(direction.multiplyScalar(distance)),handPos.y+=0.8}}()})},function(){AFRAME.registerComponent('debug-cursor',{init:function(){},log:function(event,intersectedEl,color){intersectedEl.id?console.log(`%c[${event}] ${intersectedEl.id}`,`color: ${color}`):(console.log(`%c[${event}]`,`color: ${color}`),console.log(intersectedEl))}})},function(){AFRAME.registerComponent('debug-song-time',{dependencies:['song'],init:function(){AFRAME.utils.getUrlParameter('debug-song-time')&&setInterval(()=>{console.log(this.el.components.song.getCurrentTime())},250)}})},function(){AFRAME.registerComponent('debug-state',{play:function(){const flags=AFRAME.utils.getUrlParameter('debugstate').trim();flags&&setTimeout(()=>{flags.split(',').forEach(flag=>{this.el.sceneEl.emit(`debug${flag.trim()}`,null,!1)})},500)}})},function(module,__webpack_exports__,__webpack_require__){'use strict';function createGeometry(color){colorHelper.set(color);const geometries=[{height:0.1831,radius:0.0055},{height:0.1832,radius:0.0065},{height:0.1833,radius:0.0075},{height:0.1834,radius:0.0085}].map((cylinderData,i)=>{const cylinder=new THREE.CylinderBufferGeometry(cylinderData.radius,cylinderData.radius,cylinderData.height),colorArray=[];for(let i=0;i<cylinder.attributes.position.array.length;i+=3)colorArray[i]=colorHelper.r,colorArray[i+1]=colorHelper.g,colorArray[i+2]=colorHelper.b;cylinder.addAttribute('color',new THREE.Float32BufferAttribute(colorArray,3));const alphaUvs=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aframe_atlas_uvs_component__.getGridUvs)(0,i,1,4),uvs=cylinder.attributes.uv.array;for(let i=0;i<uvs.length;i+=6)uvs[i]=alphaUvs[0].x,uvs[i+1]=alphaUvs[0].y,uvs[i+2]=alphaUvs[1].x,uvs[i+3]=alphaUvs[1].y,uvs[i+4]=alphaUvs[2].x,uvs[i+5]=alphaUvs[2].y;return cylinder.attributes.uv.needsUpdate=!0,cylinder}),geometry=THREE.BufferGeometryUtils.mergeBufferGeometries(geometries);return geometry}Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0_aframe_atlas_uvs_component__=__webpack_require__(3),__WEBPACK_IMPORTED_MODULE_0_aframe_atlas_uvs_component___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_aframe_atlas_uvs_component__);__webpack_require__(4);const colorHelper=new THREE.Color,geometry=createGeometry(),material=new THREE.MeshBasicMaterial({alphaMap:function createAlphaMap(){const alphaCanvas=document.createElement('canvas');alphaCanvas.height=1,alphaCanvas.width=4;const ctx=alphaCanvas.getContext('2d');return ctx.fillStyle='rgb(10, 10, 10)',ctx.fillRect(0,0,1,1),ctx.fillStyle='rgb(15, 15, 15)',ctx.fillRect(1,0,1,1),ctx.fillStyle='rgb(23, 23 ,23)',ctx.fillRect(2,0,1,1),ctx.fillStyle='rgb(28, 28, 28)',ctx.fillRect(3,0,1,1),setTimeout(()=>{alphaCanvas.style.position='fixed',alphaCanvas.style.zIndex=999999999999,alphaCanvas.style.left=0,alphaCanvas.style.top=0,document.body.appendChild(alphaCanvas)},1e3),new THREE.CanvasTexture(alphaCanvas)}(),transparent:!0,vertexColors:THREE.VertexColors});AFRAME.registerComponent('fake-glow',{schema:{color:{default:'#FFF'}},play:function(){this.el.setObject3D('mesh',new THREE.Mesh(createGeometry(this.data.color),material))}})},function(module,exports,__webpack_require__){const COLORS=__webpack_require__(0),HIT_COLOR=new THREE.Color(COLORS.NEON_RED),BORDER_COLOR=new THREE.Color(COLORS.NEON_BLUE);AFRAME.registerShader('floorShader',{schema:{normalMap:{type:'map',is:'uniform'},envMap:{type:'map',is:'uniform'},hitRight:{type:'vec3',is:'uniform',default:{x:0,y:1,z:0}},hitLeft:{type:'vec3',is:'uniform',default:{x:0,y:0,z:0}}},vertexShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    uniform vec3 color;
    uniform sampler2D normalMap;
    uniform sampler2D envMap;
    uniform vec3 hitRight;
    uniform vec3 hitLeft;

    #define HIT_COLOR vec3(${HIT_COLOR.r}, ${HIT_COLOR.g}, ${HIT_COLOR.b})
    #define BORDER_COLOR vec3(${BORDER_COLOR.r}, ${BORDER_COLOR.g}, ${BORDER_COLOR.b})

    vec3 drawCircle(vec3 p, vec3 center, float radius, float edgeWidth, vec3 color) {
      return color*(1.0-smoothstep(radius, radius+edgeWidth, length(p-center)));
    }

    void main() {
      vec2 p = uvs.xy - 0.5;
      vec3 border = vec3(smoothstep(0.49, 0.495, abs(p.x)) + smoothstep(0.49, 0.495, abs(p.y)));
      border += BORDER_COLOR * (smoothstep(0.475, 0.495, abs(p.x)) + smoothstep(0.475, 0.495, abs(p.y))) * .7;
      p*= 4.0;

      vec3 hitColor = HIT_COLOR;
      vec3 hit = vec3(0.0);

      hit += drawCircle(worldPos, hitRight, 0.04, 0.05, hitColor);
      hit += drawCircle(worldPos, hitRight, 0.02, 0.03, vec3(0.7, 0.7, 0.7));
      hit += drawCircle(worldPos, hitLeft, 0.04, 0.05, hitColor);
      hit += drawCircle(worldPos, hitLeft, 0.02, 0.03, vec3(0.7, 0.7, 0.7));

      vec3 normal = normalize(texture2D(normalMap, uvs).xyz);

      // environment reflection
      vec3 reflectVec = normalize(reflect(normalize(worldPos - cameraPosition), normal));
      //vec3 reflectView = normalize((viewMatrix * vec4(reflectVec, 0.0)).xyz + vec3(0.0, 0.0, 1.0));

      vec3 ref = texture2D(envMap, reflectVec.xy * vec2(0.3, 1.0) + vec2(0.75, -cameraPosition.z * 0.05)).xyz * 0.14;

      gl_FragColor = vec4(ref + border + hit, 1.0);
    }
  `})},function(){let i=0;AFRAME.registerComponent('gpu-preloader',{dependencies:['materials'],play:function(){this.preloadMineEnvMaps(),setTimeout(()=>{this.preloadAtlas(),this.preloadBeamMap(),this.preloadBeatEnvMap()},1e3)},preloadAtlas:function(){const stage=document.querySelector('#stageObj');this.preloadTexture(stage.getObject3D('mesh').children[0].material.uniforms.src.value)},preloadBeamMap:function(){const beams=document.querySelector('[beams]');this.preloadTexture(beams.components.beams.texture)},preloadBeatEnvMap:function(){const beat=document.querySelector('#beatContainer [mixin~="beat"]');beat.object3D.traverse(node=>{node.material&&(node.material.envMap&&this.preloadTexture(node.material.envMap),node.material.map&&this.preloadTexture(node.material.map))})},preloadKeyboard:function(){const keyboard=document.getElementById('keyboard').components['super-keyboard'];this.preloadTexture(keyboard.kbImg.getObject3D('mesh').material.map),this.preloadTexture(keyboard.keyColorPlane.getObject3D('mesh').material.map)},preloadMineEnvMaps:function(){const stageColors=this.el.sceneEl.components['stage-colors'];this.el.sceneEl.addEventListener('mineredenvmaploaded',()=>{this.preloadTexture(stageColors.mineEnvMap.red)}),this.el.sceneEl.addEventListener('mineblueenvmaploaded',()=>{this.preloadTexture(stageColors.mineEnvMap.blue)})},preloadWallMap:function(){const wall=document.querySelector('a-entity[wall]');this.preloadTexture(wall.getObject3D('mesh').material.uniforms.tex.value),this.preloadTexture(wall.getObject3D('mesh').material.uniforms.env.value)},preloadTexture:function(texture){return texture&&texture.image?texture.image.complete?void this.el.renderer.setTexture2D(texture,i++%8):void console.warn('[gpu-preloader] Error preloading, image not loaded',texture):void console.warn('[gpu-preloader] Error preloading texture',texture)}})},function(){AFRAME.registerComponent('history',{schema:{challengeId:{type:'string'},songName:{type:'string'},songSubName:{type:'string'}},update:function(){const data=this.data;history.pushState('',data.songName,updateQueryParam(window.location.href,'challenge',data.challengeId)),document.title=`Super Saber - ${data.songName}`}})},function(){AFRAME.registerComponent('keyboard-raycastable',{dependencies:['super-keyboard'],schema:{condition:{default:''}},play:function(){this.el.components['super-keyboard'].kbImg.setAttribute('bind-toggle__raycastable',this.data.condition)}})},function(module,exports,__webpack_require__){const COLORS=__webpack_require__(0),flatShaders=__webpack_require__(22),stageAdditiveShaders=__webpack_require__(23),stageNormalShaders=__webpack_require__(24);AFRAME.registerSystem('materials',{init:function(){'loading'===document.readyState?document.addEventListener('DOMContentLoaded',this.createMaterials.bind(this)):this.createMaterials()},createMaterials:function(){this.stageNormal=new THREE.ShaderMaterial({uniforms:{skyColor:{value:new THREE.Color(COLORS.SKY_BLUE)},backglowColor:{value:new THREE.Color(COLORS.BG_BLUE)},src:{value:new THREE.TextureLoader().load(document.getElementById('atlasImg').src)}},vertexShader:stageNormalShaders.vertexShader,fragmentShader:stageNormalShaders.fragmentShader,fog:!1,transparent:!0}),this.stageAdditive=new THREE.ShaderMaterial({uniforms:{tunnelNeon:{value:new THREE.Color(COLORS.NEON_RED)},floorNeon:{value:new THREE.Color(COLORS.NEON_RED)},leftLaser:{value:new THREE.Color(COLORS.NEON_BLUE)},rightLaser:{value:new THREE.Color(COLORS.NEON_BLUE)},textGlow:{value:new THREE.Color(COLORS.TEXT_OFF)},src:{value:new THREE.TextureLoader().load(document.getElementById('atlasImg').src)}},vertexShader:stageAdditiveShaders.vertexShader,fragmentShader:stageAdditiveShaders.fragmentShader,blending:THREE.AdditiveBlending,fog:!1,transparent:!0}),this.logo=new THREE.ShaderMaterial({uniforms:{src:{value:new THREE.TextureLoader().load(document.getElementById('logotexImg').src)}},vertexShader:flatShaders.vertexShader,fragmentShader:flatShaders.fragmentShader,depthTest:!1,fog:!1,transparent:!0}),this.logoadditive=new THREE.ShaderMaterial({uniforms:{src:{value:new THREE.TextureLoader().load(document.getElementById('logotexImg').src)}},vertexShader:flatShaders.vertexShader,fragmentShader:flatShaders.fragmentShader,depthTest:!1,blending:THREE.AdditiveBlending,fog:!1,transparent:!0}),this.mineMaterialred=new THREE.MeshStandardMaterial({roughness:0.38,metalness:0.48,color:new THREE.Color(COLORS.MINE_RED),emissive:new THREE.Color(COLORS.MINE_RED_EMISSION),envMap:new THREE.TextureLoader().load('assets/img/mineenviro-red.jpg')}),this.mineMaterialblue=new THREE.MeshStandardMaterial({roughness:0.38,metalness:0.48,color:new THREE.Color(COLORS.MINE_BLUE),emissive:new THREE.Color(COLORS.MINE_BLUE_EMISSION),envMap:new THREE.TextureLoader().load('assets/img/mineenviro-blue.jpg')})}}),AFRAME.registerComponent('materials',{schema:{name:{default:''},recursive:{default:!0}},update:function(){if(''!==this.data.name){const material=this.system[this.data.name];if(!material)return void console.warn(`undefined material "${this.system[this.data.name]}"`);const mesh=this.el.getObject3D('mesh');mesh?this.applyMaterial(mesh):this.el.addEventListener('model-loaded',this.applyMaterial.bind(this))}},applyMaterial:function(obj){const material=this.system[this.data.name];obj.detail&&(obj=obj.detail.model),this.data.recursive?obj.traverse(o=>{'Mesh'===o.type&&(o.material=material)}):obj.material=material}})},function(){const objLoader=new THREE.OBJLoader;AFRAME.registerSystem('mine-fragments-loader',{init:function(){this.fragments=null;const objData=document.getElementById('mineBrokenObj');objData.addEventListener('loaded',evt=>{this.fragments=objLoader.parse(evt.target.data)})}})},function(){const COMBO_PROGRESS_MAP={0:0,1:0.5,2:0,3:0.25,4:0.5,5:0.75,6:0,7:0.125,8:0.25,9:0.375,10:0.5,11:0.625,12:0.75,13:0.875};AFRAME.registerComponent('multiplier-ring',{dependencies:['geometry','material'],schema:{combo:{default:0},multiplier:{default:1}},init:function(){this.animationSet={from:void 0,to:void 0},this.progress=this.el.getObject3D('mesh').material.uniforms.progress,this.el.setAttribute('animation',{property:'components.material.material.uniforms.progress.value',dur:100,autoplay:!1})},update:function(){this.updateRing()},updateRing:function(){const data=this.data,el=this.el,progress=this.progress;if(8===data.multiplier)return void(progress.value=1);const animationSet=this.animationSet;animationSet.from=progress.value,animationSet.to=COMBO_PROGRESS_MAP[data.combo],el.setAttribute('animation',animationSet),el.components.animation.beginAnimation()}})},function(module){function transformPlane(particleIndex,geometry,originalArray,position,rotation,scale){const array=geometry.attributes.position.array,index=particleIndex*NUM_PLANE_POSITIONS;tri.vertices[0].set(originalArray[index+0],originalArray[index+1],originalArray[index+2]),tri.vertices[1].set(originalArray[index+3],originalArray[index+4],originalArray[index+5]),tri.vertices[2].set(originalArray[index+6],originalArray[index+7],originalArray[index+8]),null!==scale&&tri.scale(scale.x,scale.y,scale.z),rotation&&(tri.rotateX(rotation.x),tri.rotateY(rotation.y),tri.rotateZ(rotation.z)),tri.vertices[0].add(position),tri.vertices[1].add(position),tri.vertices[2].add(position),array[index+0]=tri.vertices[0].x,array[index+1]=tri.vertices[0].y,array[index+2]=tri.vertices[0].z,array[index+3]=tri.vertices[1].x,array[index+4]=tri.vertices[1].y,array[index+5]=tri.vertices[1].z,array[index+6]=tri.vertices[2].x,array[index+7]=tri.vertices[2].y,array[index+8]=tri.vertices[2].z,tri.vertices[0].set(originalArray[index+3],originalArray[index+4],originalArray[index+5]),tri.vertices[1].set(originalArray[index+6],originalArray[index+7],originalArray[index+8]),tri.vertices[2].set(originalArray[index+9],originalArray[index+10],originalArray[index+11]),null!==scale&&tri.scale(scale.x,scale.y,scale.z),rotation&&(tri.rotateX(rotation.x),tri.rotateY(rotation.y),tri.rotateZ(rotation.z)),tri.vertices[0].add(position),tri.vertices[1].add(position),tri.vertices[2].add(position),array[index+9]=tri.vertices[2].x,array[index+10]=tri.vertices[2].y,array[index+11]=tri.vertices[2].z,geometry.attributes.position.needsUpdate=!0}function copyArray(dest,src){dest.length=0;for(let i=0;i<src.length;i++)dest[i]=src[i]}var _Mathfloor=Math.floor,_MathPI3=Math.PI;const NUM_PLANE_POSITIONS=12,BLENDINGS={normal:THREE.NormalBlending,additive:THREE.AdditiveBlending,substractive:THREE.SubstractiveBlending,multiply:THREE.MultiplyBlending},SHADERS={flat:THREE.MeshBasicMaterial,lambert:THREE.MeshLambertMaterial,phong:THREE.MeshPhongMaterial,standard:THREE.MeshStandardMaterial},OFFSCREEN_VEC3=new THREE.Vector3(-99999,-99999,-99999);AFRAME.registerComponent('particleplayer',{schema:{blending:{default:'additive',oneOf:['normal','additive','multiply','substractive']},color:{default:'#fff',type:'color'},count:{default:'100%'},delay:{default:0,type:'int'},dur:{default:1e3,type:'int'},img:{type:'selector'},interpolate:{default:!1},loop:{default:'false'},on:{default:'init'},poolSize:{default:5,type:'int'},protation:{type:'vec3'},pscale:{default:1,type:'float'},scale:{default:1,type:'float'},initialScale:{type:'vec3'},finalScale:{type:'vec3'},animateScale:{default:!1},shader:{default:'flat',oneOf:['flat','lambert','phong','standard']},src:{type:'selector'}},multiple:!0,init:function(){this.frame=0,this.framedata=null,this.indexPool=null,this.lastFrame=0,this.material=null,this.msPerFrame=0,this.numFrames=0,this.numParticles=0,this.originalVertexPositions=[],this.particleCount=0,this.particleSystems=[],this.protation=!1,this.restPositions=[],this.restRotations=[],this.sprite_rotation=!1,this.systems=null,this.useRotation=!1,this.useAge=!1,this.scaleAnim=new THREE.Vector3,this.partScale=new THREE.Vector3(1,1,1)},update:function(oldData){const data=this.data;if(data.src){oldData.on!==data.on&&(oldData.on&&this.el.removeEventListener(oldData.on,this.start),'play'!==data.on&&this.el.addEventListener(data.on,this.start.bind(this))),this.partScale.set(1,1,1),this.loadParticlesJSON(data.src,data.scale),this.numFrames=this.framedata.length,this.numParticles=0<this.numFrames?this.framedata[0].length:0,this.particleCount='%'===data.count[data.count.length-1]?_Mathfloor(parseInt(data.count)*this.numParticles/100):parseInt(data.count),this.particleCount=Math.min(this.numParticles,Math.max(0,this.particleCount)),this.msPerFrame=data.dur/this.numFrames,this.indexPool=Array(this.numParticles);const materialParams={color:new THREE.Color(data.color),side:THREE.DoubleSide,blending:BLENDINGS[data.blending],map:data.img?new THREE.TextureLoader().load(data.img.src):null,depthWrite:!1,opacity:data.opacity,transparent:!!data.img||'normal'!==data.blending||1>data.opacity};this.material=void 0===SHADERS[data.shader]?new SHADERS.flat(materialParams):new SHADERS[data.shader](materialParams),this.createParticles(data.poolSize),'init'===data.on&&this.start()}},loadParticlesJSON:function(json,scale){var alive;this.restPositions.length=0,this.restRotations.length=0;const jsonData=JSON.parse(json.data),frames=jsonData.frames,precision=jsonData.precision;this.useRotation=jsonData.rotation,this.useAge=jsonData.age!==void 0&&jsonData.age,this.sprite_rotation=!1!==jsonData.sprite_rotation&&{x:jsonData.sprite_rotation[0]/precision,y:jsonData.sprite_rotation[1]/precision,z:jsonData.sprite_rotation[2]/precision},this.framedata=Array(frames.length);for(let frameIndex=0;frameIndex<frames.length;frameIndex++){this.framedata[frameIndex]=Array(frames[frameIndex].length);for(let rawP,particleIndex=0;particleIndex<frames[frameIndex].length;particleIndex++){rawP=frames[frameIndex][particleIndex],alive=0!==rawP;let p=this.framedata[frameIndex][particleIndex]={position:alive?{x:rawP[0]/precision*scale,y:rawP[1]/precision*scale,z:rawP[2]/precision*scale}:null,alive:alive};this.useRotation&&(p.rotation=alive?{x:rawP[3]/precision,y:rawP[4]/precision,z:rawP[5]/precision}:null),this.useAge&&(p.age=alive?rawP[6]/precision:0),alive&&0===frameIndex&&(this.restPositions[particleIndex]=p.position?{x:p.position.y,y:p.position.y,z:p.position.z}:null,this.restRotations[particleIndex]=p.rotation?{x:p.rotation.y,y:p.rotation.y,z:p.rotation.z}:null)}}},createParticles:function(){const tempGeometries=[];return function(numParticleSystems){const data=this.data;var loop=parseInt(this.data.loop);this.particleSystems.length=0,isNaN(loop)&&(loop='true'===this.data.loop?Number.MAX_VALUE:0);for(let particleSystem,i=0;i<numParticleSystems;i++){particleSystem={active:!1,activeParticleIndices:Array(this.particleCount),loopCount:0,loopTotal:loop,mesh:null,time:0};const ratio=data.img?data.img.width/data.img.height:1;tempGeometries.length=0;for(let geometry,p=0;p<this.numParticles;p++)geometry=new THREE.PlaneBufferGeometry(0.1*ratio*data.pscale,0.1*data.pscale),!1===this.sprite_rotation?(geometry.rotateX(this.data.protation.x*_MathPI3/180),geometry.rotateY(this.data.protation.y*_MathPI3/180),geometry.rotateZ(this.data.protation.z*_MathPI3/180)):(geometry.rotateX(this.sprite_rotation.x),geometry.rotateY(this.sprite_rotation.y),geometry.rotateZ(this.sprite_rotation.z)),tempGeometries.push(geometry);let mergedBufferGeometry=THREE.BufferGeometryUtils.mergeBufferGeometries(tempGeometries);particleSystem.mesh=new THREE.Mesh(mergedBufferGeometry,this.material),particleSystem.mesh.visible=!1,this.el.setObject3D(`particleplayer${i}`,particleSystem.mesh),copyArray(this.originalVertexPositions,mergedBufferGeometry.attributes.position.array);for(let i=0;i<mergedBufferGeometry.attributes.position.array.length;i++)mergedBufferGeometry.attributes.position.array[i]=-99999;for(let i=0;i<particleSystem.activeParticleIndices.length;i++)particleSystem.activeParticleIndices[i]=i;this.particleSystems.push(particleSystem)}}}(),start:function(evt){0<this.data.delay?setTimeout(()=>this.startAfterDelay(evt),this.data.delay):this.startAfterDelay(evt)},startAfterDelay:function(evt){var particleSystem,found=-1,oldestTime=0,position=evt?evt.detail.position:null,rotation=evt?evt.detail.rotation:null;position instanceof THREE.Vector3||(position=new THREE.Vector3),rotation instanceof THREE.Euler||(rotation=new THREE.Euler);for(var i=0;i<this.particleSystems.length;i++){if(!1===this.particleSystems[i].active){found=i;break}this.particleSystems[i].time>oldestTime&&(found=i,oldestTime=this.particleSystems[i].time)}if(-1!==found)return particleSystem=this.particleSystems[found],particleSystem.active=!0,particleSystem.loopCount=1,particleSystem.mesh.visible=!0,particleSystem.mesh.position.copy(position),particleSystem.mesh.rotation.copy(rotation),particleSystem.time=0,this.resetParticles(particleSystem),particleSystem},doLoop:function(particleSystem){particleSystem.loopCount++,particleSystem.frame=-1,particleSystem.time=0,this.resetParticles(particleSystem)},resetParticle:function(particleSystem,particleIndex){const geometry=particleSystem.mesh.geometry;this.restPositions[particleIndex]?transformPlane(particleIndex,geometry,this.originalVertexPositions,this.restPositions[particleIndex],this.useRotation&&this.restRotations[particleIndex],null):transformPlane(particleIndex,geometry,this.originalVertexPositions,OFFSCREEN_VEC3,void 0,null)},resetParticles:function(particleSystem){var i,rand;if(this.particleCount===this.numParticles){for(i=0;i<this.numParticles;i++)this.resetParticle(particleSystem,i);return}const geometry=particleSystem.mesh.geometry;for(i=0;i<this.numParticles;i++)i<this.particleCount&&transformPlane(particleSystem.activeParticleIndices[i],geometry,this.originalVertexPositions,OFFSCREEN_VEC3,void 0,null),this.indexPool[i]=i;for(i=0;i<this.particleCount;i++)rand=i+_Mathfloor(Math.random()*(this.numParticles-i)),particleSystem.activeParticleIndices[i]=this.indexPool[rand],this.indexPool[rand]=this.indexPool[i],this.resetParticle(particleSystem,particleSystem.activeParticleIndices[i])},tick:function(){const helperPositionVec3=new THREE.Vector3;return function(time,delta){var frame,fdata,fdataNext,frameTime,relTime,interpolate,useRotation=this.useRotation;const scaleSystem=this.data.animateScale&&!this.useAge,scaleParticle=this.data.animateScale&&this.useAge;for(let particleSystem,particleSystemIndex=0;particleSystemIndex<this.particleSystems.length;particleSystemIndex++)if(particleSystem=this.particleSystems[particleSystemIndex],!!particleSystem.active){interpolate=this.data.interpolate&&this.data.dur/this.numFrames>delta,relTime=particleSystem.time/this.data.dur,frame=relTime*this.numFrames,fdata=this.framedata[_Mathfloor(frame)],interpolate&&(frameTime=frame-_Mathfloor(frame),fdataNext=frame<this.numFrames-1?this.framedata[_Mathfloor(frame)+1]:null),scaleSystem&&this.partScale.lerpVectors(this.data.initialScale,this.data.finalScale,relTime);for(let activeParticleIndex=0;activeParticleIndex<particleSystem.activeParticleIndices.length;activeParticleIndex++){let particleIndex=particleSystem.activeParticleIndices[activeParticleIndex],rotation=useRotation&&fdata[particleIndex].rotation;if(scaleParticle&&this.partScale.lerpVectors(this.data.initialScale,this.data.finalScale,fdata[particleIndex].age),!fdata[particleIndex].alive){transformPlane(particleIndex,particleSystem.mesh.geometry,this.originalVertexPositions,OFFSCREEN_VEC3,void 0,null);continue}interpolate&&fdataNext&&fdataNext[particleIndex].alive?(helperPositionVec3.lerpVectors(fdata[particleIndex].position,fdataNext[particleIndex].position,frameTime),transformPlane(particleIndex,particleSystem.mesh.geometry,this.originalVertexPositions,helperPositionVec3,rotation,this.partScale)):transformPlane(particleIndex,particleSystem.mesh.geometry,this.originalVertexPositions,fdata[particleIndex].position,rotation,this.partScale)}if(particleSystem.time+=delta,particleSystem.time>=this.data.dur){particleSystem.loopCount<particleSystem.loopTotal?(this.el.emit('particleplayerloop',null,!1),this.doLoop(particleSystem)):(this.el.emit('particleplayerfinished',null,!1),particleSystem.active=!1,particleSystem.mesh.visible=!1);continue}}}}(),_transformPlane:transformPlane});const tri=function(){const tri=new THREE.Geometry;return tri.vertices.push(new THREE.Vector3),tri.vertices.push(new THREE.Vector3),tri.vertices.push(new THREE.Vector3),tri.faces.push(new THREE.Face3(0,1,2)),tri}();module.exports.transformPlane=transformPlane},function(){AFRAME.registerComponent('pause',{schema:{isPaused:{default:!1}},update:function(){this.data.isPaused&&this.el.isPlaying?this.el.pause():!this.data.isPaused&&!this.el.isPlaying&&this.el.sceneEl.isPlaying&&this.el.play()}})},function(){AFRAME.registerComponent('pauser',{schema:{enabled:{default:!0}},init:function(){this.pauseGame=this.pauseGame.bind(this),document.addEventListener('visibilitychange',()=>{'hidden'===document.visibilityState&&this.pauseGame()})},pauseGame:function(){this.data.enabled&&this.el.sceneEl.emit('pausegame',null,!1)}})},function(module,exports,__webpack_require__){var SoundPool=__webpack_require__(70);AFRAME.registerSystem('play-sound',{init:function(){this.lastSoundPlayed='',this.lastSoundPlayedTime=0,this.pools={}},createPool:function(sound,volume){this.pools[sound]||(this.pools[sound]=new SoundPool(sound,volume))},playSound:function(sound,volume){this.pools[sound]||this.createPool(sound,volume),this.pools[sound].play(),this.lastSoundPlayed=sound,this.lastSoundTime=this.el.time}}),AFRAME.registerComponent('play-sound',{schema:{enabled:{default:!0},event:{type:'string'},sound:{type:'string'},volume:{type:'number',default:1}},multiple:!0,init:function(){this.el.addEventListener(this.data.event,()=>{this.data.enabled&&this.system.playSound(this.src,this.data.volume)})},update:function(){if(this.src=this.data.sound,this.data.sound.startsWith('#'))try{this.src=document.querySelector(this.data.sound).getAttribute('src')}catch(e){console.log(e,this.data.sound)}}})},function(){AFRAME.registerComponent('raycaster-target',{schema:{bindToggle:{default:''},depth:{type:'number'},height:{type:'number'},position:{type:'vec3',default:{x:0,y:0,z:0}},rotation:{type:'vec3',default:{x:0,y:0,z:0}},useBoxTarget:{default:!1},width:{type:'number'}},init:function(){var boxGeometry={primitive:'box'},planeGeometry={primitive:'plane'};return function(){var geometry,raycastTarget,data=this.data,el=this.el;raycastTarget=document.createElement('a-entity'),raycastTarget.classList.add('raycasterTarget'),data.bindToggle?raycastTarget.setAttribute('bind-toggle__raycastable',data.bindToggle):raycastTarget.setAttribute('data-raycastable',''),data.useBoxTarget?(geometry=boxGeometry,geometry.depth=data.depth,geometry.height=data.height,geometry.width=data.width):(geometry=planeGeometry,geometry.height=data.height,geometry.width=data.width),raycastTarget.setAttribute('geometry',geometry),raycastTarget.object3D.visible=!1,raycastTarget.object3D.position.copy(data.position),raycastTarget.object3D.rotation.x=THREE.Math.degToRad(data.rotation.x),raycastTarget.object3D.rotation.y=THREE.Math.degToRad(data.rotation.y),raycastTarget.object3D.rotation.z=THREE.Math.degToRad(data.rotation.z),el.appendChild(raycastTarget)}}()})},function(){AFRAME.registerComponent('song-controls',{dependencies:['song'],schema:{songName:{default:''},songSubName:{default:''},songImage:{default:''},isPlaying:{default:!1}},init:function(){this.song=this.el.components.song,this.tick=AFRAME.utils.throttleTick(this.tick.bind(this),1e3)},update:function(){this.controls&&(this.data.isPlaying?this.controls.classList.add('isPlaying'):this.controls.classList.remove('isPlaying'),document.getElementById('songImage').src=this.data.songImage,document.getElementById('songName').innerHTML=this.data.songName,document.getElementById('songSubName').innerHTML=this.data.songSubName)},play:function(){this.controls=document.getElementById('controls'),this.playhead=document.getElementById('playhead');const timeline=this.timeline=document.getElementById('timeline'),timelineWidth=timeline.offsetWidth-this.playhead.offsetWidth;timeline.addEventListener('click',event=>{const marginLeft=event.clientX-timeline.getBoundingClientRect().left;this.song.stopAudio(),this.song.data.analyserEl.addEventListener('audioanalyserbuffersource',evt=>{const source=this.song.source=evt.detail;this.el.components['beat-loader'].seek();const time=marginLeft/timelineWidth*source.buffer.duration;this.song.startAudio(time),this.updatePlayhead()},{once:!0}),this.song.audioAnalyser.refreshSource()})},tick:function(){this.song.isPlaying&&this.song.source&&this.updatePlayhead()},updatePlayhead:function(){const progress=100*(this.song.getCurrentTime()/this.song.source.buffer.duration);this.playhead.style.marginLeft=progress+'%'}})},function(){AFRAME.registerComponent('song-progress-ring',{dependencies:['geometry','material'],schema:{enabled:{default:!1}},init:function(){this.tick=AFRAME.utils.throttleTick(this.tick.bind(this),1e3),this.progress=this.el.getObject3D('mesh').material.uniforms.progress,this.el.sceneEl.addEventListener('cleargame',()=>{this.progress.value=0})},update:function(){this.progress.value=0},updateRing:function(){const source=this.el.sceneEl.components.song.source;if(source){const progress=this.el.sceneEl.components.song.getCurrentTime()/source.buffer.duration;this.progress.value=progress}},tick:function(){this.data.enabled&&this.updateRing()}})},function(module,exports,__webpack_require__){const utils=__webpack_require__(1),ONCE={once:!0},BASE_VOLUME=0.75;let skipDebug=AFRAME.utils.getUrlParameter('skip');skipDebug=skipDebug?parseInt(skipDebug)/1e3:0,AFRAME.registerComponent('song',{schema:{analyserEl:{type:'selector',default:'#audioAnalyser'},challengeId:{default:''},hasReceivedUserGesture:{default:!1},isBeatsPreloaded:{default:!1},isPlaying:{default:!1}},init:function(){this.analyserSetter={buffer:!0},this.audioAnalyser=this.data.analyserEl.components.audioanalyser,this.context=this.audioAnalyser.context,this.isPlaying=!1,this.songLoadingIndicator=document.getElementById('songLoadingIndicator'),this.songStartTime=0,this.audioAnalyser.gainNode.gain.value=BASE_VOLUME,this.el.addEventListener('gamemenurestart',this.onRestart.bind(this))},update:function(oldData){const data=this.data;return!oldData.isBeatsPreloaded&&this.data.isBeatsPreloaded&&this.source&&this.startAudio(),oldData.challengeId&&!data.challengeId?void this.stopAudio():void(oldData.challengeId!==data.challengeId&&data.challengeId&&(this.el.sceneEl.emit('songloadstart',null,!1),this.getAudio().then(()=>{this.el.sceneEl.emit('songloadfinish',null,!1)}).catch(console.error)),oldData.isPlaying&&!data.isPlaying&&this.audioAnalyser.suspendContext(),!oldData.isPlaying&&data.isPlaying&&this.source&&this.audioAnalyser.resumeContext())},getAudio:function(){const data=this.data;return this.isPlaying=!1,new Promise(resolve=>(data.analyserEl.addEventListener('audioanalyserbuffersource',evt=>{this.source=evt.detail,resolve(this.source)},ONCE),this.analyserSetter.src=utils.getS3FileUrl(data.challengeId,'song.ogg'),data.analyserEl.setAttribute('audioanalyser',this.analyserSetter),this.audioAnalyser.xhr.response?(this.songLoadingIndicator.setAttribute('material','progress',1),void this.el.sceneEl.emit('songfetchfinish',null,!1)):void this.audioAnalyser.xhr.addEventListener('progress',evt=>{this.onFetchProgress(evt)})))},stopAudio:function(){return this.source?void(this.source.stop(),this.source.disconnect(),this.source=null,this.isPlaying=!1):void console.warn('[song] Tried to stopAudio, but not playing.')},onFetchProgress:function(evt){const progress=evt.loaded/evt.total;this.songLoadingIndicator.setAttribute('material','progress',progress),1<=progress&&this.el.sceneEl.emit('songfetchfinish',null,!1)},onRestart:function(){this.isPlaying=!1,this.source&&this.source.disconnect();const gain=this.audioAnalyser.gainNode.gain;gain.cancelScheduledValues(0),this.data.analyserEl.addEventListener('audioanalyserbuffersource',evt=>{this.source=evt.detail,this.el.sceneEl.emit('songloadfinish',null,!1)},ONCE),this.audioAnalyser.refreshSource()},startAudio:function(time){const playTime=time||skipDebug||0,gain=this.audioAnalyser.gainNode.gain;gain.setValueAtTime(BASE_VOLUME,this.context.currentTime),this.songStartTime=this.context.currentTime-playTime,this.source.start(0,playTime),this.isPlaying=!0},getCurrentTime:function(){return this.context.currentTime-this.songStartTime}})},function(){AFRAME.registerComponent('stage-colors',{dependencies:['background'],schema:{color:{default:'blue',oneOf:['blue','red']}},init:function(){this.colorCodes=['off','blue','blue','bluefade','','red','red','redfade'],this.el.addEventListener('cleargame',this.resetColors.bind(this))},update:function(){this.updateColors(this.data.color)},setColor:function(target,code){this.el.emit(`${target}color${this.colorCodes[code]}`,null,!1)},resetColors:function(){this.updateColors('blue'),this.el.emit('bgcolorblue',null,!1),this.el.emit('tunnelcolorred',null,!1),this.el.emit('floorcolorred',null,!1),this.el.emit('leftlasercolorblue',null,!1),this.el.emit('rightlasercolorblue',null,!1)},updateColors:function(){}})},function(){AFRAME.registerComponent('stage-lasers',{schema:{enabled:{default:!0}},init:function(){this.speed=0,this.lasers=[this.el.children[0].object3D,this.el.children[1].object3D,this.el.children[2].object3D]},pulse:function(speed){this.speed=speed/8},tick:function(time,delta){if(0!==this.speed)return delta/=1e3,!this.data.enabled&&(this.speed*=0.97,0.01>Math.abs(this.speed))?void(this.speed=0):void(this.lasers[0].rotation.z+=this.speed*delta,this.lasers[1].rotation.z-=1.01*(this.speed*delta),this.lasers[2].rotation.z+=1.02*(this.speed*delta))}})},function(){AFRAME.registerShader('stageShader',{schema:{color:{type:'vec3',is:'uniform',default:{x:0,y:0,z:0}},fogColor:{type:'vec3',is:'uniform',default:{x:0,y:0.48,z:0.72}},src:{type:'map',is:'uniform'}},vertexShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    #define FOG_RADIUS  50.0
    #define FOG_FALLOFF 45.0
    varying vec2 uvs;
    varying vec3 worldPos;
    uniform vec3 color;
    uniform vec3 fogColor;
    uniform sampler2D src;

    void main() {
      vec4 col = texture2D(src, uvs);
      col.xyz = mix(fogColor, col.xyz, clamp(distance(worldPos, vec3(0., 0., -FOG_RADIUS)) / FOG_FALLOFF, 0., 1.));
      gl_FragColor = col;
    }
  `})},function(){AFRAME.registerComponent('stats-param',{init:function(){'true'===AFRAME.utils.getUrlParameter('stats')&&this.el.setAttribute('stats','')}})},function(){AFRAME.registerComponent('sub-object',{schema:{from:{type:'selector'},name:{type:'string'}},init:function(){var el=this.el,data=this.data;data.from.addEventListener('model-loaded',evt=>{const model=evt.detail.model,subset=model.getObjectByName(data.name);el.setObject3D('mesh',subset.clone()),el.setAttribute('material','shader','flat'),el.emit('subobjectloaded',null,!1)})}})},function(){function findFontChar(chars,code){for(var i=0;i<chars.length;i++)if(chars[i].id===code)return chars[i];return null}var _Mathfloor2=Math.floor,KEYBOARDS={supersaber:{wrapCount:20,inputOffsetY:8e-3,inputOffsetX:0.08,img:'keyboard.png',hoverImg:'keyboard-hover.png',layout:[{key:'1',x:0.014,y:0.024,w:0.094,h:0.183},{key:'2',x:0.108,y:0.024,w:0.094,h:0.183},{key:'3',x:0.203,y:0.024,w:0.095,h:0.183},{key:'4',x:0.299,y:0.024,w:0.094,h:0.183},{key:'5',x:0.394,y:0.024,w:0.093,h:0.183},{key:'6',x:0.487,y:0.024,w:0.095,h:0.183},{key:'7',x:0.583,y:0.024,w:0.093,h:0.183},{key:'8',x:0.677,y:0.024,w:0.095,h:0.183},{key:'9',x:0.772,y:0.024,w:0.093,h:0.183},{key:'0',x:0.866,y:0.024,w:0.093,h:0.183},{key:'q',x:0.014,y:0.215,w:0.094,h:0.183},{key:'w',x:0.108,y:0.215,w:0.094,h:0.183},{key:'e',x:0.203,y:0.215,w:0.095,h:0.183},{key:'r',x:0.299,y:0.215,w:0.094,h:0.183},{key:'t',x:0.394,y:0.215,w:0.093,h:0.183},{key:'y',x:0.487,y:0.215,w:0.095,h:0.183},{key:'i',x:0.677,y:0.215,w:0.095,h:0.183},{key:'u',x:0.583,y:0.215,w:0.093,h:0.183},{key:'o',x:0.772,y:0.215,w:0.093,h:0.183},{key:'p',x:0.866,y:0.215,w:0.093,h:0.183},{key:'a',x:0.063,y:0.405,w:0.094,h:0.183},{key:'s',x:0.158,y:0.405,w:0.094,h:0.183},{key:'d',x:0.253,y:0.405,w:0.095,h:0.183},{key:'f',x:0.349,y:0.405,w:0.094,h:0.183},{key:'g',x:0.443,y:0.405,w:0.093,h:0.183},{key:'h',x:0.537,y:0.405,w:0.095,h:0.183},{key:'j',x:0.633,y:0.405,w:0.092,h:0.183},{key:'k',x:0.726,y:0.405,w:0.095,h:0.183},{key:'l',x:0.821,y:0.405,w:0.093,h:0.183},{key:'z',x:0.111,y:0.598,w:0.093,h:0.181},{key:'x',x:0.205,y:0.598,w:0.095,h:0.181},{key:'c',x:0.301,y:0.598,w:0.095,h:0.181},{key:'v',x:0.396,y:0.598,w:0.093,h:0.181},{key:'b',x:0.49,y:0.598,w:0.094,h:0.181},{key:'n',x:0.585,y:0.598,w:0.094,h:0.181},{key:'m',x:0.68,y:0.598,w:0.093,h:0.181},{key:'Delete',x:0.777,y:0.598,w:0.137,h:0.181},{key:' ',x:0.297,y:0.788,w:0.381,h:0.201},{key:'Escape',x:0.013,y:0.797,w:0.137,h:0.181},{key:'Insert',x:0.014,y:-1e-3,w:0.01,h:5e-3}]}};if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');var FontFactors={roboto:17,aileronsemibold:20,dejavu:20.5,exo2bold:20,exo2semibold:20.3,kelsonsans:22.8,monoid:19.5,mozillavr:9.5,sourcecodepro:20.3};AFRAME.registerComponent('super-keyboard',{schema:{align:{default:'left',oneOf:['left','center','right']},blinkingSpeed:{type:'int',default:400},filters:{type:'array'},font:{default:'aileronsemibold'},hand:{type:'selector'},imagePath:{default:'.'},injectToRaycasterObjects:{default:!0},inputColor:{type:'color',default:'#6699ff'},interval:{type:'int',default:50},keyBgColor:{type:'color',default:'#000'},keyColor:{type:'color',default:'#6699ff'},keyHoverColor:{type:'color',default:'#1A407F'},keyPressColor:{type:'color',default:'#5290F6'},label:{type:'string',default:''},labelColor:{type:'color',default:'#aaa'},maxLength:{type:'int',default:0},model:{default:'basic'},show:{default:!0},value:{type:'string',default:''},width:{default:0.8}},init:function(){this.el.addEventListener('click',this.click.bind(this)),this.changeEventDetail={},this.textInputObject={},this.keys=null,this.focused=!1,this.keyHover=null,this.prevCheckTime=null,this.shift=!1,this.rawValue=this.data.value,this.defaultValue=this.data.value,this.userFilterFunc=null,this.intervalId=0,this.kbImg=document.createElement('a-entity'),this.kbImg.classList.add('keyboardRaycastable'),this.kbImg.classList.add('superKeyboardImage'),this.kbImg.addEventListener('raycaster-intersected',this.hover.bind(this)),this.kbImg.addEventListener('raycaster-intersected-cleared',this.blur.bind(this)),this.el.appendChild(this.kbImg),this.label=document.createElement('a-entity'),this.label.setAttribute('text',{align:'center',font:this.data.font,baseline:'bottom',lineHeight:40,shader:'msdf',negate:!0,value:this.data.label,color:this.data.labelColor,width:this.data.width,wrapCount:30}),this.el.appendChild(this.label),this.textInput=document.createElement('a-entity'),this.textInput.setAttribute('mixin','superKeyboardTextInput'),this.textInput.setAttribute('text',{align:this.data.align,font:this.data.font,lineHeight:35,value:this.data.value,color:this.data.inputColor,width:this.data.width,wrapCount:20}),this.el.appendChild(this.textInput),this.cursor=document.createElement('a-entity'),this.cursor.object3D.position.set(0,0,1e-3),this.cursor.setAttribute('material',{shader:'flat',color:this.data.inputColor}),this.textInput.appendChild(this.cursor),this.cursorUpdated=!1,this.keyBgColor=new THREE.Color,this.keyHoverColor=new THREE.Color,this.keyPressColor=new THREE.Color;var self=this;document.addEventListener('keydown',function(ev){if('t'===ev.key){for(var ss='',s='abcdefghijklmopqrstuvQWIEUTGASDLIGKBXACQWETL102394676457',l=_Mathfloor2(20*Math.random()),i=0;i<l;i++)ss+=s[_Mathfloor2(Math.random()*s.length)];self.el.setAttribute('super-keyboard',{value:ss})}}),document.addEventListener('show',this.open.bind(this)),this.hand=null,this.handListenersSet=!1,this.raycaster=null},update:function(oldData){var kbdata=KEYBOARDS[this.data.model],w=this.data.width,h=this.data.width/2;if(void 0===kbdata)return void console.error('super-keyboard ERROR: model "'+this.data.model+'" undefined.');oldData&&this.defaultValue===oldData.defaultValue?this.updateTextInput(this.filter(this.rawValue)):(this.rawValue=this.data.value,this.defaultValue=this.data.value,this.updateTextInput(this.filter(this.data.value))),(this.data.width!==oldData.width||this.data.height!==oldData.height||this.data.keyColor!==oldData.keyColor)&&(this.kbImg.setAttribute('geometry',{primitive:'plane',width:w,height:h}),this.kbImg.setAttribute('material',{shader:'flat',src:this.data.imagePath+'/'+kbdata.img,color:this.data.keyColor,transparent:!0})),(this.data.label!==oldData.label||this.data.labelColor!==oldData.labelColor||this.data.width!==oldData.width)&&(this.label.setAttribute('text',{value:this.data.label,color:this.data.labelColor,width:this.data.width}),this.label.object3D.position.set(0,0.35*w,-0.02)),(this.data.width!==oldData.width||this.data.keyBgColor!==oldData.keyBgColor)&&this.initKeyColorPlane();var inputx='center'===this.data.align?0:kbdata.inputOffsetX*w;'right'===this.data.align&&(inputx*=-1),(this.data.font!==oldData.font||this.data.inputColor!==oldData.inputColor||this.data.width!==oldData.width||this.data.align!==oldData.align)&&this.textInput.setAttribute('text',{font:this.data.font,color:this.data.inputColor,width:w,wrapCount:kbdata.wrapCount,align:this.data.align});for(var kdata,i=0;i<kbdata.layout.length;i++)kdata=kbdata.layout[i],'Insert'===kdata.key&&(this.inputRect=kdata);this.textInput.object3D.position.set(inputx,w/4-(this.inputRect.y+this.inputRect.h/2)*w/2+kbdata.inputOffsetY*w,2e-3),this.data.width!==oldData.width&&this.cursor.setAttribute('geometry',{primitive:'plane',width:0.03*w,height:0.01*w}),this.updateCursorPosition(),this.setupHand(),this.keyBgColor.set(this.data.keyBgColor),this.keyHoverColor.set(this.data.keyHoverColor),this.keyPressColor.set(this.data.keyPressColor),this.data.show?this.open():this.close()},tick:function(time){var intersection;if(!(this.prevCheckTime&&time-this.prevCheckTime<this.data.interval)){if(!this.prevCheckTime)return void(this.prevCheckTime=time);if(this.raycaster&&this.focused&&(intersection=this.raycaster.getIntersection(this.kbImg),!!intersection))for(var k,uv=intersection.uv,keys=KEYBOARDS[this.data.model].layout,i=0;i<keys.length;i++)if(k=keys[i],uv.x>k.x&&uv.x<k.x+k.w&&1-uv.y>k.y&&1-uv.y<k.y+k.h){this.keyHover!==k&&(this.keyHover=k,this.updateKeyColorPlane(this.keyHover.key,this.keyHoverColor));break}}},play:function(){this.cursorUpdated&&this.startBlinking()},pause:function(){this.stopBlinking()},initKeyColorPlane:function(){var kbdata=KEYBOARDS[this.data.model],keyColorPlane=this.keyColorPlane=document.createElement('a-entity');keyColorPlane.classList.add('superKeyboardKeyColorPlane'),keyColorPlane.object3D.position.z=1e-3,keyColorPlane.object3D.visible=!1,keyColorPlane.setAttribute('geometry',{primitive:'plane',buffer:!1}),keyColorPlane.setAttribute('material',{shader:'flat',color:this.data.keyBgColor,transparent:!0}),kbdata.hoverImg&&keyColorPlane.setAttribute('material',{src:this.data.imagePath+'/'+kbdata.hoverImg}),keyColorPlane.addEventListener('componentinitialized',function(evt){'material'===evt.detail.name&&(kbdata.hoverImg||(this.getObject3D('mesh').material.blending=THREE.AdditiveBlending))}),this.el.appendChild(keyColorPlane)},updateKeyColorPlane:function(key,color){var kbdata=KEYBOARDS[this.data.model],keyColorPlane=this.keyColorPlane;if(!key)return void(keyColorPlane.object3D.visible=!1);for(var kdata,i=0;i<kbdata.layout.length;i++)if(kdata=kbdata.layout[i],kdata.key===key){var w=this.data.width,h=this.data.width/2,keyw=kdata.w*w,keyh=kdata.h*h;keyColorPlane.object3D.scale.x=keyw,keyColorPlane.object3D.scale.y=keyh,keyColorPlane.object3D.position.x=kdata.x*w-w/2+keyw/2,keyColorPlane.object3D.position.y=(1-kdata.y)*h-h/2-keyh/2,keyColorPlane.getObject3D('mesh').material.color.copy(color);var geometry=keyColorPlane.getObject3D('mesh').geometry,uvSet=geometry.faceVertexUvs[0],kdataY=1-kdata.y;uvSet[0][0].set(kdata.x,kdataY),uvSet[0][1].set(kdata.x,kdataY-kdata.h),uvSet[0][2].set(kdata.x+kdata.w,kdataY),uvSet[1][0].set(kdata.x,kdataY-kdata.h),uvSet[1][1].set(kdata.x+kdata.w,kdataY-kdata.h),uvSet[1][2].set(kdata.x+kdata.w,kdataY),geometry.uvsNeedUpdate=!0;break}keyColorPlane.object3D.visible=!0},setupHand:function(){if(this.hand&&this.hand.ownRaycaster&&this.hand.removeAttribute('raycaster'),this.hand=this.data.hand?this.data.hand:document.querySelector(['[cursor]','[vive-controls]','[tracked-controls]','[oculus-touch-controls]','[windows-motion-controls]','[hand-controls]','[daydream-controls] [cursor] > [raycaster]'].join(',')),!this.hand)console.error('super-keyboard: no controller found. Add <a-entity> with controller or specify with super-keyboard="hand: #selectorToController".');else{if(!this.hand.hasLoaded)return void this.hand.addEventListener('loaded',this.setupHand.bind(this));var raycaster=this.hand.components.raycaster,params={};if(!raycaster)this.hand.ownRaycaster=!0,params.showLine=this.data.show,params.enabled=this.data.show,this.data.injectToRaycasterObjects&&(params.objects='.keyboardRaycastable'),this.hand.setAttribute('raycaster',params);else if(this.hand.ownRaycaster=!1,this.data.injectToRaycasterObjects){var objs=raycaster.data.objects.split(',');-1===objs.indexOf('.keyboardRaycastable')&&objs.push('.keyboardRaycastable'),params.objects=objs.join(',').replace(/^,/,''),this.hand.setAttribute('raycaster',params)}this.raycaster=this.hand.components.raycaster}},filter:function(str){if(''===str)return'';for(var i=0;i<this.data.filters.length;i++)switch(this.data.filters[i]){case'custom':{this.userFilterFunc&&(str=this.userFilterFunc(str));break}case'allupper':{str=str.toUpperCase();break}case'alllower':{str=str.toLowerCase();break}case'title':{str=str.split(' ').map(function(s){return s[0].toUpperCase()+s.substr(1)}).join(' ');break}case'numbers':{str=str.split('').filter(function(c){return!isNaN(parseInt(c))||'.'===c}).join('');break}case'first':{str=str[0].toUpperCase()+str.substr(1);break}case'trim':{str=str.trim();break}}return 0<this.data.maxLength?str.substr(0,this.data.maxLength):str},click:function(){if(this.keyHover){switch(this.keyHover.key){case'Enter':{this.accept();break}case'Insert':return;case'Delete':{this.rawValue=this.rawValue.substr(0,this.rawValue.length-1);var newValue=this.filter(this.rawValue);this.el.setAttribute('super-keyboard','value',newValue),this.updateTextInput(newValue),this.changeEventDetail.value=newValue,this.el.emit('superkeyboardchange',this.changeEventDetail);break}case'Shift':{this.shift=!this.shift,this.keyHover.el.setAttribute('material','color',this.shift?this.data.keyHoverColor:this.data.keyBgColor);break}case'Escape':{this.dismiss();break}default:{if(0<this.data.maxLength&&this.rawValue.length>this.data.maxLength)break;this.rawValue+=this.shift?this.keyHover.key.toUpperCase():this.keyHover.key;var newValue=this.filter(this.rawValue);this.el.setAttribute('super-keyboard','value',newValue),this.updateTextInput(newValue),this.changeEventDetail.value=newValue,this.el.emit('superkeyboardchange',this.changeEventDetail);break}}this.updateKeyColorPlane(this.keyHover.key,this.keyPressColor);var self=this;setTimeout(function(){self.updateKeyColorPlane(self.keyHover.key,self.keyHoverColor)},100),this.updateCursorPosition()}},open:function(){this.el.object3D.visible=!0,this.hand&&this.hand.ownRaycaster&&this.hand.setAttribute('raycaster',{showLine:!0,enabled:!0})},close:function(){this.el.object3D.visible=!1,this.hand&&this.hand.ownRaycaster&&this.hand.setAttribute('raycaster',{showLine:!1,enabled:!1})},accept:function(){this.el.object3D.visible=!1,this.hand&&this.hand.ownRaycaster&&this.hand.setAttribute('raycaster',{showLine:!1,enabled:!1}),this.el.emit('superkeyboardinput',{value:this.data.value}),this.data.show=!1},dismiss:function(){this.data.value=this.defaultValue,this.updateTextInput(),this.el.object3D.visible=!1,this.hand&&this.hand.ownRaycaster&&this.hand.setAttribute('raycaster',{showLine:!1,enabled:!1}),this.el.emit('superkeyboarddismiss'),this.data.show=!1},blur:function(){this.focused=!1,this.keyHover&&'Shift'!==this.keyHover.key&&this.updateKeyColorPlane(this.keyHover.key,this.keyBgColor),this.keyHover=null},hover:function(){this.focused=!0},startBlinking:function(){this.stopBlinking(),this.intervalId=window.setInterval(this.blink.bind(this),this.data.blinkingSpeed)},stopBlinking:function(){window.clearInterval(this.intervalId),this.intervalId=0},blink:function(){this.cursor.object3D.visible=!this.cursor.object3D.visible},setCustomFilter:function(f){this.userFilterFunc=f},addCustomModel:function(name,model){name&&(KEYBOARDS[name]=model)},updateCursorPosition:function(){var font=this.textInput.components.text.currentFont;if(!font){var self=this;return this.cursor.object3D.visible=!1,void window.setTimeout(function(){self.updateCursorPosition(),self.startBlinking()},700)}var w=this.data.width,kbdata=KEYBOARDS[this.data.model],posy=-this.inputRect.h/2*w/2.4+kbdata.inputOffsetY*w,ratio=this.data.width/this.textInput.components.text.data.wrapCount,pos=0,fontFactor=FontFactors[this.textInput.components.text.data.font];fontFactor===void 0&&(fontFactor=20);for(var char,i=0;i<this.data.value.length;i++)char=findFontChar(font.chars,this.data.value.charCodeAt(i)),pos+=char.width+char.xadvance*(32===char.id?2:1);'center'===this.data.align?pos=0.0011*(pos*ratio*fontFactor)/2+0.02*w:'left'===this.data.align?(pos=0.0011*(pos*ratio*fontFactor)+0.02*w,pos-=w/2):'right'===this.data.align&&(pos=0.0011*(-pos*ratio*fontFactor)-0.02*w,pos+=w/2),this.cursor.object3D.position.set(pos,posy,1e-3),this.cursorUpdated=!0},updateTextInput:function(value){this.textInputObject.value=value||this.data.value,this.textInput.setAttribute('text',this.textInputObject)}})},function(){AFRAME.registerComponent('toggle-pause-play',{schema:{isPlaying:{default:!1}},update:function(){const action=this.data.isPlaying?'pause':'play';parent.postMessage(JSON.stringify({verify:'game-action',action}),'*')}})},function(){var _Mathabs=Math.abs;const NUM_VALUES_PER_SEGMENT=75;AFRAME.registerComponent('twister',{schema:{enabled:{default:!1},twist:{default:0},vertices:{default:4,type:'int'},count:{default:12,type:'int'},positionIncrement:{default:1.4},radiusIncrement:{default:0.4},thickness:{default:0.37}},init:function(){this.currentTwist=0,this.animate=!1,this.geometry=null},pulse:function(twist){this.data.enabled&&(twist=0==twist?0.03+0.25*Math.random():Math.min(0.4*twist,0.4),twist*=0.5>Math.random()?-1:1,this.el.setAttribute('twister',{twist:twist}))},update:function(){var radius=6,segments=[];if(1e-3<_Mathabs(this.data.twist-this.currentTwist))return void(this.animate=!0);this.clear();for(var i=0;i<this.data.count;i++){let segment=this.createSegment(radius);segment.translate(0,this.data.positionIncrement*i,0),segments.push(segment),radius+=this.data.radiusIncrement}this.geometry=THREE.BufferGeometryUtils.mergeBufferGeometries(segments);var material=this.el.sceneEl.systems.materials.stageNormal,mesh=new THREE.Mesh(this.geometry,material);this.el.object3D.add(mesh)},createSegment:function(radius){const R=this.data.thickness;var geometry,points=[new THREE.Vector2(radius-R,R),new THREE.Vector2(radius-R,-R),new THREE.Vector2(radius+R,-R),new THREE.Vector2(radius+R,R),new THREE.Vector2(radius-R,R)];geometry=new THREE.LatheBufferGeometry(points,this.data.vertices);for(let i=0;i<geometry.attributes.uv.array.length;i+=2)geometry.attributes.uv.array[i]=0.77,geometry.attributes.uv.array[i+1]=1e-3;return geometry},clear:function(){this.el.object3D.remove(this.el.object3D.children[0]),this.geometry&&this.geometry.dispose(),this.geometry=new THREE.BufferGeometry},tick:function(time,delta){if(this.animate){var rotation,x,y,sin,cos,diff,posArray=this.geometry.attributes.position.array;delta*=1e-3,diff=(this.data.twist-this.currentTwist)*delta,this.currentTwist+=diff,rotation=3*diff;for(var s=0;s<this.data.count;s++){for(var i=0;i<NUM_VALUES_PER_SEGMENT;i+=3)cos=Math.cos(rotation),sin=Math.sin(rotation),x=posArray[s*NUM_VALUES_PER_SEGMENT+i],y=posArray[s*NUM_VALUES_PER_SEGMENT+i+2],posArray[s*NUM_VALUES_PER_SEGMENT+i]=x*cos-y*sin,posArray[s*NUM_VALUES_PER_SEGMENT+i+2]=y*cos+x*sin;rotation*=1.05}this.geometry.attributes.position.needsUpdate=!0,1e-3>_Mathabs(this.data.twist-this.currentTwist)&&(this.animate=!1)}}})},function(){AFRAME.registerComponent('user-gesture',{play:function(){document.addEventListener('click',()=>{this.el.sceneEl.emit('usergesturereceive',null,!1)},{once:!0})}})},function(){var colorHelper=new THREE.Color;AFRAME.registerComponent('vertex-colors-buffer',{schema:{baseColor:{type:'color'},itemSize:{default:3}},update:function(oldData){var colors,i,geometry,mesh,data=this.data,el=this.el,self=this;if(mesh=this.el.getObject3D('mesh'),!mesh||!mesh.geometry)return void el.addEventListener('object3dset',function reUpdate(evt){'mesh'!==evt.detail.type||(el.removeEventListener('object3dset',reUpdate),self.update(oldData))});if(geometry=mesh.geometry,!geometry.attributes.position)return void console.warn('Geometry has no vertices',el);for(geometry.attributes.color||geometry.addAttribute('color',new THREE.BufferAttribute(new Float32Array(geometry.attributes.position.array.length),3)),colors=geometry.attributes.color.array,colorHelper.set(data.baseColor),i=0;i<colors.length;i+=data.itemSize)colors[i]=colorHelper.r,colors[i+1]=colorHelper.g,colors[i+2]=colorHelper.b;geometry.attributes.color.needsUpdate=!0}})},function(){AFRAME.registerComponent('visible-raycastable',{schema:{default:!0},update:function(){this.el.object3D.visible=this.data,this.data?this.el.setAttribute('raycastable',''):this.el.removeAttribute('raycastable','')}})},function(module,exports,__webpack_require__){const COLORS=__webpack_require__(0),WALL_COLOR=new THREE.Color(COLORS.NEON_RED),WALL_BG=new THREE.Color(COLORS.SKY_RED);AFRAME.registerShader('wallShader',{schema:{iTime:{type:'time',is:'uniform'},hitRight:{type:'vec3',is:'uniform',default:{x:0,y:1,z:0}},hitLeft:{type:'vec3',is:'uniform',default:{x:0,y:0,z:0}}},vertexShader:`
    varying vec2 uvs;
    varying vec3 nrml;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      nrml.xyz = normal.xyz;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    varying vec2 uvs;
    varying vec3 nrml;
    varying vec3 worldPos;
    uniform float iTime;
    //uniform sampler2D env;
    uniform vec3 hitRight;
    uniform vec3 hitLeft;

    #define SEED 19.1254
    #define time (3.0 + iTime)/1000.0 * 0.15

    float noise(vec3 uv) {
      return fract(sin(uv.x*123243. + uv.y*424. + uv.z*642. + SEED) * 1524.);
    }

    vec3 drawCircle(vec3 p, vec3 center, float radius, float edgeWidth, vec3 color) {
      return color * (1.0 - smoothstep(radius, radius + edgeWidth, length(p - center)));
    }

    float smoothNoise(vec3 uvw, float frec){
      vec3 luvw = vec3(smoothstep(0.0, 1.0, fract(uvw.xy * frec)), fract(uvw.z * frec));
      vec3 id = floor(uvw * frec);
      float blt = noise(id);
      float brt = noise(id + vec3(1.0, 0.0, 0.0));
      float tlt = noise(id + vec3(0.0, 1.0, 0.0));
      float trt = noise(id + vec3(1.0, 1.0, 0.0));

      float blb = noise(id + vec3(0.0, 0.0, 1.0));
      float brb = noise(id + vec3(1.0, 0.0, 1.0));
      float tlb = noise(id + vec3(0.0, 1.0, 1.0));
      float trb = noise(id + vec3(1.0, 1.0, 1.0));

      float a = mix(blt, brt, luvw.x);
      float b = mix(tlt, trt, luvw.x);
      float c = mix(a, b, luvw.y);

      float d = mix(blb, brb, luvw.x);
      float e = mix(tlb, trb, luvw.x);
      float f = mix(d, e, luvw.y);

      return mix(c, f, luvw.z);
    }

    #define WALL_COLOR vec3(${WALL_COLOR.r}, ${WALL_COLOR.g}, ${WALL_COLOR.b})
    #define WALL_BG vec3(${WALL_BG.r}, ${WALL_BG.g}, ${WALL_BG.b})

    void main() {
      vec2 uv1 = uvs.xy-0.5;
      float angle = time / 10.0;
      vec2 uv;
      uv.x = uv1.x * cos(angle) - uv1.y * sin(angle);
      uv.y = uv1.y * cos(angle) + uv1.x * sin(angle);
      uv.x += sin(uv.y * 2.7 + time / 1.7) * 0.2;
      uv.y += sin(uv.x * 3.1 + time / 2.4) * 0.3;

      float w, r, bg;
      r = smoothNoise(vec3(uv + worldPos.x, time / 2.0), 3.0) * 0.65;
      r += smoothNoise(vec3(uv, time / 6.0), 8.0) * 0.3;
      r += smoothNoise(vec3(uv, time / 14.0), 50.0) * 0.04;

      bg = smoothstep(0.5, 1.0, r) + smoothstep(0.5, 0.0, r);
      r = smoothstep(0.4, 0.50, r) - smoothstep(0.50, 0.6, r);
      w = smoothstep(0.97, 1.0, r);


      r += smoothstep(0.44, 0.50, abs(uv1.x));
      r += smoothstep(0.44, 0.50, abs(uv1.y));

      w += smoothstep(0.49, 0.498, abs(uv1.x));
      w += smoothstep(0.49, 0.498, abs(uv1.y));

      w *= 0.9;
      bg *= 0.5;

      vec3 COL = WALL_COLOR;
      vec3 BG = WALL_BG * 0.1;

      vec3 col = vec3(r * COL.r + w + BG.r, r * COL.g + w + BG.g, r * COL.b + w + BG.b);

      vec3 hit;
      hit = drawCircle(worldPos, hitRight, 0.04, 0.05, COL);
      hit += drawCircle(worldPos, hitRight, 0.02, 0.03, vec3(0.7, 0.7, 0.7));
      hit += drawCircle(worldPos, hitLeft, 0.04, 0.05, COL);
      hit += drawCircle(worldPos, hitLeft, 0.02, 0.03, vec3(0.7, 0.7, 0.7));

      gl_FragColor = vec4(col + hit, 0.7 + w + hit.x);
    }
`})},function(module,__webpack_exports__,__webpack_require__){'use strict';Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0__constants_beat__=__webpack_require__(2);const CEILING_THICKNESS=1.5;AFRAME.registerComponent('wall',{schema:{anticipationPosition:{default:0},durationSeconds:{default:0},height:{default:1.3},horizontalPosition:{default:'middleleft',oneOf:['left','middleleft','middleright','right']},isCeiling:{default:!1},speed:{default:1},warmupPosition:{default:0},width:{default:1}},horizontalPositions:{left:-0.75,middleleft:-0.25,middleright:0.25,right:0.75},init:function(){this.maxZ=10},update:function(){const el=this.el,data=this.data,width=data.width*0.5,halfDepth=data.durationSeconds*data.speed/2;return data.isCeiling?(el.object3D.position.set(0,1.4+CEILING_THICKNESS/2,data.anticipationPosition+data.warmupPosition-halfDepth),void el.object3D.scale.set(4,CEILING_THICKNESS,data.durationSeconds*data.speed)):void(el.object3D.position.set(this.horizontalPositions[data.horizontalPosition]+width/2-0.25,data.height+0.1,data.anticipationPosition+data.warmupPosition-halfDepth),el.object3D.scale.set(width,2.5,data.durationSeconds*data.speed))},pause:function(){this.el.object3D.visible=!1,this.el.removeAttribute('data-collidable-head')},play:function(){this.el.object3D.visible=!0,this.el.setAttribute('data-collidable-head','')},tock:function(time,timeDelta){const data=this.data,halfDepth=data.durationSeconds*data.speed/2,position=this.el.object3D.position;if(this.el.object3D.visible=!0,position.z<data.anticipationPosition-halfDepth){let newPositionZ=position.z+__WEBPACK_IMPORTED_MODULE_0__constants_beat__.a*(timeDelta/1e3);position.z=newPositionZ<data.anticipationPosition-halfDepth?newPositionZ:data.anticipationPosition-halfDepth}else position.z+=this.data.speed*(timeDelta/1e3);return this.el.object3D.position.z>this.maxZ+halfDepth?void this.returnToPool():void 0},returnToPool:function(){this.el.sceneEl.components.pool__wall.returnEntity(this.el),this.el.object3D.position.z=9999,this.el.pause(),this.el.removeAttribute('data-collidable-head')}})},function(module,exports,__webpack_require__){function requireAll(req){req.keys().forEach(req)}__webpack_require__(4),__webpack_require__(5),__webpack_require__(3),__webpack_require__(16),__webpack_require__(6),__webpack_require__(7),__webpack_require__(8),__webpack_require__(9),__webpack_require__(10),__webpack_require__(11),__webpack_require__(12),__webpack_require__(14),__webpack_require__(13),__webpack_require__(15),requireAll(__webpack_require__(18)),requireAll(__webpack_require__(19)),__webpack_require__(17)},function(module){module.exports=function SoundPool(src,volume){var sound,currSound=0,pool=[];return sound=new Audio(src),sound.volume=volume,pool.push(sound),{play:function(){0===pool[currSound].currentTime&&pool[currSound].ended||(sound=new Audio(src),sound.volume=volume,pool.push(sound),currSound++),(0===pool[currSound].currentTime||pool[currSound].ended)&&pool[currSound].play(),currSound=(currSound+1)%pool.length}}}},function(module,exports,__webpack_require__){var utils=__webpack_require__(1);const DEBUG_CHALLENGE={author:'Superman',difficulty:'Expert',id:'31',image:'assets/img/molerat.jpg',songName:'Friday',songLength:100,songSubName:'Rebecca Black'};AFRAME.registerState({initialState:{challenge:{author:'',difficulty:'',id:'',image:'',isLoading:!1,isBeatsPreloaded:!1,numBeats:void 0,songDuration:0,songName:'',songSubName:''},hasReceivedUserGesture:!1,inVR:!1,isPaused:!1,isPlaying:!1,isSongFetching:!1,isSongLoading:!1},handlers:{beatloaderfinish:state=>{state.challenge.isLoading=!1},beatloaderpreloadfinish:state=>{state.menuActive||(state.challenge.isBeatsPreloaded=!0)},beatloaderstart:state=>{state.challenge.isBeatsPreloaded=!1,state.challenge.isLoading=!0},controllerconnected:(state,payload)=>{state.controllerType=payload.name},debugloading:state=>{DEBUG_CHALLENGE.id='-1',Object.assign(state.challenge,DEBUG_CHALLENGE),state.menuActive=!1,state.isSongFetching=!0,state.isSongLoading=!0},gamemenuresume:state=>{state.isPaused=!1},gamemenurestart:state=>{state.challenge.isBeatsPreloaded=!1,state.isPaused=!1,state.isSongLoading=!0},keyboardclose:state=>{state.isSearching=!1},keyboardopen:state=>{state.isSearching=!0},pausegame:state=>{state.isPlaying&&(state.isPaused=!0)},challengeset:(state,payload)=>{state.challenge.id=payload.id,state.challenge.difficulty=payload.difficulty,state.challenge.image=utils.getS3FileUrl(payload.id,'image.jpg'),state.challenge.songName=payload.songName,state.challenge.songSubName=payload.songSubName,state.isSongLoading=!0},songfetchfinish:state=>{state.isSongFetching=!1},songloadcancel:state=>{state.challenge.isBeatsPreloaded=!1,state.challenge.isLoading=!1,state.isSongLoading=!1,state.isSongFetching=!1,state.menuActive=!0},songloadfinish:state=>{state.isSongFetching=!1,state.isSongLoading=!1},songloadstart:state=>{state.isSongFetching=!0,state.isSongLoading=!0},usergesturereceive:state=>{state.hasReceivedUserGesture=!0},"enter-vr":state=>{state.inVR=!0},"exit-vr":state=>{state.inVR=!1}},computeState:state=>{state.isPlaying=!state.menuActive&&!state.isPaused&&!state.challenge.isLoading&&!state.isSongLoading&&!!state.challenge.id&&state.hasReceivedUserGesture;state.menuActive||state.isPaused||state.isSongLoading||state.isSongFetching;state.loadingText=state.isSongLoading?state.isSongFetching?'Downloading song...':'Processing song...':''}})},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(73)(),exports.push([module.i,'html {\n  background: #111;\n}\n#controls {\n  align-items: center;\n  background: rgba(110,110,110,0.9);\n  border-radius: 10px;\n  bottom: 0;\n  display: flex;\n  opacity: 0;\n  left: 0;\n  margin: 0 auto 20px auto;\n  padding: 10px;\n  position: fixed;\n  right: 0;\n  transition: opacity 0.5s;\n  width: 400px;\n  z-index: 99999999;\n}\n#controls.isPlaying {\n  opacity: 1;\n}\n#controls #pause {\n  display: flex;\n  padding-right: 5px;\n}\n#timeline {\n  background: #111;\n  border-radius: 15px;\n  height: 20px;\n  width: 160px;\n}\n#timeline #playhead {\n  background: #fafafa;\n  border-radius: 50%;\n  height: 18px;\n  margin-top: 1px;\n  width: 18px;\n}\n#songInfoContainer {\n  align-items: center;\n  display: flex;\n  padding-left: 20px;\n}\n#songInfoContainer img {\n  height: 32px;\n  width: 32px;\n}\n#songInfoContainer p {\n  color: #fafafa;\n  font-family: monospace;\n  font-size: 13px;\n  margin: 0;\n  text-transform: uppercase;\n}\n#songInfoContainer #songInfo {\n  display: flex;\n  flex-direction: column;\n  padding-left: 15px;\n}\n#timeline {\n  cursor: pointer;\n}\n#vrButton {\n  position: absolute;\n  background: url("../assets/img/enter-vr-button-background.png") no-repeat;\n  background-size: cover;\n  border: 0;\n  cursor: pointer;\n  right: 20px;\n  bottom: 20px;\n  z-index: 9999999;\n  width: 84px;\n  height: 47px;\n}\n#vrButton.a-hidden {\n  visibility: hidden;\n}\n#vrButtonactive {\n  border: 0;\n}\n#vrButtonhover {\n  background-position: 0 -50.5px;\n}\n#logo {\n  bottom: 0;\n  position: fixed;\n  left: 0;\n  z-index: 99999999;\n}\n',''])},function(module){module.exports=function(){var list=[];return list.toString=function toString(){for(var item,result=[],i=0;i<this.length;i++)item=this[i],item[2]?result.push('@media '+item[2]+'{'+item[1]+'}'):result.push(item[1]);return result.join('')},list.i=function(modules,mediaQuery){'string'==typeof modules&&(modules=[[null,modules,'']]);for(var id,alreadyImportedModules={},i=0;i<this.length;i++)id=this[i][0],'number'==typeof id&&(alreadyImportedModules[id]=!0);for(i=0;i<modules.length;i++){var item=modules[i];'number'==typeof item[0]&&alreadyImportedModules[item[0]]||(mediaQuery&&!item[2]?item[2]=mediaQuery:mediaQuery&&(item[2]='('+item[2]+') and ('+mediaQuery+')'),list.push(item))}},list}},function(module,exports,__webpack_require__){function addStylesToDom(styles,options){for(var i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];if(domStyle){domStyle.refs++;for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j](item.parts[j]);for(;j<item.parts.length;j++)domStyle.parts.push(addStyle(item.parts[j],options))}else{for(var parts=[],j=0;j<item.parts.length;j++)parts.push(addStyle(item.parts[j],options));stylesInDom[item.id]={id:item.id,refs:1,parts:parts}}}}function listToStyles(list,options){for(var styles=[],newStyles={},i=0;i<list.length;i++){var item=list[i],id=options.base?item[0]+options.base:item[0],css=item[1],media=item[2],sourceMap=item[3],part={css:css,media:media,sourceMap:sourceMap};newStyles[id]?newStyles[id].parts.push(part):styles.push(newStyles[id]={id:id,parts:[part]})}return styles}function insertStyleElement(options,style){var target=getElement(options.insertInto);if(!target)throw new Error('Couldn\'t find a style target. This probably means that the value for the \'insertInto\' parameter is invalid.');var lastStyleElementInsertedAtTop=stylesInsertedAtTop[stylesInsertedAtTop.length-1];if('top'===options.insertAt)lastStyleElementInsertedAtTop?lastStyleElementInsertedAtTop.nextSibling?target.insertBefore(style,lastStyleElementInsertedAtTop.nextSibling):target.appendChild(style):target.insertBefore(style,target.firstChild),stylesInsertedAtTop.push(style);else if('bottom'===options.insertAt)target.appendChild(style);else if('object'==typeof options.insertAt&&options.insertAt.before){var nextSibling=getElement(options.insertAt.before,target);target.insertBefore(style,nextSibling)}else throw new Error('[Style Loader]\n\n Invalid value for parameter \'insertAt\' (\'options.insertAt\') found.\n Must be \'top\', \'bottom\', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n')}function removeStyleElement(style){if(null===style.parentNode)return!1;style.parentNode.removeChild(style);var idx=stylesInsertedAtTop.indexOf(style);0<=idx&&stylesInsertedAtTop.splice(idx,1)}function createStyleElement(options){var style=document.createElement('style');if(void 0===options.attrs.type&&(options.attrs.type='text/css'),void 0===options.attrs.nonce){var nonce=getNonce();nonce&&(options.attrs.nonce=nonce)}return addAttrs(style,options.attrs),insertStyleElement(options,style),style}function createLinkElement(options){var link=document.createElement('link');return void 0===options.attrs.type&&(options.attrs.type='text/css'),options.attrs.rel='stylesheet',addAttrs(link,options.attrs),insertStyleElement(options,link),link}function addAttrs(el,attrs){Object.keys(attrs).forEach(function(key){el.setAttribute(key,attrs[key])})}function getNonce(){return __webpack_require__.nc}function addStyle(obj,options){var style,update,remove,result;if(options.transform&&obj.css)if(result='function'==typeof options.transform?options.transform(obj.css):options.transform.default(obj.css),result)obj.css=result;else return function(){};if(options.singleton){var styleIndex=singletonCounter++;style=singleton||(singleton=createStyleElement(options)),update=applyToSingletonTag.bind(null,style,styleIndex,!1),remove=applyToSingletonTag.bind(null,style,styleIndex,!0)}else obj.sourceMap&&'function'==typeof URL&&'function'==typeof URL.createObjectURL&&'function'==typeof URL.revokeObjectURL&&'function'==typeof Blob&&'function'==typeof btoa?(style=createLinkElement(options),update=updateLink.bind(null,style,options),remove=function(){removeStyleElement(style),style.href&&URL.revokeObjectURL(style.href)}):(style=createStyleElement(options),update=applyToTag.bind(null,style),remove=function(){removeStyleElement(style)});return update(obj),function updateStyle(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}function applyToSingletonTag(style,index,remove,obj){var css=remove?'':obj.css;if(style.styleSheet)style.styleSheet.cssText=replaceText(index,css);else{var cssNode=document.createTextNode(css),childNodes=style.childNodes;childNodes[index]&&style.removeChild(childNodes[index]),childNodes.length?style.insertBefore(cssNode,childNodes[index]):style.appendChild(cssNode)}}function applyToTag(style,obj){var css=obj.css,media=obj.media;if(media&&style.setAttribute('media',media),style.styleSheet)style.styleSheet.cssText=css;else{for(;style.firstChild;)style.removeChild(style.firstChild);style.appendChild(document.createTextNode(css))}}function updateLink(link,options,obj){var css=obj.css,sourceMap=obj.sourceMap,autoFixUrls=options.convertToAbsoluteUrls===void 0&&sourceMap;(options.convertToAbsoluteUrls||autoFixUrls)&&(css=fixUrls(css)),sourceMap&&(css+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+' */');var blob=new Blob([css],{type:'text/css'}),oldSrc=link.href;link.href=URL.createObjectURL(blob),oldSrc&&URL.revokeObjectURL(oldSrc)}var stylesInDom={},isOldIE=function(fn){var memo;return function(){return'undefined'==typeof memo&&(memo=fn.apply(this,arguments)),memo}}(function(){return window&&document&&document.all&&!window.atob}),getTarget=function(target,parent){return parent?parent.querySelector(target):document.querySelector(target)},getElement=function(){var memo={};return function(target,parent){if('function'==typeof target)return target();if('undefined'==typeof memo[target]){var styleTarget=getTarget.call(this,target,parent);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement)try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}memo[target]=styleTarget}return memo[target]}}(),singleton=null,singletonCounter=0,stylesInsertedAtTop=[],fixUrls=__webpack_require__(75);module.exports=function(list,options){if('undefined'!=typeof DEBUG&&DEBUG&&'object'!=typeof document)throw new Error('The style-loader cannot be used in a non-browser environment');options=options||{},options.attrs='object'==typeof options.attrs?options.attrs:{},options.singleton||'boolean'==typeof options.singleton||(options.singleton=isOldIE()),options.insertInto||(options.insertInto='head'),options.insertAt||(options.insertAt='bottom');var styles=listToStyles(list,options);return addStylesToDom(styles,options),function update(newList){for(var mayRemove=[],i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];domStyle.refs--,mayRemove.push(domStyle)}if(newList){var newStyles=listToStyles(newList,options);addStylesToDom(newStyles,options)}for(var domStyle,i=0;i<mayRemove.length;i++)if(domStyle=mayRemove[i],0===domStyle.refs){for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j]();delete stylesInDom[domStyle.id]}}};var replaceText=function(){var textStore=[];return function(index,replacement){return textStore[index]=replacement,textStore.filter(Boolean).join('\n')}}()},function(module){module.exports=function(css){var location='undefined'!=typeof window&&window.location;if(!location)throw new Error('fixUrls requires window.location');if(!css||'string'!=typeof css)return css;var baseUrl=location.protocol+'//'+location.host,currentDir=baseUrl+location.pathname.replace(/\/[^\/]*$/,'/'),fixedCss=css.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(fullMatch,origUrl){var unquotedOrigUrl=origUrl.trim().replace(/^"(.*)"$/,function(o,$1){return $1}).replace(/^'(.*)'$/,function(o,$1){return $1});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(unquotedOrigUrl))return fullMatch;var newUrl;return newUrl=0===unquotedOrigUrl.indexOf('//')?unquotedOrigUrl:0===unquotedOrigUrl.indexOf('/')?baseUrl+unquotedOrigUrl:currentDir+unquotedOrigUrl.replace(/^\.\//,''),'url('+JSON.stringify(newUrl)+')'});return fixedCss}}]);